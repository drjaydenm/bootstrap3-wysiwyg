/*! bootstrap3-wysihtml5-bower 2017-12-02 */
define("wysihtml5",["rangy","rangy-selectionsaverestore"],function(a){var b,d;return window.rangy=a,b={version:"0.5.5",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,VOID_ELEMENTS:"area, base, br, col, embed, hr, img, input, keygen, link, meta, param, source, track, wbr",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46},b.polyfills=function(a,b){function c(){try{var a=new CustomEvent("cat",{detail:{foo:"bar"}});return"cat"===a.type&&"bar"===a.detail.foo}catch(a){}return!1}var d,e,f,g,h,i;String.prototype.trim||!function(){var a=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(a,"")}}(),function(){var c="addEventListener",d="removeEventListener";b[c]||(a.Element.prototype[c]=a[c]=b[c]=function(b,c,d){return(d=this).attachEvent("on"+b,function(b){var b=b||a.event;b.target=b.target||b.srcElement,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},b.which=b.button?2===b.button?3:4===b.button?2:b.button:b.keyCode,c.call(d,b)})},a.Element.prototype[d]=a[d]=b[d]=function(a,b){return this.detachEvent("on"+a,b)})}(),Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(a.Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(a.Element.prototype,"textContent").get&&function(){var b=Object.getOwnPropertyDescriptor(a.Element.prototype,"innerText");Object.defineProperty(a.Element.prototype,"textContent",{get:function(){return b.get.call(this)},set:function(a){return b.set.call(this,a)}})}(),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=this.length,d=-1,e=b>>>0;~(c-e);d=this[--c]===a?c:d);return d}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),function(a){a.matches=a.matches||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return!!c[d]},a.closest=a.closest||function(a){for(var b=this;b&&!b.matches(a);)b=b.parentElement;return b}}(Element.prototype),"document"in a&&("classList"in b.createElement("_")?"DOMTokenList"in a&&function(){"use strict";var c,d,e=b.createElement("_");e.classList.add("c1","c2"),e.classList.contains("c2")||(c=function(b){var c=a.DOMTokenList.prototype[b];a.DOMTokenList.prototype[b]=function(a){var b,d=arguments.length;for(b=0;b<d;b++)a=arguments[b],c.call(this,a)}},c("add"),c("remove")),e.classList.toggle("c3",!1),e.classList.contains("c3")&&(d=a.DOMTokenList.prototype.toggle,a.DOMTokenList.prototype.toggle=function(a,b){return 1 in arguments&&!this.contains(a)==!b?b:d.call(this,a)}),e=null}():function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m;if("Element"in a)if(b="classList",c="prototype",d=a.Element[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b=f.call(a.getAttribute("class")||""),c=b?b.split(/\s+/):[],d=0,e=c.length;d<e;d++)this.push(c[d]);this._updateClassName=function(){a.setAttribute("class",""+this)}},k=j[c]=[],l=function(){return new j(this)},h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",-1!==i(this,a)},k.add=function(){var a,b=arguments,c=0,d=b.length,e=!1;do{a=b[c]+"",-1===i(this,a)&&(this.push(a),e=!0)}while(++c<d);e&&this._updateClassName()},k.remove=function(){var a,b,c=arguments,d=0,e=c.length,f=!1;do{for(a=c[d]+"",b=i(this,a);-1!==b;)this.splice(b,1),f=!0,b=i(this,a)}while(++d<e);f&&this._updateClassName()},k.toggle=function(a,b){a+="";var c=this.contains(a),d=c?!0!==b&&"remove":!1!==b&&"add";return d&&this[d](a),!0===b||!1===b?b:!c},k.toString=function(){return this.join(" ")},e.defineProperty){m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(a){-2146823252===a.number&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}(a)),d=function(){if("createRange"in document&&"getSelection"in window){var a,b,c=document.createElement("div"),d=document.createTextNode("a"),e=document.createTextNode("a"),f=document.createTextNode("a"),g=document.createRange();return c.setAttribute("contenteditable","true"),c.appendChild(d),c.appendChild(e),c.appendChild(f),document.body.appendChild(c),g.setStart(e,1),g.setEnd(e,1),a=window.getSelection(),a.removeAllRanges(),a.addRange(g),c.normalize(),a=window.getSelection(),b=1!==c.childNodes.length||a.anchorNode!==c.firstChild||2!==a.anchorOffset,c.parentNode.removeChild(c),a.removeAllRanges(),b}},e=function(a){var b=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?b.push(a):b=b.concat(e(a));return b},f=function(a){var b=a.ownerDocument,c=a;do{if(c===b)return!0;c=c.parentNode}while(c);return!1},g=function(){var a=(Node.prototype.normalize,function(){var a=e(this),b=this.ownerDocument.defaultView.getSelection(),c=b.anchorNode,d=b.anchorOffset,g=c&&1===c.nodeType&&c.childNodes.length>0?c.childNodes[d]:void 0,h=b.focusNode,i=b.focusOffset,j=h&&1===h.nodeType&&i>0?h.childNodes[i-1]:void 0,k=this.ownerDocument.createRange(),l=a.shift(),m=l?a.shift():null;for(j&&3===j.nodeType&&(h=j,i=j.nodeValue.length,j=void 0),g&&3===g.nodeType&&(c=g,d=0,g=void 0),(c===h&&i<d||c!==h&&c.compareDocumentPosition(h)&Node.DOCUMENT_POSITION_PRECEDING&&!(c.compareDocumentPosition(h)&Node.DOCUMENT_POSITION_CONTAINS))&&(h=[c,c=h][0],i=[d,d=i][0]);l&&m;)m.previousSibling&&m.previousSibling===l?(c===m&&(c=l,d=l.nodeValue.length+d),h===m&&(h=l,i=l.nodeValue.length+i),l.nodeValue=l.nodeValue+m.nodeValue,m.parentNode.removeChild(m),m=a.shift()):(l=m,m=a.shift());j&&(i=Array.prototype.indexOf.call(j.parentNode.childNodes,j)+1),g&&(d=Array.prototype.indexOf.call(g.parentNode.childNodes,g)),f(this)&&c&&c.parentNode&&h&&h.parentNode&&(k.setStart(c,d),k.setEnd(h,i),b.removeAllRanges(),b.addRange(k))});Node.prototype.normalize=a},h=function(){window.removeEventListener("load",h),"Node"in window&&"normalize"in Node.prototype&&d()&&g()},"complete"!==b.readyState?window.addEventListener("load",h):h(),i=c(),function(){function c(a,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var d=b.createEvent("CustomEvent");return d.initCustomEvent(a,c.bubbles,c.cancelable,c.detail),d}!i&&"CustomEvent"in window&&(c.prototype=a.Event.prototype,a.CustomEvent=c,i=!0)}()},b.polyfills(window,document),function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a():b.rangy=a()}(function(){function a(a,b){var c=typeof a[b];return c==A||!(c!=z||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=z||!a[b])}function c(a,b){return typeof a[b]!=B}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&G(a,F)&&I(a,E)}function f(a){return b(a,"body")?a.body:a.getElementsByTagName("body")[0]}function g(b){typeof console!=B&&a(console,"log")&&void 0}function h(a,b){L&&b?alert(a):g(a)}function i(a){N.initialized=!0,N.supported=!1,h("Rangy is not supported in this environment. Reason: "+a,N.config.alertOnFail)}function j(a){h("Rangy warning: "+a,N.config.alertOnWarn)}function k(a){return a.message||a.description||a+""}function l(){var b,c,d,h,j,l,m,n,o;if(L&&!N.initialized){if(c=!1,d=!1,a(document,"createRange")&&(b=document.createRange(),G(b,D)&&I(b,C)&&(c=!0)),h=f(document),!h||"body"!=h.nodeName.toLowerCase())return i("No body element found"),void 0;if(h&&a(h,"createTextRange")&&(b=h.createTextRange(),e(b)&&(d=!0)),!c&&!d)return i("Neither Range nor TextRange are available"),void 0;N.initialized=!0,N.features={implementsDomRange:c,implementsTextRange:d};for(m in K)(j=K[m])instanceof p&&j.init(j,N);for(n=0,o=v.length;n<o;++n)try{v[n](N)}catch(a){l="Rangy init listener threw an exception. Continuing. Detail: "+k(a),g(l)}}}function m(a,b,c){c&&(a+=" in module "+c.name),N.warn("DEPRECATED: "+a+" is deprecated. Please use "+b+" instead.")}function n(a,b,c,d){a[b]=function(){return m(b,c,d),a[c].apply(a,M.toArray(arguments))}}function o(a){a=a||window,l();for(var b=0,c=w.length;b<c;++b)w[b](a)}function p(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function q(a,b,c){var d=new p(a,b,function(b){if(!b.initialized){b.initialized=!0;try{c(N,b),b.supported=!0}catch(b){var d="Module '"+a+"' failed to load: "+k(b);g(d),b.stack&&g(b.stack)}}});return K[a]=d,d}function r(){}function s(){}var t,u,v,w,x,y,z="object",A="function",B="undefined",C=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],D=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],E=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],F=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],G=d(a),H=d(b),I=d(c),J=[].forEach?function(a,b){a.forEach(b)}:function(a,b){for(var c=0,d=a.length;c<d;++c)b(a[c],c)},K={},L=typeof window!=B&&typeof document!=B,M={isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:G,areHostObjects:H,areHostProperties:I,isTextRange:e,getBody:f,forEach:J},N={version:"1.3.0",initialized:!1,isBrowser:L,supported:!0,util:M,features:{},modules:K,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==B||rangyAutoInitialize}};return N.fail=i,N.warn=j,!{}.hasOwnProperty?i("hasOwnProperty not supported"):(M.extend=t=function(a,b,c){var d,e,f;for(f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&t(d,e,!0),a[f]=e);return b.hasOwnProperty("toString")&&(a.toString=b.toString),a},M.createOptions=function(a,b){var c={};return t(c,b),a&&t(c,a),c}),L||i("Rangy can only run in a browser"),function(){var a,b,c;if(L){b=document.createElement("div"),b.appendChild(document.createElement("span")),c=[].slice;try{1==c.call(b.childNodes,0)[0].nodeType&&(a=function(a){return c.call(a,0)})}catch(a){}}a||(a=function(a){var b,c,d=[];for(b=0,c=a.length;b<c;++b)d[b]=a[b];return d}),M.toArray=a}(),L&&(a(document,"addEventListener")?u=function(a,b,c){a.addEventListener(b,c,!1)}:a(document,"attachEvent")?u=function(a,b,c){a.attachEvent("on"+b,c)}:i("Document does not have required addEventListener or attachEvent method"),M.addListener=u),v=[],M.deprecationNotice=m,M.createAliasForDeprecatedMethod=n,N.init=l,N.addInitListener=function(a){N.initialized?a(N):v.push(a)},w=[],N.addShimListener=function(a){w.push(a)},L&&(N.shim=N.createMissingNativeApi=o,n(N,"createMissingNativeApi","shim")),p.prototype={init:function(){var a,b,c,d,e=this.dependencies||[];for(a=0,b=e.length;a<b;++a){if(d=e[a],c=K[d],!(c&&c instanceof p))throw Error("required module '"+d+"' not found");if(c.init(),!c.supported)throw Error("required module '"+d+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,Error(a)},warn:function(a){N.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){N.warn("DEPRECATED: "+a+" in module "+this.name+" is deprecated. Please use "+b+" instead")},createError:function(a){return Error("Error in Rangy "+this.name+" module: "+a)}},N.createModule=function(a){var b,c,d;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]),d=q(a,c,b),N.initialized&&N.supported&&d.init()},N.createCoreModule=function(a,b,c){q(a,b,c)},N.RangePrototype=r,N.rangePrototype=new r,N.selectionPrototype=new s,N.createCoreModule("DomUtil",[],function(a,b){function c(a){var b;return typeof a.namespaceURI==K||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)++b;return b}function f(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(H(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b){return h(a,b,!0)}function j(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function k(a){var b=a.nodeType;return 3==b||4==b||8==b}function l(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function m(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function n(a,b,c){var d,f,g=a.cloneNode(!1);if(g.deleteData(0,b),a.deleteData(b,a.length-b),m(g,a),c)for(d=0;f=c[d++];)f.node==a&&f.offset>b?(f.node=g,f.offset-=b):f.node==a.parentNode&&f.offset>e(a)&&++f.offset;return g}function o(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=K)return a.ownerDocument;if(typeof a.document!=K)return a.document;if(a.parentNode)return o(a.parentNode);throw b.createError("getDocument: no document found for node")}function p(a){var c=o(a);if(typeof c.defaultView!=K)return c.defaultView;if(typeof c.parentWindow!=K)return c.parentWindow;throw b.createError("Cannot get a window object for node")}function q(a){if(typeof a.contentDocument!=K)return a.contentDocument;if(typeof a.contentWindow!=K)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function r(a){if(typeof a.contentWindow!=K)return a.contentWindow;if(typeof a.contentDocument!=K)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function s(a){return a&&L.isHostMethod(a,"setTimeout")&&L.isHostObject(a,"document")}function t(a,b,c){var d;if(a?L.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?q(a):o(a):s(a)&&(d=a.document):d=document,!d)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return d}function u(a){for(var b;b=a.parentNode;)a=b;return a}function v(a,c,d,f){var h,i,k,l,m;if(a==d)return c===f?0:c<f?-1:1;if(h=j(d,a,!0))return c<=e(h)?-1:1;if(h=j(a,d,!0))return e(h)<f?-1:1;if(i=g(a,d),!i)throw Error("comparePoints error: nodes have no common ancestor");if(k=a===i?i:j(a,i,!0),l=d===i?i:j(d,i,!0),k===l)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(m=i.firstChild;m;){if(m===k)return-1;if(m===l)return 1;m=m.nextSibling}}function w(a){try{return a.parentNode,!1}catch(a){return!0}}function x(a){if(!a)return"[No node]";if(I&&w(a))return"[Broken node]";if(k(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">[index:"+e(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function y(a){for(var b,c=o(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function z(a,b,c){var d,e=M(a),f=a.createElement("div");return f.contentEditable=""+!!c,b&&(f.innerHTML=b),d=e.firstChild,d?e.insertBefore(f,d):e.appendChild(f),f}function A(a){return a.parentNode.removeChild(a)}function B(a){this.root=a,this._next=a}function C(a){return new B(a)}function D(a,b){this.node=a,this.offset=b}function E(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var F,G,H,I,J,K="undefined",L=a.util,M=L.getBody;L.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),L.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method"),F=document.createElement("div"),L.areHostMethods(F,["insertBefore","appendChild","cloneNode"]||!L.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),L.isHostProperty(F,"innerHTML")||b.fail("Element is missing innerHTML property"),G=document.createTextNode("test"),L.areHostMethods(G,["splitText","deleteData","insertData","appendData","cloneNode"]||!L.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"])||!L.areHostProperties(G,["data"]))||b.fail("Incomplete Text Node implementation"),H=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},I=!1,function(){var b,c=document.createElement("b");c.innerHTML="1",b=c.firstChild,c.innerHTML="<br />",I=w(b),a.features.crashyTextNodes=I}(),typeof window.getComputedStyle!=K?J=function(a,b){return p(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=K?J=function(a,b){return a.currentStyle?a.currentStyle[b]:""}:b.fail("No means of obtaining computed style properties found"),B.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild,a)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},D.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},E.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},E.prototype.toString=function(){return this.message},a.dom={arrayContains:H,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,isOrIsAncestorOf:i,getClosestAncestorIn:j,isCharacterDataNode:k,isTextOrCommentNode:l,insertAfter:m,splitDataNode:n,getDocument:o,getWindow:p,getIframeWindow:r,getIframeDocument:q,getBody:M,isWindow:s,getContentDocument:t,getRootContainer:u,comparePoints:v,isBrokenNode:w,inspectNode:x,getComputedStyleProperty:J,createTestElement:z,removeNode:A,fragmentFromNodeChildren:y,createIterator:C,DomPosition:D},a.DOMException=E}),N.createCoreModule("DomRange",["DomUtil"],function(a,b){function c(a,b){return 3!=a.nodeType&&(ha(a,b.startContainer)||ha(a,b.endContainer))}function d(a){return a.document||ia(a.startContainer)}function e(a){return oa(a.startContainer)}function f(a){return new da(a.parentNode,ga(a))}function g(a){return new da(a.parentNode,ga(a)+1)}function h(a,b,c){var d=11==a.nodeType?a.firstChild:a;return fa(b)?c==b.length?ba.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:ka(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function i(a,b,c){if(z(a),z(b),d(b)!=d(a))throw new ea("WRONG_DOCUMENT_ERR");var e=ja(a.startContainer,a.startOffset,b.endContainer,b.endOffset),f=ja(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return c?e<=0&&f>=0:e<0&&f>0}function j(a){var b,c,e,f;for(e=d(a.range).createDocumentFragment();c=a.next();){if(b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(f=a.getSubtreeIterator(),c.appendChild(j(f)),f.detach()),10==c.nodeType)throw new ea("HIERARCHY_REQUEST_ERR");e.appendChild(c)}return e}function k(a,b,c){var d,e,f,g;for(c=c||{stop:!1};f=a.next();)if(a.isPartiallySelectedSubtree()){if(!1===b(f))return c.stop=!0,void 0;if(g=a.getSubtreeIterator(),k(g,b,c),g.detach(),c.stop)return}else for(d=ba.createIterator(f);e=d.next();)if(!1===b(e))return c.stop=!0,void 0}function l(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),l(b),b.detach()):a.remove()}function m(a){for(var b,c,e=d(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),c=a.getSubtreeIterator(),b.appendChild(m(c)),c.detach()):a.remove(),10==b.nodeType)throw new ea("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function n(a,b,c){var d,e,f=!(!b||!b.length),g=!!c;return f&&(d=RegExp("^("+b.join("|")+")$")),e=[],k(new p(a,!1),function(b){var h,i;f&&!d.test(b.nodeType)||g&&!c(b)||(h=a.startContainer,b==h&&fa(h)&&a.startOffset==h.length||(i=a.endContainer,b==i&&fa(i)&&0==a.endOffset||e.push(b)))}),e}function o(a){return"["+(void 0===a.getName?"Range":a.getName())+"("+ba.inspectNode(a.startContainer)+":"+a.startOffset+", "+ba.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function p(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&fa(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||fa(this.sc)?la(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||fa(this.ec)?la(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function q(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,na(a,d))return e;e=e.parentNode}return null}}function r(a,b){if(Q(a,b))throw new ea("INVALID_NODE_TYPE_ERR")}function s(a,b){if(!na(b,a.nodeType))throw new ea("INVALID_NODE_TYPE_ERR")}function t(a,b){if(b<0||b>(fa(a)?a.length:a.childNodes.length))throw new ea("INDEX_SIZE_ERR")}function u(a,b){if(O(a,!0)!==O(b,!0))throw new ea("WRONG_DOCUMENT_ERR")}function v(a){if(P(a,!0))throw new ea("NO_MODIFICATION_ALLOWED_ERR")}function w(a,b){if(!a)throw new ea(b)}function x(a,b){return b<=(fa(a)?a.length:a.childNodes.length)}function y(a){return!!a.startContainer&&!!a.endContainer&&!(pa&&(ba.isBrokenNode(a.startContainer)||ba.isBrokenNode(a.endContainer)))&&oa(a.startContainer)==oa(a.endContainer)&&x(a.startContainer,a.startOffset)&&x(a.endContainer,a.endOffset)}function z(a){if(!y(a))throw Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+a.inspect()+")")}function A(a,b){var c,d,e,f,g;z(a),c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,g=c===e,fa(e)&&f>0&&f<e.length&&ka(e,f,b),fa(c)&&d>0&&d<c.length&&(c=ka(c,d,b),g?(f-=d,e=c):e==c.parentNode&&f>=ga(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function B(a){z(a);var b=a.commonAncestorContainer.parentNode.cloneNode(!1);return b.appendChild(a.cloneContents()),b.innerHTML}function C(a){a.START_TO_START=V,a.START_TO_END=W,a.END_TO_END=X,a.END_TO_START=Y,a.NODE_BEFORE=Z,a.NODE_AFTER=$,a.NODE_BEFORE_AND_AFTER=_,a.NODE_INSIDE=aa}function D(a){C(a),C(a.prototype)}function E(a,b){return function(){var c,d,e,f,h,i,j;return z(this),c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,f=new p(this,!0),c!==e&&(h=la(c,e,!0),i=g(h),c=i.node,d=i.offset),k(f,v),f.reset(),j=a(f),f.detach(),b(this,c,d,c,d),j}}function F(b,d){function e(a,b){return function(c){s(c,J),s(oa(c),K);var d=(a?f:g)(c);(b?h:i)(this,d.node,d.offset)}}function h(a,b,c){var e=a.endContainer,f=a.endOffset;b===a.startContainer&&c===a.startOffset||(oa(b)==oa(e)&&1!=ja(b,c,e,f)||(e=b,f=c),d(a,b,c,e,f))}function i(a,b,c){var e=a.startContainer,f=a.startOffset;b===a.endContainer&&c===a.endOffset||(oa(b)==oa(e)&&-1!=ja(b,c,e,f)||(e=b,f=c),d(a,e,f,b,c))}var j=function(){};j.prototype=a.rangePrototype,b.prototype=new j,ca.extend(b.prototype,{setStart:function(a,b){r(a,!0),t(a,b),h(this,a,b)},setEnd:function(a,b){r(a,!0),t(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],c=a[1],e=b,f=c;switch(a.length){case 3:f=a[2];break;case 4:e=a[2],f=a[3]}d(this,b,c,e,f)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(a){z(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(a,!0),d(this,a,0,a,ma(a))},selectNode:function(a){r(a,!1),s(a,J);var b=f(a),c=g(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:E(m,d),deleteContents:E(l,d),canSurroundContents:function(){var a,b;return z(this),v(this.startContainer),v(this.endContainer),a=new p(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this),a.detach(),!b},splitBoundaries:function(){A(this)},splitBoundariesPreservingPositions:function(a){A(this,a)},normalizeBoundaries:function(){var a,b,c,e,f,g,h,i,j,k;z(this),a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,e=a.length,a.appendData(b.data),qa(b))},g=function(d){var f,g,h=d.previousSibling;h&&h.nodeType==d.nodeType&&(a=d,f=d.length,b=h.length,d.insertData(0,h.data),qa(h),a==c?(e+=b,c=a):c==d.parentNode&&(g=ga(d),e==g?(c=d,e=f):e>g&&e--))},h=!0,fa(c)?e==c.length?f(c):0==e&&(i=c.previousSibling,i&&i.nodeType==c.nodeType&&(e=i.length,a==c&&(h=!1),i.appendData(c.data),qa(c),c=i)):(e>0&&(j=c.childNodes[e-1],j&&fa(j)&&f(j)),h=!this.collapsed),h?fa(a)?0==b?g(a):b==a.length&&(i=a.nextSibling,i&&i.nodeType==a.nodeType&&(c==i&&(c=a,e+=a.length),a.appendData(i.data),qa(i))):b<a.childNodes.length&&(k=a.childNodes[b],k&&fa(k)&&g(k)):(a=c,b=e),d(this,a,b,c,e)},collapseToPoint:function(a,b){r(a,!0),t(a,b),this.setStartAndEnd(a,b)}}),D(b)}function G(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:ba.getCommonAncestor(a.startContainer,a.endContainer)}function H(a,b,c,d,e){a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,a.document=ba.getDocument(b),G(a)}function I(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,G(this)}var J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba=a.dom,ca=a.util,da=ba.DomPosition,ea=a.DOMException,fa=ba.isCharacterDataNode,ga=ba.getNodeIndex,ha=ba.isOrIsAncestorOf,ia=ba.getDocument,ja=ba.comparePoints,ka=ba.splitDataNode,la=ba.getClosestAncestorIn,ma=ba.getNodeLength,na=ba.arrayContains,oa=ba.getRootContainer,pa=a.features.crashyTextNodes,qa=ba.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,fa(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!fa(c)||c!==this.sc&&c!==this.ec?c.parentNode&&qa(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){return c(this._current,this.range)},getSubtreeIterator:function(){var a,b,c,e,f,g;return this.isSingleCharacterDataNode?(a=this.range.cloneRange(),a.collapse(!1)):(a=new I(d(this.range)),b=this._current,c=b,e=0,f=b,g=ma(b),ha(b,this.sc)&&(c=this.sc,e=this.so),ha(b,this.ec)&&(f=this.ec,g=this.eo),H(a,c,e,f,g)),new p(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},J=[1,3,4,5,7,8,10],K=[2,9,11],L=[5,6,10,12],M=[1,3,4,5,7,8,10,11],N=[1,3,4,5,7,8],O=q([9,11]),P=q(L),Q=q([6,10,12]),R=document.createElement("style"),S=!1;try{R.innerHTML="<b>x</b>",S=3==R.firstChild.nodeType}catch(a){}a.features.htmlParsingConforms=S,T=S?function(a){var b,c=this.startContainer,d=ia(c);if(!c)throw new ea("INVALID_STATE_ERR");return b=null,1==c.nodeType?b=c:fa(c)&&(b=ba.parentElement(c)),b=null===b||"HTML"==b.nodeName&&ba.isHtmlNamespace(ia(b).documentElement)&&ba.isHtmlNamespace(b)?d.createElement("body"):b.cloneNode(!1),b.innerHTML=a,ba.fragmentFromNodeChildren(b)}:function(a){var b=d(this),c=b.createElement("body");return c.innerHTML=a,ba.fragmentFromNodeChildren(c)},U=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],V=0,W=1,X=2,Y=3,Z=0,$=1,_=2,aa=3,ca.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){var c,d,e,f,g,h;return z(this),u(this.startContainer,b.startContainer),g=a==Y||a==V?"start":"end",h=a==W||a==V?"start":"end",c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],ja(c,d,e,f)},insertNode:function(a){if(z(this),s(a,M),v(this.startContainer),ha(a,this.startContainer))throw new ea("HIERARCHY_REQUEST_ERR");var b=h(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){var a,b,c;return z(this),this.collapsed?d(this).createDocumentFragment():this.startContainer===this.endContainer&&fa(this.startContainer)?(a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=d(this).createDocumentFragment(),b.appendChild(a),b):(c=new p(this,!0),a=j(c),c.detach(),a)},canSurroundContents:function(){var a,b;return z(this),v(this.startContainer),v(this.endContainer),a=new p(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this),a.detach(),!b},surroundContents:function(a){if(s(a,N),!this.canSurroundContents())throw new ea("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);h(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){var a,b,c;for(z(this),a=new I(d(this)),b=U.length;b--;)c=U[b],a[c]=this[c];return a},toString:function(){var a,b,c;return z(this),a=this.startContainer,a===this.endContainer&&fa(a)?3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"":(b=[],c=new p(this,!0),k(c,function(a){3!=a.nodeType&&4!=a.nodeType||b.push(a.data)}),c.detach(),b.join(""))},compareNode:function(a){var b,c,d,e;if(z(this),b=a.parentNode,c=ga(a),!b)throw new ea("NOT_FOUND_ERR");return d=this.comparePoint(b,c),e=this.comparePoint(b,c+1),d<0?e>0?_:Z:e>0?$:aa},comparePoint:function(a,b){return z(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),ja(a,b,this.startContainer,this.startOffset)<0?-1:ja(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:T,toHtml:function(){return B(this)},intersectsNode:function(a,b){var c,d,f,g;return z(this),oa(a)==e(this)&&(c=a.parentNode,d=ga(a),!c||(f=ja(c,d,this.endContainer,this.endOffset),g=ja(c,d+1,this.startContainer,this.startOffset),b?f<=0&&g>=0:f<0&&g>0))},isPointInRange:function(a,b){return z(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),ja(a,b,this.startContainer,this.startOffset)>=0&&ja(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return i(this,a,!1)},intersectsOrTouchesRange:function(a){return i(this,a,!0)},intersection:function(a){var b,c,d;return this.intersectsRange(a)?(b=ja(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=ja(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange(),-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d):null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return-1==ja(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==ja(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new ea("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==aa},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,ma(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b,c,d=this.cloneRange();return d.selectNode(a),b=d.getNodes([3]),b.length>0?(d.setStart(b[0],0),c=b.pop(),d.setEnd(c,c.length),this.containsRange(d)):this.containsNodeContents(a)},getNodes:function(a,b){return z(this),n(this,a,b)},getDocument:function(){return d(this)},collapseBefore:function(a){this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var c,e,f,g=d(this),h=a.createRange(g);return b=b||ba.getBody(g),h.selectNodeContents(b),c=this.intersection(h),e=0,f=0,c&&(h.setEnd(c.startContainer,c.startOffset),e=(""+h).length,f=e+(""+c).length),{start:e,end:f,containerNode:b}},moveToBookmark:function(a){var b,c,d,e,f,g,h,i=a.containerNode,j=0;for(this.setStart(i,0),this.collapse(!0),b=[i],d=!1,e=!1;!e&&(c=b.pop());)if(3==c.nodeType)f=j+c.length,!d&&a.start>=j&&a.start<=f&&(this.setStart(c,a.start-j),d=!0),d&&a.end>=j&&a.end<=f&&(this.setEnd(c,a.end-j),e=!0),j=f;else for(h=c.childNodes,g=h.length;g--;)b.push(h[g])},getName:function(){return"DomRange"},equals:function(a){return I.rangesEqual(this,a)},isValid:function(){return y(this)},inspect:function(){return o(this)},detach:function(){}}),F(I,H),ca.extend(I,{rangeProperties:U,RangeIterator:p,copyComparisonConstants:D,createPrototypeRange:F,inspect:o,toHtml:B,getRangeDocument:d,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=I}),N.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e,f,g,h,i,j,k=a.dom,l=a.util,m=k.DomPosition,n=a.DomRange,o=k.getBody,p=k.getContentDocument,q=k.isCharacterDataNode;a.features.implementsDomRange&&!function(){function d(a){for(var b,c=s.length;c--;)b=s[c],a[b]=a.nativeRange[b];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function e(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}var f,g,h,i,j,m,q,r,s=n.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,d(this)},n.createPrototypeRange(c,e),f=c.prototype,f.selectNode=function(a){this.nativeRange.selectNode(a),d(this)},f.cloneContents=function(){return this.nativeRange.cloneContents()},f.surroundContents=function(a){this.nativeRange.surroundContents(a),d(this)},f.collapse=function(a){this.nativeRange.collapse(a),d(this)},f.cloneRange=function(){return new c(this.nativeRange.cloneRange())},f.refresh=function(){d(this)},f.toString=function(){return""+this.nativeRange},h=document.createTextNode("test"),o(document).appendChild(h),i=document.createRange(),i.setStart(h,0),i.setEnd(h,0);try{i.setStart(h,1),f.setStart=function(a,b){this.nativeRange.setStart(a,b),d(this)},f.setEnd=function(a,b){this.nativeRange.setEnd(a,b),d(this)},g=function(a){return function(b){this.nativeRange[a](b),d(this)}}}catch(a){f.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}d(this)},f.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}d(this)},g=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}d(this)}}}f.setStartBefore=g("setStartBefore","setEndBefore"),f.setStartAfter=g("setStartAfter","setEndAfter"),f.setEndBefore=g("setEndBefore","setStartBefore"),f.setEndAfter=g("setEndAfter","setStartAfter"),f.selectNodeContents=function(a){this.setStartAndEnd(a,0,k.getNodeLength(a))},i.selectNodeContents(h),i.setEnd(h,3),j=document.createRange(),j.selectNodeContents(h),j.setEnd(h,4),j.setStart(h,2),-1==i.compareBoundaryPoints(i.START_TO_END,j)&&1==i.compareBoundaryPoints(i.END_TO_START,j)?f.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:f.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},m=document.createElement("div"),m.innerHTML="123",q=m.firstChild,r=o(document),r.appendChild(m),i.setStart(q,1),i.setEnd(q,2),i.deleteContents(),"13"==q.data&&(f.deleteContents=function(){this.nativeRange.deleteContents(),d(this)},f.extractContents=function(){var a=this.nativeRange.extractContents();return d(this),a}),r.removeChild(m),r=null,l.isHostMethod(i,"createContextualFragment")&&(f.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),o(document).removeChild(h),f.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=p(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange&&(e=function(a){var b,c,d,e=a.parentElement(),f=a.duplicate();return f.collapse(!0),b=f.parentElement(),f=a.duplicate(),f.collapse(!1),c=f.parentElement(),d=b==c?b:k.getCommonAncestor(b,c),d==e?d:k.getCommonAncestor(e,d)},f=function(a){return 0==a.compareEndPoints("StartToEnd",a)},g=function(a,b,c,d,e){var f,g,h,i,j,l,n,o,p,r,s,t,u,v,w,x,y=a.duplicate();if(y.collapse(c),f=y.parentElement(),k.isOrIsAncestorOf(b,f)||(f=b),!f.canHaveHTML)return g=new m(f.parentNode,k.getNodeIndex(f)),{boundaryPosition:g,nodeInfo:{nodeIndex:g.offset,containerElement:g.node}};for(h=k.getDocument(f).createElement("span"),h.parentNode&&k.removeNode(h),j=c?"StartToStart":"StartToEnd",r=e&&e.containerElement==f?e.nodeIndex:0,s=f.childNodes.length,t=s,u=t;;){if(u==s?f.appendChild(h):f.insertBefore(h,f.childNodes[u]),y.moveToElementText(h),i=y.compareEndPoints(j,a),0==i||r==t)break;if(-1==i){if(t==r+1)break;r=u}else t=t==r+1?r:u;u=Math.floor((r+t)/2),f.removeChild(h)}if(p=h.nextSibling,-1==i&&p&&q(p)){if(y.setEndPoint(c?"EndToStart":"EndToEnd",a),/[\r\n]/.test(p.data))for(w=y.duplicate(),x=w.text.replace(/\r\n/g,"\r").length,v=w.moveStart("character",x);-1==(i=w.compareEndPoints("StartToEnd",w));)v++,w.moveStart("character",1);else v=y.text.length;o=new m(p,v)}else l=(d||!c)&&h.previousSibling,n=(d||c)&&h.nextSibling,o=n&&q(n)?new m(n,0):l&&q(l)?new m(l,l.data.length):new m(f,k.getNodeIndex(h));return k.removeNode(h),{boundaryPosition:o,nodeInfo:{nodeIndex:u,containerElement:f}}},h=function(a,b){var c,d,e,f,g=a.offset,h=k.getDocument(a.node),i=o(h).createTextRange(),j=q(a.node);return j?(c=a.node,d=c.parentNode):(f=a.node.childNodes,c=g<f.length?f[g]:null,d=a.node),e=h.createElement("span"),e.innerHTML="&#feff;",c?d.insertBefore(e,c):d.appendChild(e),i.moveToElementText(e),i.collapse(!b),d.removeChild(e),j&&i[b?"moveStart":"moveEnd"]("character",g),i},d=function(a){this.textRange=a,this.refresh()},d.prototype=new n(document),d.prototype.refresh=function(){var a,b,c,d=e(this.textRange);f(this.textRange)?b=a=g(this.textRange,d,!0,!0).boundaryPosition:(c=g(this.textRange,d,!0,!1),a=c.boundaryPosition,b=g(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},n.copyComparisonConstants(d),i=function(a){var b,c,d;return a.collapsed?h(new m(a.startContainer,a.startOffset),!0):(b=h(new m(a.startContainer,a.startOffset),!0),c=h(new m(a.endContainer,a.endOffset),!1),d=o(n.getRangeDocument(a)).createTextRange(),d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d)},d.rangeToTextRange=i,d.prototype.toTextRange=function(){return i(this)},a.WrappedTextRange=d,a.features.implementsDomRange&&!a.config.preferTextRange||(j=function(a){return a("return this;")()}(Function),void 0===j.Range&&(j.Range=d),a.createNativeRange=function(a){return a=p(a,b,"createNativeRange"),o(a).createTextRange()},a.WrappedRange=d)),a.createRange=function(c){return c=p(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=p(a,b,"createRangyRange"),new n(a)},l.createAliasForDeprecatedMethod(a,"createIframeRange","createRange"),l.createAliasForDeprecatedMethod(a,"createIframeRangyRange","createRangyRange"),a.addShimListener(function(b){var c=b.document;void 0===c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),N.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function c(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function d(a,c){if(a){if(A.isWindow(a))return a;if(a instanceof r)return a.win;var d=A.getContentDocument(a,b,c);return A.getWindow(d)}return window}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function g(a){var b=!1;return a.anchorNode&&(b=1==A.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function h(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function i(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function j(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function k(b){var c;return b instanceof D?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof E?c=b.nativeRange:J.implementsDomRange&&b instanceof A.getWindow(b.startContainer).Range&&(c=b),c}function l(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;b<c;++b)if(!A.isAncestorOf(a[0],a[b]))return!1;return!0}function m(a){var c=a.getNodes();if(!l(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function n(a){return!!a&&void 0!==a.text}function o(a,b){var c=new E(b);a._ranges=[c],h(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function p(b){var c,d,e,f;if(b._ranges.length=0,"None"==b.docSelection.type)j(b);else if(c=b.docSelection.createRange(),n(c))o(b,c);else{for(b.rangeCount=c.length,e=L(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,h(b,b._ranges[b.rangeCount-1],!1)}}function q(a,c){var d,e,f=a.docSelection.createRange(),g=m(c),h=L(f.item(0)),i=M(h).createControlRange();for(d=0,e=f.length;d<e;++d)i.add(f.item(d));try{i.add(g)}catch(a){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select(),p(a)}function r(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function s(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function t(a,b){for(var c,d,e=ba.length;e--;)if(c=ba[e],d=c.selection,"deleteAll"==b)s(d);else if(c.win==a)return"delete"==b?(ba.splice(e,1),!0):d;return"deleteAll"==b&&(ba.length=0),null}function u(a,c){var d,e,f,g=L(c[0].startContainer),h=M(g).createControlRange();for(d=0,f=c.length;d<f;++d){e=m(c[d]);try{h.add(e)}catch(a){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}h.select(),p(a)}function v(a,b){if(a.win.document!=L(b))throw new F("WRONG_DOCUMENT_ERR")}function w(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function x(a){var b,c,d=[],e=new G(a.anchorNode,a.anchorOffset),f=new G(a.focusNode,a.focusOffset),g="function"==typeof a.getName?a.getName():"Selection";if(void 0!==a.rangeCount)for(b=0,c=a.rangeCount;b<c;++b)d[b]=D.inspect(a.getRangeAt(b));return"["+g+"(Ranges: "+d.join(", ")+")(anchor: "+e.inspect()+", focus: "+f.inspect()+"]"}var y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha;if(a.config.checkSelectionRanges=!0,y="boolean",z="number",A=a.dom,B=a.util,C=B.isHostMethod,D=a.DomRange,E=a.WrappedRange,F=a.DOMException,G=A.DomPosition,J=a.features,K="Control",L=A.getDocument,M=A.getBody,N=D.rangesEqual,O=C(window,"getSelection"),P=B.isHostObject(document,"selection"),J.implementsWinGetSelection=O,J.implementsDocSelection=P,Q=P&&(!O||a.config.preferTextRange),Q)H=f,a.isSelectionValid=function(a){var b=d(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||L(c.createRange().parentElement())==b};else{if(!O)return b.fail("Neither document.selection or window.getSelection() detected."),!1;H=e,a.isSelectionValid=function(){return!0}}if(a.getNativeSelection=H,R=H(),!R)return b.fail("Native selection was null (possibly issue 138?)"),!1;if(S=a.createNativeRange(document),T=M(document),U=B.areHostProperties(R,["anchorNode","focusNode","anchorOffset","focusOffset"]),J.selectionHasAnchorAndFocus=U,V=C(R,"extend"),J.selectionHasExtend=V,W=typeof R.rangeCount==z,J.selectionHasRangeCount=W,X=!1,Y=!0,Z=V?function(b,c){var d=D.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(k(e)),b.extend(c.startContainer,c.startOffset)}:null,B.areHostMethods(R,["addRange","getRangeAt","removeAllRanges"])&&typeof R.rangeCount==z&&J.implementsDomRange&&function(){var b,c,d,e,f,h,i,j,k,l,m=window.getSelection();if(m){for(b=m.rangeCount,c=b>1,d=[],e=g(m),f=0;f<b;++f)d[f]=m.getRangeAt(f);for(h=A.createTestElement(document,"",!1),i=h.appendChild(document.createTextNode("   ")),j=document.createRange(),j.setStart(i,1),j.collapse(!0),m.removeAllRanges(),m.addRange(j),Y=1==m.rangeCount,m.removeAllRanges(),c||(k=window.navigator.appVersion.match(/Chrome\/(.*?) /),k&&parseInt(k[1])>=36?X=!1:(l=j.cloneRange(),j.setStart(i,0),l.setEnd(i,3),l.setStart(i,2),m.addRange(j),m.addRange(l),X=2==m.rangeCount)),A.removeNode(h),m.removeAllRanges(),f=0;f<b;++f)0==f&&e?Z?Z(m,d[f]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),m.addRange(d[f])):m.addRange(d[f])}}(),J.selectionSupportsMultipleRanges=X,J.collapsedNonEditableSelectionsSupported=Y,$=!1,T&&C(T,"createControlRange")&&(_=T.createControlRange(),B.areHostProperties(_,["item","add"])&&($=!0)),J.implementsControlRange=$,I=U?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return!!a.rangeCount&&a.getRangeAt(a.rangeCount-1).collapsed},C(R,"getRangeAt")?aa=function(a,b){try{return a.getRangeAt(b)}catch(a){return null}}:U&&(aa=function(b){var c=L(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),r.prototype=a.selectionPrototype,ba=[],ca=function(a){var b,c,e;return a&&a instanceof r?(a.refresh(),a):(a=d(a,"getNativeSelection"),b=t(a),c=H(a),e=P?f(a):null,b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new r(c,e,a),ba.push({win:a,selection:b})),b)},a.getSelection=ca,B.createAliasForDeprecatedMethod(a,"getIframeSelection","getSelection"),da=r.prototype,!Q&&U&&B.areHostMethods(R,["removeAllRanges","addRange"]))da.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),j(this)},ea=function(a,b){Z(a.nativeSelection,b),a.refresh()},da.addRange=W?function(b,d){var e,f,g;if($&&P&&this.docSelection.type==K)q(this,b);else if(c(d)&&V)ea(this,b);else{X?e=this.rangeCount:(this.removeAllRanges(),e=0),f=k(b).cloneRange();try{this.nativeSelection.addRange(f)}catch(a){}this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==e+1?(a.config.checkSelectionRanges&&(g=aa(this.nativeSelection,this.rangeCount-1),g&&!N(g,b)&&(b=new E(g))),this._ranges[this.rangeCount-1]=b,h(this,b,ha(this.nativeSelection)),this.isCollapsed=I(this)):this.refresh()}}:function(a,b){c(b)&&V?ea(this,a):(this.nativeSelection.addRange(k(a)),this.refresh())},da.setRanges=function(a){if($&&P&&a.length>1)u(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}};else{if(!(C(R,"empty")&&C(S,"select")&&$&&Q))return b.fail("No means of selecting a Range or TextRange was found"),!1;da.removeAllRanges=function(){var a,b,c;try{this.docSelection.empty(),"None"!=this.docSelection.type&&(this.anchorNode?a=L(this.anchorNode):this.docSelection.type==K&&(b=this.docSelection.createRange(),b.length&&(a=L(b.item(0)))),a&&(c=M(a).createTextRange(),c.select(),this.docSelection.empty()))}catch(a){}j(this)},da.addRange=function(b){this.docSelection.type==K?q(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,h(this,b,!1))},da.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?u(this,a):b&&this.addRange(a[0])}}if(da.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new F("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()},Q)fa=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=M(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==K?p(b):n(c)?o(b,c):j(b)};else if(C(R,"getRangeAt")&&typeof R.rangeCount==z)fa=function(b){if($&&P&&b.docSelection.type==K)p(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));h(b,b._ranges[b.rangeCount-1],ha(b.nativeSelection)),b.isCollapsed=I(b)}else j(b)};else{if(!U||typeof R.isCollapsed!=y||typeof S.collapsed!=y||!J.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;fa=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=aa(c,0),a._ranges=[b],a.rangeCount=1,i(a),a.isCollapsed=I(a)):j(a)}}da.refresh=function(a){var b,c=a?this._ranges.slice(0):null,d=this.anchorNode,e=this.anchorOffset;if(fa(this),a){if(b=c.length,b!=this._ranges.length)return!0;if(this.anchorNode!=d||this.anchorOffset!=e)return!0;for(;b--;)if(!N(c[b],this._ranges[b]))return!0;return!1}},ga=function(a,b){var c,d,e=a.getAllRanges();for(a.removeAllRanges(),c=0,d=e.length;c<d;++c)N(b,e[c])||a.addRange(e[c]);a.rangeCount||j(a)},da.removeRange=$&&P?function(a){var b,c,d,e,f,g,h,i;if(this.docSelection.type==K){for(b=this.docSelection.createRange(),c=m(a),d=L(b.item(0)),e=M(d).createControlRange(),g=!1,h=0,i=b.length;h<i;++h)f=b.item(h),f!==c||g?e.add(b.item(h)):g=!0;e.select(),p(this)}else ga(this,a)}:function(a){ga(this,a)},!Q&&U&&J.implementsDomRange?(ha=g,da.isBackward=function(){return ha(this)}):ha=da.isBackward=function(){return!1},da.isBackwards=da.isBackward,da.toString=function(){var a,b,c=[];for(a=0,b=this.rangeCount;a<b;++a)c[a]=""+this._ranges[a];return c.join("")},da.collapse=function(b,c){v(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},da.collapseToStart=function(){if(!this.rangeCount)throw new F("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},da.collapseToEnd=function(){if(!this.rangeCount)throw new F("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},da.selectAllChildren=function(b){v(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},da.deleteFromDocument=function(){var a,b,c,d,e;if($&&P&&this.docSelection.type==K){for(a=this.docSelection.createRange();a.length;)b=a.item(0),a.remove(b),A.removeNode(b);this.refresh()}else if(this.rangeCount&&(c=this.getAllRanges(),c.length)){for(this.removeAllRanges(),d=0,e=c.length;d<e;++d)c[d].deleteContents();this.addRange(c[e-1])}},da.eachRange=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(a(this.getRangeAt(c)))return b},da.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},da.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},da.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b||[]))}),c},da.setStart=w(!0),da.setEnd=w(!1),a.rangePrototype.select=function(a){ca(this.getDocument()).setSingleRange(this,a)},da.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},da.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1},da.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},da.moveToBookmark=function(b){var c,d,e,f=[];for(c=0;d=b.rangeBookmarks[c++];)e=a.createRange(this.win),e.moveToBookmark(d),f.push(e);b.backward?this.setSingleRange(f[0],"backward"):this.setRanges(f)},da.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},da.restoreRanges=function(a){this.removeAllRanges();for(var b,c=0;b=a.ranges[c];++c)this.addRange(b,a.backward&&0==c)},da.toHtml=function(){var a=[];return this.eachRange(function(b){a.push(D.toHtml(b))}),a.join("")},J.implementsTextRange&&(da.getNativeTextRange=function(){var c,d;if(c=this.docSelection){if(d=c.createRange(),n(d))return d;throw b.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range")}),da.getName=function(){return"WrappedSelection"},da.inspect=function(){return x(this)},da.detach=function(){t(this.win,"delete"),s(this)},r.detachAll=function(){t(null,"deleteAll")},r.inspect=x,r.isDirectionBackward=c,a.Selection=r,a.selectionPrototype=da,a.addShimListener(function(a){void 0===a.getSelection&&(a.getSelection=function(){return ca(a)}),a=null})}),x=!1,y=function(a){x||(x=!0,!N.initialized&&N.config.autoInitialize&&l())},L&&("complete"==document.readyState?y():(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",y,!1),u(window,"load",y))),N},this),function(a,b){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(b.rangy)}(function(a){return a.createModule("TextRange",["WrappedSelection"],function(a,b){function c(a,b){function c(a,b,c){h.push({start:a,end:b,isWord:c})}for(var d,e,f,g=a.join(""),h=[],i=0;d=b.wordRegex.exec(g);){if(e=d.index,f=e+d[0].length,e>i&&c(i,e,!1),b.includeTrailingSpace)for(;za.test(a[f]);)++f;c(e,f,!0),i=f}return i<a.length&&c(i,a.length,!1),h}function d(a,b){var c,d,e=a.slice(b.start,b.end),f={isWord:b.isWord,chars:e,toString:function(){return e.join("")}};for(c=0,d=e.length;c<d;++c)e[c].token=f;return f}function e(a,b,c){var e,f,g=c(a,b),h=[];for(e=0;f=g[e++];)h.push(d(a,f));return h}function f(a){var b=a||"",c="string"==typeof b?b.split(""):b;return c.sort(function(a,b){return a.charCodeAt(0)-b.charCodeAt(0)}),c.join("").replace(/(.)\1+/g,"$1")}function g(a){var b,c;return a?(b=a.language||Aa,c={},ta(c,R[b]||R[Aa]),ta(c,a),c):R[Aa]}function h(a,b){var c=ua(a,b);return b.hasOwnProperty("wordOptions")&&(c.wordOptions=g(c.wordOptions)),b.hasOwnProperty("characterOptions")&&(c.characterOptions=ua(c.characterOptions,P)),c}function i(a,b){var c=W(a,"display",b),d=a.tagName.toLowerCase();return"block"==c&&X&&Y.hasOwnProperty(d)?Y[d]:c}function j(a){var b,c,d=o(a);for(b=0,c=d.length;b<c;++b)if(1==d[b].nodeType&&"none"==i(d[b]))return!0;return!1}function k(a){var b;return 3==a.nodeType&&(b=a.parentNode)&&"hidden"==W(b,"visibility")}function l(a){return a&&(1==a.nodeType&&!/^(inline(-block|-table)?|none)$/.test(i(a))||9==a.nodeType||11==a.nodeType)}function m(a){return ra.isCharacterDataNode(a)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(a.nodeName)}function n(a){for(var b=[];a.parentNode;)b.unshift(a.parentNode),a=a.parentNode;return b}function o(a){return n(a).concat([a])}function p(a){for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null}function q(a,b){return!b&&a.hasChildNodes()?a.firstChild:p(a)}function r(a){var b,c=a.previousSibling;if(c){for(a=c;a.hasChildNodes();)a=a.lastChild;return a}return b=a.parentNode,b&&1==b.nodeType?b:null}function s(a){var b,c,d;return!(!a||3!=a.nodeType)&&(b=a.data,""===b||(c=a.parentNode,!(!c||1!=c.nodeType)&&(d=W(a.parentNode,"whiteSpace"),/^[\t\n\r ]+$/.test(b)&&/^(normal|nowrap)$/.test(d)||/^[\t\r ]+$/.test(b)&&"pre-line"==d)))}function t(a){return""===a.data||!!s(a)&&(!a.parentNode||!!j(a))}function u(a){var b=a.nodeType;return 7==b||8==b||j(a)||/^(script|style)$/i.test(a.nodeName)||k(a)||t(a)}function v(a,b){var c=a.nodeType;return 7==c||8==c||1==c&&"none"==i(a,b)}function w(){this.store={}}function x(a,b,c){return function(d){var e,f=this.cache;return f.hasOwnProperty(a)?(Z++,f[a]):($++,e=b.call(this,c?this[c]:this,d),f[a]=e,e)}}function y(a,b){this.node=a,this.session=b,this.cache=new w,this.positions=new w}function z(a,b){this.offset=b,this.nodeWrapper=a,this.node=a.node,this.session=a.session,this.cache=new w}function A(){return"[Position("+ra.inspectNode(this.node)+":"+this.offset+")]"}function B(){return D(),la=new ma}function C(){return la||B()}function D(){la&&la.detach(),la=null}function E(a,c,d,e){function f(){var a=null;return c?(a=g,h||(g=g.previousVisible(),h=!g||d&&g.equals(d))):h||(a=g=g.nextVisible(),h=!g||d&&g.equals(d)),h&&(g=null),a}var g,h,i,j;return d&&(c?u(d.node)&&(d=a.previousVisible()):u(d.node)&&(d=d.nextVisible())),g=a,h=!1,j=!1,{next:function(){if(j)return j=!1,i;for(var a,b;a=f();)if(b=a.getCharacter(e),b)return i=a,a;return null},rewind:function(){if(!i)throw b.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");j=!0},dispose:function(){a=d=null}}}function F(a,b,c){function d(a){for(var b,c,d=[],e=a?f:g,h=!1,i=!1;b=e.next();){if(c=b.character,ya.test(c))i&&(i=!1,h=!0);else{if(h){e.rewind();break}i=!0}d.push(b)}return d}var f=E(a,!1,null,b),g=E(a,!0,null,b),h=c.tokenizer,i=d(!0),j=d(!1).reverse(),k=e(j.concat(i),c,h),l=i.length?k.slice(na(k,i[0].token)):[],m=j.length?k.slice(0,na(k,j.pop().token)+1):[];return{nextEndToken:function(){for(var a,b;1==l.length&&!(a=l[0]).isWord&&(b=d(!0)).length>0;)l=e(a.chars.concat(b),c,h);return l.shift()},previousStartToken:function(){for(var a,b;1==m.length&&!(a=m[0]).isWord&&(b=d(!1)).length>0;)m=e(b.reverse().concat(a.chars),c,h);return m.pop()},dispose:function(){f.dispose(),g.dispose(),l=m=null}}}function G(a,b,c,d,e){var f,g,h,i,j,k,l,m=0,n=a,o=Math.abs(c);if(0!==c){switch(j=c<0,b){case pa:for(g=E(a,j,null,d);(f=g.next())&&m<o;)++m,n=f;h=f,g.dispose();break;case qa:for(k=F(a,d,e),l=j?k.previousStartToken:k.nextEndToken;(i=l())&&m<o;)i.isWord&&(++m,n=j?i.chars[0]:i.chars[i.chars.length-1]);break;default:throw Error("movePositionBy: unit '"+b+"' not implemented")}j?(n=n.previousVisible(),m=-m):n&&n.isLeadingSpace&&!n.isTrailingSpace&&(b==qa&&(g=E(a,!1,null,d),h=g.next(),g.dispose()),h&&(n=h.previousVisible()))}return{position:n,unitsMoved:m}}function H(a,b,c,d){var e=a.getRangeBoundaryPosition(b,!0),f=a.getRangeBoundaryPosition(b,!1);return E(d?f:e,!!d,d?e:f,c)}function I(a,b,c){for(var d,e=[],f=H(a,b,c);d=f.next();)e.push(d);return f.dispose(),e}function J(b,c,d){var e=a.createRange(b.node);return e.setStartAndEnd(b.node,b.offset,c.node,c.offset),!e.expand("word",{wordOptions:d})}function K(a,b,c,d,e){function f(a,b){var c=p[a].previousVisible(),d=p[b-1];return{startPos:c,endPos:d,valid:!e.wholeWordsOnly||J(c,d,e.wordOptions)}}for(var g,h,i,j,k,l,m=Ba(e.direction),n=E(a,m,a.session.getRangeBoundaryPosition(d,m),e.characterOptions),o="",p=[],q=null;g=n.next();)if(h=g.character,c||e.caseSensitive||(h=h.toLowerCase()),m?(p.unshift(g),o=h+o):(p.push(g),o+=h),c){if(k=b.exec(o),k)if(i=k.index,j=i+k[0].length,l){if(!m&&j<o.length||m&&i>0){q=f(i,j);break}}else l=!0}else if(-1!=(i=o.indexOf(b))){q=f(i,i+b.length);break}return l&&(q=f(i,j)),n.dispose(),q}function L(a){return function(){var b=!!la,c=C(),d=[c].concat(sa.toArray(arguments)),e=a.apply(this,d);return b||D(),e}}function M(a,b){return L(function(c,d,e,f){var g,i,j;return typeof e==oa&&(e=d,d=pa),f=h(f,T),g=a,b&&(g=e>=0,this.collapse(!g)),i=G(c.getRangeBoundaryPosition(this,g),d,e,f.characterOptions,f.wordOptions),j=i.position,this[g?"setStart":"setEnd"](j.node,j.offset),i.unitsMoved})}function N(a){return L(function(b,c){var d,e,f,g;for(c=ua(c,P),e=H(b,this,c,!a),f=0;(d=e.next())&&ya.test(d.character);)++f;return e.dispose(),g=f>0,g&&this[a?"moveStart":"moveEnd"]("character",a?f:-f,{characterOptions:c}),g})}function O(a){return L(function(b,c){var d=!1;return this.changeEachRange(function(b){d=b[a](c)||d}),d})}var P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa="undefined",pa="character",qa="word",ra=a.dom,sa=a.util,ta=sa.extend,ua=sa.createOptions,va=ra.getBody,wa=/^[ \t\f\r\n]+$/,xa=/^[ \t\f\r]+$/,ya=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,za=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,Aa="en",Ba=a.Selection.isDirectionBackward,Ca=!1,Da=!1,Ea=!1;!function(){var b=ra.createTestElement(document,"<p>1 </p><p></p>",!0),c=b.firstChild,d=a.getSelection();d.collapse(c.lastChild,2),d.setStart(c.firstChild,0),Ca=1==(""+d).length,b.innerHTML="1 <br />",d.collapse(b,2),d.setStart(b.firstChild,0),Da=1==(""+d).length,b.innerHTML="1 <p>1</p>",d.collapse(b,2),d.setStart(b.firstChild,0),Ea=1==(""+d).length,ra.removeNode(b),d.removeAllRanges()}(),P={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},Q={includeBlockContentTrailingSpace:!1,includeSpaceBeforeBr:!Da,includeSpaceBeforeBlock:!Ea,includePreLineTrailingSpace:!0},R={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:c}},S={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},T={wordOptions:null,characterOptions:null},U={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},V={wordOptions:null,characterOptions:null,direction:"forward"},W=ra.getComputedStyleProperty,function(){var a=document.createElement("table"),b=va(document);b.appendChild(a),X="block"==W(a,"display"),b.removeChild(a)}(),Y={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"},w.prototype={get:function(a){return this.store.hasOwnProperty(a)?this.store[a]:null},set:function(a,b){return this.store[a]=b}},Z=0,$=0,_={getPosition:function(a){var b=this.positions;return b.get(a)||b.set(a,new z(this,a))},toString:function(){return"[NodeWrapper("+ra.inspectNode(this.node)+")]"}},y.prototype=_,aa="EMPTY",ba="NON_SPACE",ca="UNCOLLAPSIBLE_SPACE",da="COLLAPSIBLE_SPACE",ea="TRAILING_SPACE_BEFORE_BLOCK",fa="TRAILING_SPACE_IN_BLOCK",ga="TRAILING_SPACE_BEFORE_BR",ha="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",ia="TRAILING_LINE_BREAK_AFTER_BR",ja="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR",ta(_,{isCharacterDataNode:x("isCharacterDataNode",ra.isCharacterDataNode,"node"),getNodeIndex:x("nodeIndex",ra.getNodeIndex,"node"),getLength:x("nodeLength",ra.getNodeLength,"node"),containsPositions:x("containsPositions",m,"node"),isWhitespace:x("isWhitespace",s,"node"),isCollapsedWhitespace:x("isCollapsedWhitespace",t,"node"),getComputedDisplay:x("computedDisplay",i,"node"),isCollapsed:x("collapsed",u,"node"),isIgnored:x("ignored",v,"node"),next:x("nextPos",q,"node"),previous:x("previous",r,"node"),getTextNodeInfo:x("textNodeInfo",function(a){var b=null,c=!1,d=W(a.parentNode,"whiteSpace"),e="pre-line"==d;return e?(b=xa,c=!0):"normal"!=d&&"nowrap"!=d||(b=wa,c=!0),{node:a,text:a.data,spaceRegex:b,collapseSpaces:c,preLine:e}},"node"),hasInnerText:x("hasInnerText",function(a,b){for(var c=this.session,d=c.getPosition(a.parentNode,this.getNodeIndex()+1),e=c.getPosition(a,0),f=b?d:e,g=b?e:d;f!==g;){if(f.prepopulateChar(),f.isDefinitelyNonEmpty())return!0;f=b?f.previousVisible():f.nextVisible()}return!1},"node"),isRenderedBlock:x("isRenderedBlock",function(a){var b,c,d=a.getElementsByTagName("br");for(b=0,c=d.length;b<c;++b)if(!u(d[b]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:x("trailingSpace",function(a){if("br"==a.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var b=a.lastChild;b;){if(!v(b))return 1==b.nodeType?this.session.getNodeWrapper(b).getTrailingSpace():"";b=b.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:x("leadingSpace",function(a){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")}),ka={character:"",characterType:aa,isBr:!1,prepopulateChar:function(){var a,b,c,d,e,f,g,h,i,j,k,l=this;l.prepopulatedChar||(a=l.node,b=l.offset,c="",d=aa,e=!1,b>0&&(3==a.nodeType?(f=a.data,g=f.charAt(b-1),h=l.nodeWrapper.getTextNodeInfo(),i=h.spaceRegex,h.collapseSpaces?i.test(g)?b>1&&i.test(f.charAt(b-2))||(h.preLine&&"\n"===f.charAt(b)?(c=" ",d=ha):(c=" ",d=da)):(c=g,d=ba,e=!0):(c=g,d=ca,e=!0)):(j=a.childNodes[b-1],j&&1==j.nodeType&&!u(j)&&("br"==j.tagName.toLowerCase()?(c="\n",l.isBr=!0,d=da,e=!1):l.checkForTrailingSpace=!0),c||(k=a.childNodes[b],k&&1==k.nodeType&&!u(k)&&(l.checkForLeadingSpace=!0)))),l.prepopulatedChar=!0,l.character=c,l.characterType=d,l.isCharInvariant=e)},isDefinitelyNonEmpty:function(){var a=this.characterType;return a==ba||a==ca},resolveLeadingAndTrailingSpaces:function(){var a,b;this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace&&(a=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace(),a&&(this.isTrailingSpace=!0,this.character=a,this.characterType=da),this.checkForTrailingSpace=!1),this.checkForLeadingSpace&&(b=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace(),b&&(this.isLeadingSpace=!0,this.character=b,this.characterType=da),this.checkForLeadingSpace=!1)},getPrecedingUncollapsedPosition:function(a){for(var b,c=this;c=c.previousVisible();)if(b=c.getCharacter(a),""!==b)return c;return null},getCharacter:function(a){function b(){return n||(m=o.getPrecedingUncollapsedPosition(a),n=!0),m}var c,d,e,g,h,i,j,k,l,m,n,o;return this.resolveLeadingAndTrailingSpaces(),c=this.character,e=f(a.ignoreCharacters),g=""!==c&&e.indexOf(c)>-1,this.isCharInvariant?(d=g?"":c,d):(h=["character",a.includeSpaceBeforeBr,a.includeBlockContentTrailingSpace,a.includePreLineTrailingSpace,e].join("_"),i=this.cache.get(h),null!==i?i:(j="",k=this.characterType==da,n=!1,o=this,k&&(this.type==ja?j="\n":" "==c&&(!b()||m.isTrailingSpace||"\n"==m.character||" "==m.character&&m.characterType==da)||("\n"==c&&this.isLeadingSpace?b()&&"\n"!=m.character&&(j="\n"):(l=this.nextUncollapsed(),l&&(l.isBr?this.type=ga:l.isTrailingSpace&&"\n"==l.character?this.type=fa:l.isLeadingSpace&&"\n"==l.character&&(this.type=ea),"\n"==l.character?(this.type!=ga||a.includeSpaceBeforeBr)&&(this.type!=ea||a.includeSpaceBeforeBlock)&&(this.type==fa&&l.isTrailingSpace&&!a.includeBlockContentTrailingSpace||(this.type!=ha||l.type!=ba||a.includePreLineTrailingSpace)&&("\n"==c?l.isTrailingSpace?this.isTrailingSpace||this.isBr&&(l.type=ia,b()&&m.isLeadingSpace&&!m.isTrailingSpace&&"\n"==m.character?l.character="":l.type=ja):j="\n":" "==c&&(j=" "))):j=c)))),e.indexOf(j)>-1&&(j=""),this.cache.set(h,j),j))},equals:function(a){return!!a&&this.node===a.node&&this.offset===a.offset},inspect:A,toString:function(){return this.character}},z.prototype=ka,ta(ka,{next:x("nextPos",function(a){var b,c,d,e=a.nodeWrapper,f=a.node,g=a.offset,h=e.session;return f?(g==e.getLength()?(b=f.parentNode,c=b?e.getNodeIndex()+1:0):e.isCharacterDataNode()?(b=f,c=g+1):(d=f.childNodes[g],h.getNodeWrapper(d).containsPositions()?(b=d,c=0):(b=f,c=g+1)),b?h.getPosition(b,c):null):null}),previous:x("previous",function(a){var b,c,d,e=a.nodeWrapper,f=a.node,g=a.offset,h=e.session;return 0==g?(b=f.parentNode,c=b?e.getNodeIndex():0):e.isCharacterDataNode()?(b=f,c=g-1):(d=f.childNodes[g-1],h.getNodeWrapper(d).containsPositions()?(b=d,c=ra.getNodeLength(d)):(b=f,c=g-1)),b?h.getPosition(b,c):null}),nextVisible:x("nextVisible",function(a){var b,c,d,e=a.next();return e?(b=e.nodeWrapper,c=e.node,d=e,b.isCollapsed()&&(d=b.session.getPosition(c.parentNode,b.getNodeIndex()+1)),d):null}),nextUncollapsed:x("nextUncollapsed",function(a){for(var b=a;b=b.nextVisible();)if(b.resolveLeadingAndTrailingSpaces(),""!==b.character)return b;return null}),previousVisible:x("previousVisible",function(a){var b,c,d,e=a.previous();return e?(b=e.nodeWrapper,c=e.node,d=e,b.isCollapsed()&&(d=b.session.getPosition(c.parentNode,b.getNodeIndex())),d):null})}),la=null,ma=function(){function a(a){var b=new w;return{get:function(c){var d,e,f=b.get(c[a]);if(f)for(d=0;e=f[d++];)if(e.node===c)return e;return null},set:function(c){var d=c.node[a];(b.get(d)||b.set(d,[])).push(c)}}}function b(){this.initCaches()}var c=sa.isHostProperty(document.documentElement,"uniqueID");return b.prototype={initCaches:function(){this.elementCache=c?function(){var a=new w;return{get:function(b){return a.get(b.uniqueID)},set:function(b){a.set(b.node.uniqueID,b)}}}():a("tagName"),this.textNodeCache=a("data"),this.otherNodeCache=a("nodeName")},getNodeWrapper:function(a){var b,c;switch(a.nodeType){case 1:b=this.elementCache;break;case 3:b=this.textNodeCache;break;default:b=this.otherNodeCache}return c=b.get(a),c||(c=new y(a,this),b.set(c)),c},getPosition:function(a,b){return this.getNodeWrapper(a).getPosition(b)},getRangeBoundaryPosition:function(a,b){var c=b?"start":"end";return this.getPosition(a[c+"Container"],a[c+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},b}(),ta(ra,{nextNode:q,previousNode:r}),na=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;c<d;++c)if(a[c]===b)return c;return-1},ta(a.rangePrototype,{moveStart:M(!0,!1),moveEnd:M(!1,!1),move:M(!0,!0),trimStart:N(!0),trimEnd:N(!1),trim:L(function(a,b){var c=this.trimStart(b),d=this.trimEnd(b);return c||d}),expand:L(function(a,b,c){var d,e,f,g,i,j,k,l,m,n,o=!1;return c=h(c,U),d=c.characterOptions,b||(b=pa),b==qa?(e=c.wordOptions,f=a.getRangeBoundaryPosition(this,!0),g=a.getRangeBoundaryPosition(this,!1),i=F(f,d,e),j=i.nextEndToken(),k=j.chars[0].previousVisible(),this.collapsed?l=j:(n=F(g,d,e),l=n.previousStartToken()),m=l.chars[l.chars.length-1],k.equals(f)||(this.setStart(k.node,k.offset),o=!0),m&&!m.equals(g)&&(this.setEnd(m.node,m.offset),o=!0),c.trim&&(c.trimStart&&(o=this.trimStart(d)||o),c.trimEnd&&(o=this.trimEnd(d)||o)),o):this.moveEnd(pa,1,c)}),text:L(function(a,b){return this.collapsed?"":I(a,this,ua(b,P)).join("")}),selectCharacters:L(function(a,b,c,d,e){var f={characterOptions:e};b||(b=va(this.getDocument())),this.selectNodeContents(b),this.collapse(!0),this.moveStart("character",c,f),this.collapse(!0),this.moveEnd("character",d-c,f)}),toCharacterRange:L(function(a,b,c){var d,e,f,g,h,i;return b||(b=va(this.getDocument())),d=b.parentNode,e=ra.getNodeIndex(b),f=-1==ra.comparePoints(this.startContainer,this.endContainer,d,e),g=this.cloneRange(),f?(g.setStartAndEnd(this.startContainer,this.startOffset,d,e),h=-g.text(c).length):(g.setStartAndEnd(d,e,this.startContainer,this.startOffset),h=g.text(c).length),i=h+this.text(c).length,{start:h,end:i}}),findText:L(function(b,c,d){var e,f,g,i,j,k,l,m,n;for(d=h(d,S),d.wholeWordsOnly&&(d.wordOptions.includeTrailingSpace=!1),e=Ba(d.direction),f=d.withinRange,f||(f=a.createRange(),f.selectNodeContents(this.getDocument())),g=c,i=!1,"string"==typeof g?d.caseSensitive||(g=g.toLowerCase()):i=!0,j=b.getRangeBoundaryPosition(this,!e),k=f.comparePoint(j.node,j.offset),-1===k?j=b.getRangeBoundaryPosition(f,!0):1===k&&(j=b.getRangeBoundaryPosition(f,!1)),l=j,m=!1;;)if(n=K(l,g,i,f,d),n){if(n.valid)return this.setStartAndEnd(n.startPos.node,n.startPos.offset,n.endPos.node,n.endPos.offset),!0;l=e?n.startPos:n.endPos}else{if(!d.wrap||m)return!1;f=f.cloneRange(),l=b.getRangeBoundaryPosition(f,!e),f.setBoundary(j.node,j.offset,e),m=!0}}),pasteHtml:function(a){var b,c;this.deleteContents(),a&&(b=this.createContextualFragment(a),c=b.lastChild,this.insertNode(b),this.collapseAfter(c))}}),ta(a.selectionPrototype,{expand:L(function(a,b,c){this.changeEachRange(function(a){a.expand(b,c)})}),move:L(function(a,b,c,d){var e,f=0;return this.focusNode&&(this.collapse(this.focusNode,this.focusOffset),e=this.getRangeAt(0),d||(d={}),d.characterOptions=ua(d.characterOptions,Q),f=e.move(b,c,d),this.setSingleRange(e)),f}),trimStart:O("trimStart"),trimEnd:O("trimEnd"),trim:O("trim"),selectCharacters:L(function(b,c,d,e,f,g){var h=a.createRange(c);h.selectCharacters(c,d,e,g),this.setSingleRange(h,f)}),saveCharacterRanges:L(function(a,b,c){var d,e,f=this.getAllRanges(),g=f.length,h=[],i=1==g&&this.isBackward();for(d=0,e=f.length;d<e;++d)h[d]={characterRange:f[d].toCharacterRange(b,c),backward:i,characterOptions:c};return h}),restoreCharacterRanges:L(function(b,c,d){this.removeAllRanges();for(var e,f,g,h=0,i=d.length;h<i;++h)f=d[h],g=f.characterRange,e=a.createRange(c),e.selectCharacters(c,g.start,g.end,f.characterOptions),this.addRange(e,f.backward)}),text:L(function(a,b){var c,d,e=[];for(c=0,d=this.rangeCount;c<d;++c)e[c]=this.getRangeAt(c).text(b);return e.join("")})}),a.innerText=function(b,c){var d,e=a.createRange(b);return e.selectNodeContents(b),d=e.text(c),d},a.createWordIterator=function(a,b,c){var d,e,f,g=C();return c=h(c,V),d=g.getPosition(a,b),e=F(d,c.characterOptions,c.wordOptions),f=Ba(c.direction),{next:function(){return f?e.previousStartToken():e.nextEndToken()},dispose:function(){e.dispose(),this.next=function(){}}}},a.noMutation=function(a){a(C()),D()},a.noMutation.createEntryPointFunction=L,a.textRange={isBlockNode:l,isCollapsedWhitespaceNode:t,createPosition:L(function(a,b,c){return a.getPosition(b,c)})}}),a},this),function(a,b){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(b.rangy)}(function(a){return a.createModule("SaveRestore",["WrappedRange"],function(a,b){function c(a,b){return(b||document).getElementById(a)}function d(a,b){var c,d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),e=o.getDocument(a.startContainer),f=a.cloneRange();return f.collapse(b),c=e.createElement("span"),c.id=d,c.style.lineHeight="0",c.style.display="none",c.className="rangySelectionBoundary",c.appendChild(e.createTextNode(r)),f.insertNode(c),c}function e(a,d,e,f){var g=c(e,a);g?(d[f?"setStartBefore":"setEndBefore"](g),p(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(b,c){var e,f,g=a.DomRange.getRangeDocument(b),h=""+b,i=q(c);return b.collapsed?(f=d(b,!1),{document:g,markerId:f.id,collapsed:!0}):(f=d(b,!1),e=d(b,!0),{document:g,startMarkerId:e.id,endMarkerId:f.id,collapsed:!1,backward:i,toString:function(){return"original text: '"+h+"', new text: '"+b+"'"}})}function h(d,f){var g,h,i,j=d.document;return void 0===f&&(f=!0),g=a.createRange(j),d.collapsed?(h=c(d.markerId,j),h?(h.style.display="inline",i=h.previousSibling,i&&3==i.nodeType?(p(h),g.collapseToPoint(i,i.length)):(g.collapseBefore(h),p(h))):b.warn("Marker element has been removed. Cannot restore selection.")):(e(j,g,d.startMarkerId,!0),e(j,g,d.endMarkerId,!1)),f&&g.normalizeBoundaries(),g}function i(b,d){var e,h,i,j,k=[],l=q(d);for(b=b.slice(0),b.sort(f),i=0,j=b.length;i<j;++i)k[i]=g(b[i],l);for(i=j-1;i>=0;--i)e=b[i],h=a.DomRange.getRangeDocument(e),e.collapsed?e.collapseAfter(c(k[i].markerId,h)):(e.setEndBefore(c(k[i].endMarkerId,h)),e.setStartAfter(c(k[i].startMarkerId,h)));return k}function j(c){var d,e,f,g;return a.isSelectionValid(c)?(d=a.getSelection(c),e=d.getAllRanges(),f=1==e.length&&d.isBackward(),g=i(e,f),f?d.setSingleRange(e[0],f):d.setRanges(e),{win:c,rangeInfos:g,restored:!1}):(b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null)}function k(a){var b,c=[],d=a.length;for(b=d-1;b>=0;b--)c[b]=h(a[b],!0);return c}function l(b,c){var d,e,f,g;b.restored||(d=b.rangeInfos,e=a.getSelection(b.win),f=k(d),g=d.length,1==g&&c&&a.features.selectionHasExtend&&d[0].backward?(e.removeAllRanges(),e.addRange(f[0],!0)):e.setRanges(f),b.restored=!0)}function m(a,b){var d=c(b,a);d&&p(d)}function n(a){var b,c,d,e=a.rangeInfos;for(b=0,c=e.length;b<c;++b)d=e[b],d.collapsed?m(a.doc,d.markerId):(m(a.doc,d.startMarkerId),m(a.doc,d.endMarkerId))}var o=a.dom,p=o.removeNode,q=a.Selection.isDirectionBackward,r="\ufeff";a.util.extend(a,{saveRange:g,restoreRange:h,saveRanges:i,restoreRanges:k,saveSelection:j,restoreSelection:l,removeMarkerElement:m,removeMarkers:n})}),a},this),d=function(){},d.extend=function(a,b){var c,e,f,g=d.prototype.extend;return d._prototyping=!0,c=new this,g.call(c,a),c.base=function(){},delete d._prototyping,e=c.constructor,f=c.constructor=function(){if(!d._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||g).call(arguments[0],c)},f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=c,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},g.call(f,b),"function"==typeof f.init&&f.init(),f},d.prototype={extend:function(a,b){var c,e,f,g,h,i,j;if(arguments.length>1)c=this[a],!c||"function"!=typeof b||c.valueOf&&c.valueOf()==b.valueOf()||!/\bbase\b/.test(b)||(e=b.valueOf(),b=function(){var a,b=this.base||d.prototype.base;return this.base=c,a=e.apply(this,arguments),this.base=b,a},b.valueOf=function(a){return"object"==a?b:e},b.toString=d.toString),this[a]=b;else if(a){for(f=d.prototype.extend,d._prototyping||"function"==typeof this||(f=this.extend||f),g={toSource:null},h=["constructor","toString","valueOf"],i=d._prototyping?0:1;j=h[i++];)a[j]!=g[j]&&f.call(this,j,a[j]);for(j in a)g[j]||f.call(this,j,a[j])}return this}},d=d.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return this.valueOf()+""}}),b.browser=function(){function a(a){return+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function b(a){return+(a.match(/android (\d+)/)||[void 0,0])[1]}function c(a,b){var c,d=-1;return"Microsoft Internet Explorer"==navigator.appName?c=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(navigator.userAgent.indexOf("Trident")>-1?c=RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"):/Edge\/(\d+)./i.test(navigator.userAgent)&&(c=/Edge\/(\d+)./i)),c&&null!=c.exec(navigator.userAgent)&&(d=parseFloat(RegExp.$1)),-1!==d&&(!a||(b?"<"===b?a<d:">"===b?a>d:"<="===b?a<=d:">="===b?a>=d:void 0:a===d))}var d=navigator.userAgent,e=document.createElement("div"),f=-1!==d.indexOf("Gecko")&&-1===d.indexOf("KHTML")&&!c(),g=-1!==d.indexOf("AppleWebKit/")&&!c(),h=-1!==d.indexOf("Chrome/")&&!c(),i=-1!==d.indexOf("Opera/")&&!c();return{USER_AGENT:d,supported:function(){var c=this.USER_AGENT.toLowerCase(),d="contentEditable"in e,f=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,g=document.querySelector&&document.querySelectorAll,h=this.isIos()&&a(c)<5||this.isAndroid()&&b(c)<4||-1!==c.indexOf("opera mobi")||-1!==c.indexOf("hpwos/");return d&&f&&g&&!h},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return c()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return c(12,">")},hasCurrentStyleProperty:function(){return"currentStyle"in e},insertsLineBreaksOnReturn:function(){return f},supportsPlaceholderAttributeOn:function(a){return"placeholder"in a},supportsEvent:function(a){return"on"+a in e||function(){return e.setAttribute("on"+a,"return;"),"function"==typeof e["on"+a]}()},supportsEventsInIframeCorrectly:function(){return!i},supportsHTML5Tags:function(a){var b=a.createElement("div"),c="<article>foo</article>";return b.innerHTML=c,b.innerHTML.toLowerCase()===c},supportsCommand:function(){var a={formatBlock:c(10,"<="),insertUnorderedList:c(),insertOrderedList:c()},b={insertHTML:f};return function(c,d){if(!a[d]){try{return c.queryCommandSupported(d)}catch(a){}try{return c.queryCommandEnabled(d)}catch(a){return!!b[d]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return c()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return f||i||g},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return f||c()||i},autoScrollsToCaret:function(){return!g},autoClosesUnclosedTags:function(){var a,b,c=e.cloneNode(!1);return c.innerHTML="<p><div></div>",b=c.innerHTML.toLowerCase(),a="<p></p><div></div>"===b||"<p><div></div></p>"===b,this.autoClosesUnclosedTags=function(){return a},a},supportsNativeGetElementsByClassName:function(){return-1!==(document.getElementsByClassName+"").indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return i},supportsSpeechApiOn:function(a){return(d.match(/Chrome\/(\d+)/)||[void 0,0])[1]>=11&&("onwebkitspeechchange"in a||"speech"in a)},crashesWhenDefineProperty:function(a){return c(9)&&("XMLHttpRequest"===a||"XDomainRequest"===a)},doesAsyncFocus:function(){return c(12,">")},hasProblemsSettingCaretAfterImg:function(){return c()},hasLiDeletingProblem:function(){return c()},hasUndoInContextMenu:function(){return f||h||i},hasInsertNodeIssue:function(){return i},hasIframeFocusIssue:function(){return c()},createsNestedInvalidMarkupAfterPaste:function(){return g},hasCaretBlockElementIssue:function(){return g},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModernPaste:function(){return!c()},fixStyleKey:function(a){return"cssFloat"===a?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":a},usesControlRanges:function(){return document.body&&"createControlRange"in document.body}}}(),b.lang.array=function(a){return{contains:function(c){if(Array.isArray(c)){for(var d=c.length;d--;)if(-1!==b.lang.array(a).indexOf(c[d]))return!0;return!1}return-1!==b.lang.array(a).indexOf(c)},indexOf:function(b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},without:function(c){c=b.lang.array(c);for(var d=[],e=0,f=a.length;e<f;e++)c.contains(a[e])||d.push(a[e]);return d},get:function(){for(var b=0,c=a.length,d=[];b<c;b++)d.push(a[b]);return d},map:function(b,c){if(Array.prototype.map)return a.map(b,c);for(var d=a.length>>>0,e=Array(d),f=0;f<d;f++)e[f]=b.call(c,a[f],f,a);return e},unique:function(){for(var c=[],d=a.length,e=0;e<d;)b.lang.array(c).contains(a[e])||c.push(a[e]),e++;return c}}},b.lang.Dispatcher=d.extend({on:function(a,b){return this.events=this.events||{},this.events[a]=this.events[a]||[],this.events[a].push(b),this},off:function(a,b){this.events=this.events||{};var c,d,e=0;if(a){for(c=this.events[a]||[],d=[];e<c.length;e++)c[e]!==b&&b&&d.push(c[e]);this.events[a]=d}else this.events={};return this},fire:function(a,b){this.events=this.events||{};for(var c=this.events[a]||[],d=0;d<c.length;d++)c[d].call(this,b);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),b.lang.object=function(a){return{merge:function(c,d){for(var e in c)d&&b.lang.object(c[e]).isPlainObject()&&(void 0===a[e]||b.lang.object(a[e]).isPlainObject())?void 0===a[e]?a[e]=b.lang.object(c[e]).clone(!0):b.lang.object(a[e]).merge(b.lang.object(c[e]).clone(!0)):a[e]=b.lang.object(c[e]).isPlainObject()?b.lang.object(c[e]).clone(!0):c[e];return this},difference:function(b){var c,d,e={};for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(e[c]=a[c]));for(d in b)b.hasOwnProperty(d)&&(a.hasOwnProperty(d)&&a[d]===b[d]||(e[0]=a[0]));return e},get:function(){return a},clone:function(c){var d,e={};if(null===a||!b.lang.object(a).isPlainObject())return a;for(d in a)a.hasOwnProperty(d)&&(e[d]=c?b.lang.object(a[d]).clone(c):a[d]);return e},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(a)},isPlainObject:function(){return a&&"[object Object]"===Object.prototype.toString.call(a)&&!("Node"in window?a instanceof Node:a instanceof Element||a instanceof Text)},isEmpty:function(){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}}},function(){var a=/^\s+/,c=/\s+$/,d=/[&<>\t"]/g,e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};b.lang.string=function(b){return b+="",{trim:function(){return b.replace(a,"").replace(c,"")},interpolate:function(a){for(var c in a)b=this.replace("#{"+c+"}").by(a[c]);return b},replace:function(a){return{by:function(c){return b.split(a).join(c)}}},escapeHTML:function(a,c){var f=b.replace(d,function(a){return e[a]});return a&&(f=f.replace(/(?:\r\n|\r|\n)/g,"<br />")),c&&(f=f.replace(/  /gi,"&nbsp; ")),f}}}}(),function(a){function b(a,b){return f(a,b)?a:(a===a.ownerDocument.documentElement&&(a=a.ownerDocument.body),g(a,b))}function c(a){return a.replace(i,function(a,b){var c,d,e=(b.match(j)||[])[1]||"",f=l[e];return b=b.replace(j,""),b.split(f).length>b.split(e).length&&(b+=e,e=""),c=b,d=b,b.length>k&&(d=d.substr(0,k)+"..."),"www."===c.substr(0,4)&&(c="http://"+c),'<a href="'+c+'">'+d+"</a>"+e})}function d(a){var b=a._wysihtml5_tempElement;return b||(b=a._wysihtml5_tempElement=a.createElement("div")),b}function e(b){var e=b.parentNode,f=a.lang.string(b.data).escapeHTML(),g=d(e.ownerDocument);for(g.innerHTML="<span></span>"+c(f),g.removeChild(g.firstChild);g.firstChild;)e.insertBefore(g.firstChild,b);e.removeChild(b)}function f(b,c){for(var d;b.parentNode;){if(b=b.parentNode,d=b.nodeName,b.className&&a.lang.array(b.className.split(" ")).contains(c))return!0;if(h.contains(d))return!0;if("body"===d)return!1}return!1}function g(b,c){if(!(h.contains(b.nodeName)||b.className&&a.lang.array(b.className.split(" ")).contains(c))){if(b.nodeType===a.TEXT_NODE&&b.data.match(i))return e(b),void 0;for(var d=a.lang.array(b.childNodes).get(),f=d.length,j=0;j<f;j++)g(d[j],c);return b}}var h=a.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),i=/((https?:\/\/|www\.)[^\s<]{3,})/gi,j=/([^\w\/\-](,?))$/i,k=100,l={")":"(","]":"[","}":"{"};a.dom.autoLink=b,a.dom.autoLink.URL_REG_EXP=i}(b),function(a){var b=a.dom;b.addClass=function(a,c){var d=a.classList;if(d)return d.add(c);b.hasClass(a,c)||(a.className+=" "+c)},b.removeClass=function(a,b){var c=a.classList;if(c)return c.remove(b);a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")},b.hasClass=function(a,b){var c,d=a.classList;return d?d.contains(b):(c=a.className,c.length>0&&(c==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(c)))}}(b),b.dom.contains=function(){var a=document.documentElement;return a.contains?function(a,c){if(c.nodeType!==b.ELEMENT_NODE){if(c.parentNode===a)return!0;c=c.parentNode}return a!==c&&a.contains(c)}:a.compareDocumentPosition?function(a,b){return!!(16&a.compareDocumentPosition(b))}:void 0}(),b.dom.convertToList=function(){function a(a,b){var c=a.createElement("li");return b.appendChild(c),c}function c(a,b){return a.createElement(b)}function d(d,e,f){if("UL"===d.nodeName||"OL"===d.nodeName||"MENU"===d.nodeName)return d;var g,h,i,j,k,l,m,n,o,p=d.ownerDocument,q=c(p,e),r=d.querySelectorAll("br"),s=r.length;for(o=0;o<s;o++)for(j=r[o];(k=j.parentNode)&&k!==d&&k.lastChild===j;){if("block"===b.dom.getStyle("display").from(k)){k.removeChild(j);break}b.dom.insert(j).after(j.parentNode)}for(g=b.lang.array(d.childNodes).get(),h=g.length,o=0;o<h;o++)n=n||a(p,q),i=g[o],l="block"===b.dom.getStyle("display").from(i),m="BR"===i.nodeName,!l||f&&b.dom.hasClass(i,f)?m?n=n.firstChild?null:n:n.appendChild(i):(n=n.firstChild?a(p,q):n,n.appendChild(i),n=null);return 0===g.length&&a(p,q),d.parentNode.replaceChild(q,d),q}return d}(),b.dom.copyAttributes=function(a){return{from:function(b){return{to:function(c){for(var d,e=0,f=a.length;e<f;e++)d=a[e],void 0!==b[d]&&""!==b[d]&&(c[d]=b[d]);return{andTo:arguments.callee}}}}}},function(a){var c=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],d=function(b){return!!e(b)&&parseInt(a.getStyle("width").from(b),10)<b.offsetWidth},e=function(b){for(var d=0,e=c.length;d<e;d++)if("border-box"===a.getStyle(c[d]).from(b))return c[d]};a.copyStyles=function(e){return{from:function(f){d(f)&&(e=b.lang.array(e).without(c));for(var g,h="",i=e.length,j=0;j<i;j++)g=e[j],h+=g+":"+a.getStyle(g).from(f)+";";return{to:function(b){return a.setStyles(h).on(b),{andTo:arguments.callee}}}}}}}(b.dom),function(a){a.dom.delegate=function(a,b,c,d){var e=function(c){var e,f,g=c.target,h=3===g.nodeType?g.parentNode:g,i=a.querySelectorAll(b);for(e=0,f=i.length;e<f;e++)i[e].contains(h)&&d.call(i[e],c)};return a.addEventListener(c,e,!1),{stop:function(){a.removeEventListener(c,e,!1)}}}}(b),function(a){function b(a,b){for(var c=[a],d=a;b&&d&&d!==b||!b&&d;)c.unshift(d),d=d.parentNode;return c}a.dom.domNode=function(c){var d=[a.ELEMENT_NODE,a.TEXT_NODE];return{is:{emptyTextNode:function(b){var d=b?/^\s*$/g:/^[\r\n]*$/g;return c&&c.nodeType===a.TEXT_NODE&&d.test(c.data)},rangyBookmark:function(){return c&&1===c.nodeType&&c.classList.contains("rangySelectionBoundary")},visible:function(){var b=!/^\s*$/g.test(a.dom.getTextContent(c));return b||1===c.nodeType&&c.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(b=!0),b},lineBreak:function(){return c&&1===c.nodeType&&"BR"===c.nodeName},block:function(){return c&&1===c.nodeType&&"block"===c.ownerDocument.defaultView.getComputedStyle(c).display},voidElement:function(){return a.dom.domNode(c).test({query:a.VOID_ELEMENTS})}},prev:function(b){var e=c.previousSibling,f=b&&b.nodeTypes?b.nodeTypes:d;return e?a.dom.domNode(e).is.rangyBookmark()||!a.lang.array(f).contains(e.nodeType)||b&&b.ignoreBlankTexts&&a.dom.domNode(e).is.emptyTextNode(!0)?a.dom.domNode(e).prev(b):e:null},next:function(b){var e=c.nextSibling,f=b&&b.nodeTypes?b.nodeTypes:d;return e?a.dom.domNode(e).is.rangyBookmark()||!a.lang.array(f).contains(e.nodeType)||b&&b.ignoreBlankTexts&&a.dom.domNode(e).is.emptyTextNode(!0)?a.dom.domNode(e).next(b):e:null},commonAncestor:function(a,d){var e,f=b(c,d),g=b(a,d);if(f[0]!=g[0])return null;for(e=0;e<f.length;e++)if(f[e]!=g[e])return f[e-1];return null},lastLeafNode:function(b){var d,e;if(1!==c.nodeType)return c;if(d=c.lastChild,!d)return c;if(b&&b.leafClasses)for(e=b.leafClasses.length;e--;)if(a.dom.hasClass(c,b.leafClasses[e]))return c;return a.dom.domNode(d).lastLeafNode(b)},escapeParent:function(b,d){var e,f,g,h=c;if(!a.dom.contains(b,c))throw Error("Child is not a descendant of node.");do{for(e=h.parentNode,f=e.cloneNode(!1);e.lastChild&&e.lastChild!==h;)f.insertBefore(e.lastChild,f.firstChild);if(e!==b&&(g=e.cloneNode(!1),g.appendChild(h),h=g),e.parentNode.insertBefore(h,e.nextSibling),""!==f.innerHTML)if(/^\s+$/.test(f.innerHTML))for(;f.lastChild;)e.parentNode.insertBefore(f.lastChild,h.nextSibling);else e.parentNode.insertBefore(f,h.nextSibling);if(""===e.innerHTML)e.parentNode.removeChild(e);else if(/^\s+$/.test(e.innerHTML)){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}}while(e&&e!==b);d&&h&&(h.parentNode.insertBefore(d,h),d.appendChild(h))},transferContentTo:function(b,d){if(1===c.nodeType){if(a.dom.domNode(b).is.voidElement()||3===b.nodeType)for(;c.lastChild;)b.parentNode.insertBefore(c.lastChild,b.nextSibling);else for(;c.firstChild;)b.appendChild(c.firstChild);d&&c.parentNode.removeChild(c)}else 3!==c.nodeType&&8!==c.nodeType||(a.dom.domNode(b).is.voidElement()?b.parentNode.insertBefore(c,b.nextSibling):b.appendChild(c))},test:function(b){var d,e,f,g,h,i,j,k,l,m;if(!b)return!1;if(1!==c.nodeType)return!1;if(b.query&&!c.matches(b.query))return!1;if(b.nodeName&&c.nodeName.toLowerCase()!==b.nodeName.toLowerCase())return!1;if(b.className&&!c.classList.contains(b.className))return!1;if(b.classRegExp&&(e=(c.className||"").match(b.classRegExp)||[],0===e.length))return!1;if(b.styleProperty&&b.styleProperty.length>0)for(f=!1,g=Array.isArray(b.styleProperty)?b.styleProperty:[b.styleProperty],h=0,i=g.length;h<i;h++){if(d=a.browser.fixStyleKey(g[h]),c.style[d]){if(!b.styleValue){f=!0;break}if(b.styleValue instanceof RegExp){if(c.style[d].trim().match(b.styleValue).length>0){f=!0;break}}else if(Array.isArray(b.styleValue)){if(b.styleValue.indexOf(c.style[d].trim())){f=!0;break}}else if(b.styleValue===c.style[d].trim().replace(/, /g,",")){f=!0;break}}if(!f)return!1}if(b.attribute){j=a.dom.getAttributes(c),k=[],l=!1,Array.isArray(b.attribute)?k=b.attribute:k[b.attribute]=b.attributeValue;for(m in k)if(k.hasOwnProperty(m))if(void 0===k[m]){if(void 0!==j[m]){l=!0;break}}else if(j[m]===k[m]){l=!0;break}if(!l)return!1}return!0}}}}(b),b.dom.getAsDom=function(){var a=function(a,b){var c=b.createElement("div");c.style.display="none",b.body.appendChild(c);try{c.innerHTML=a}catch(a){}return b.body.removeChild(c),c},c=function(a){if(!a._wysihtml5_supportsHTML5Tags){for(var b=0,c=d.length;b<c;b++)a.createElement(d[b]);a._wysihtml5_supportsHTML5Tags=!0}},d=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(d,e){e=e||document;var f;return"object"==typeof d&&d.nodeType?(f=e.createElement("div"),f.appendChild(d)):b.browser.supportsHTML5Tags(e)?(f=e.createElement("div"),f.innerHTML=d):(c(e),f=a(d,e)),f}}(),b.dom.getParentElement=function(){return function(a,c,d,e){for(d=d||50;d--&&a&&"BODY"!==a.nodeName&&(!e||a!==e);){if(b.dom.domNode(a).test(c))return a;a=a.parentNode}return null}}(),b.dom.getStyle=function(){function a(a){return a.replace(d,function(a){return a.charAt(1).toUpperCase()})}var c={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},d=/\-[a-z]/g;return function(d){return{from:function(e){var f,g,h,i,j,k,l,m,n;if(e.nodeType===b.ELEMENT_NODE){if(f=e.ownerDocument,g=c[d]||a(d),h=e.style,i=e.currentStyle,j=h[g],j)return j;if(i)try{return i[g]}catch(a){}return k=f.defaultView||f.parentWindow,l=("height"===d||"width"===d)&&"TEXTAREA"===e.nodeName,k.getComputedStyle?(l&&(m=h.overflow,h.overflow="hidden"),n=k.getComputedStyle(e,null).getPropertyValue(d),l&&(h.overflow=m||""),n):void 0}}}}}(),b.dom.getTextNodes=function(a,c){var d=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?c&&/^\s*$/.test(a.innerText||a.textContent)||d.push(a):d=d.concat(b.dom.getTextNodes(a,c));return d},b.dom.hasElementWithTagName=function(){function a(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=c++)}var b={},c=1;return function(c,d){var e=a(c)+":"+d,f=b[e];return f||(f=b[e]=c.getElementsByTagName(d)),f.length>0}}(),function(a){function b(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=d++)}var c={},d=1;a.dom.hasElementWithClassName=function(d,e){if(!a.browser.supportsNativeGetElementsByClassName())return!!d.querySelector("."+e);var f=b(d)+":"+e,g=c[f];return g||(g=c[f]=d.getElementsByClassName(e)),g.length>0}}(b),b.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}},b.dom.insertCSS=function(a){return a=a.join("\n"),{into:function(b){var c,d,e=b.createElement("style");if(e.type="text/css",e.styleSheet?e.styleSheet.cssText=a:e.appendChild(b.createTextNode(a)),c=b.querySelector("head link"),c)return c.parentNode.insertBefore(e,c),void 0;d=b.querySelector("head"),d&&d.appendChild(e)}}},function(a){a.dom.lineBreaks=function(b){function c(a){return"BR"===a.nodeName}function d(b){return!!c(b)||"block"===a.dom.getStyle("display").from(b)}return{add:function(c){var e=b.ownerDocument,f=a.dom.domNode(b).next({ignoreBlankTexts:!0}),g=a.dom.domNode(b).prev({ignoreBlankTexts:!0});f&&!d(f)&&a.dom.insert(e.createElement("br")).after(b),g&&!d(g)&&a.dom.insert(e.createElement("br")).before(b)},remove:function(d){var e=a.dom.domNode(b).next({ignoreBlankTexts:!0}),f=a.dom.domNode(b).prev({ignoreBlankTexts:!0});e&&c(e)&&e.parentNode.removeChild(e),f&&c(f)&&f.parentNode.removeChild(f)}}}}(b),b.dom.observe=function(a,b,c){b="string"==typeof b?[b]:b;for(var d,e,f=0,g=b.length;f<g;f++)e=b[f],a.addEventListener?a.addEventListener(e,c,!1):(d=function(b){"target"in b||(b.target=b.srcElement),b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},c.call(a,b)},a.attachEvent("on"+e,d));return{stop:function(){for(var e,f=0,g=b.length;f<g;f++)e=b[f],a.removeEventListener?a.removeEventListener(e,c,!1):a.detachEvent("on"+e,d)}}},b.dom.parse=function(a,c){function d(a,c){var d,g,h,i,j,k,l,m,n;for(b.lang.object(u).merge(t).merge(c.rules).get(),d=c.context||a.ownerDocument||document,g=d.createDocumentFragment(),h="string"==typeof a,i=!1,!0===c.clearInternals&&(i=!0),j=h?b.dom.getAsDom(a,d):a,u.selectors&&f(j,u.selectors);j.firstChild;)l=j.firstChild,k=e(l,c.cleanUp,i,c.uneditableClass),k&&g.appendChild(k),l!==k&&j.removeChild(l);if(c.unjoinNbsps)for(m=b.dom.getTextNodes(g),n=m.length;n--;)m[n].nodeValue=m[n].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return j.innerHTML="",j.appendChild(g),h?b.quirks.getCorrectInnerHTML(j):j}function e(a,c,d,f){var g,h,i,j,k=a.nodeType,l=a.childNodes,m=l.length,n=q[k],o=0;if(f&&1===k&&b.dom.hasClass(a,f))return a;if(h=n&&n(a,d),!h){if(!1===h){for(g=a.ownerDocument.createDocumentFragment(),o=m;o--;)l[o]&&(i=e(l[o],c,d,f),i&&(l[o]===i&&o--,g.insertBefore(i,g.firstChild)));return j=b.dom.getStyle("display").from(a),""===j&&(j=b.lang.array(v).contains(a.tagName)?"block":""),b.lang.array(["block","flex","table"]).contains(j)&&g.appendChild(a.ownerDocument.createElement("br")),b.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(a.nodeName.toLowerCase())&&a.parentNode.lastChild!==a&&(a.nextSibling&&3===a.nextSibling.nodeType&&/^\s/.test(a.nextSibling.nodeValue)||g.appendChild(a.ownerDocument.createTextNode(" "))),g.normalize&&g.normalize(),g}return null}for(o=0;o<m;o++)l[o]&&(i=e(l[o],c,d,f),i&&(l[o]===i&&o--,h.appendChild(i)));if(c&&h.nodeName.toLowerCase()===r&&(!h.childNodes.length||/^\s*$/gi.test(h.innerHTML)&&(d||"_wysihtml5-temp-placeholder"!==a.className&&"rangySelectionBoundary"!==a.className)||!h.attributes.length)){for(g=h.ownerDocument.createDocumentFragment();h.firstChild;)g.appendChild(h.firstChild);return g.normalize&&g.normalize(),g}return h.normalize&&h.normalize(),h}function f(a,c){var d,e,f,g;for(d in c)if(c.hasOwnProperty(d))for(b.lang.object(c[d]).isFunction()?e=c[d]:"string"==typeof c[d]&&A[c[d]]&&(e=A[c[d]]),f=a.querySelectorAll(d),g=f.length;g--;)e(f[g])}function g(a,c){var d,e,f,g=u.tags,i=a.nodeName.toLowerCase(),k=a.scopeName;if(a._wysihtml5)return null;if(a._wysihtml5=1,"wysihtml5-temp"===a.className)return null;if(k&&"HTML"!=k&&(i=k+":"+i),"outerHTML"in a&&(b.browser.autoClosesUnclosedTags()||"P"!==a.nodeName||"</p>"===a.outerHTML.slice(-4).toLowerCase()||(i="div")),i in g){if(d=g[i],!d||d.remove)return null;if(d.unwrap)return!1;d="string"==typeof d?{rename_tag:d}:d}else{if(!a.firstChild)return null;d={rename_tag:r}}if(d.one_of_type&&!h(a,u,d.one_of_type,c)){if(!d.remove_action)return null;if("unwrap"===d.remove_action)return!1;if("rename"!==d.remove_action)return null;f=d.remove_action_rename_to||r}return e=a.ownerDocument.createElement(f||d.rename_tag||i),n(a,e,d,c),j(a,e,d),a=null,e.normalize&&e.normalize(),e}function h(a,b,c,d){var e,f;if("SPAN"===a.nodeName&&!d&&("_wysihtml5-temp-placeholder"===a.className||"rangySelectionBoundary"===a.className))return!0;for(f in c)if(c.hasOwnProperty(f)&&b.type_definitions&&b.type_definitions[f]&&(e=b.type_definitions[f],i(a,e)))return!0;return!1}function i(a,c){var d,e,f,g,h,i,j,k,l=a.getAttribute("class"),m=a.getAttribute("style");if(c.methods)for(i in c.methods)if(c.methods.hasOwnProperty(i)&&z[i]&&z[i](a))return!0;if(l&&c.classes)for(l=l.replace(/^\s+/g,"").replace(/\s+$/g,"").split(s),d=l.length,j=0;j<d;j++)if(c.classes[l[j]])return!0;if(m&&c.styles){m=m.split(";");for(e in c.styles)if(c.styles.hasOwnProperty(e))for(k=m.length;k--;)if(h=m[k].split(":"),h[0].replace(/\s/g,"").toLowerCase()===e&&(!0===c.styles[e]||1===c.styles[e]||b.lang.array(c.styles[e]).contains(h[1].replace(/\s/g,"").toLowerCase())))return!0}if(c.attrs)for(f in c.attrs)if(c.attrs.hasOwnProperty(f)&&(g=b.dom.getAttribute(a,f),"string"==typeof g&&g.search(c.attrs[f])>-1))return!0;return!1}function j(a,b,c){var d,e;if(c&&c.keep_styles)for(d in c.keep_styles)if(c.keep_styles.hasOwnProperty(d)){if(e="float"===d?a.style.styleFloat||a.style.cssFloat:a.style[d],c.keep_styles[d]instanceof RegExp&&!c.keep_styles[d].test(e))continue;"float"===d?b.style[a.style.styleFloat?"styleFloat":"cssFloat"]=e:a.style[d]&&(b.style[d]=e)}}function k(a,b){var c,d=[];for(c in b)b.hasOwnProperty(c)&&0===c.indexOf(a)&&d.push(c);return d}function l(a,c,d,e){var f,g=b.lang.object(d).isFunction()?d:w[d];return!(!g||(f=g(c,e),"string"!=typeof f))&&f}function m(a,c){var d,e,f,g,h,i=b.lang.object(u.attributes||{}).clone(),j=b.lang.object(i).merge(b.lang.object(c||{}).clone()).get(),m={},n=b.dom.getAttributes(a);for(d in j)if(/\*$/.test(d))for(f=k(d.slice(0,-1),n),g=0,h=f.length;g<h;g++)e=l(f[g],n[f[g]],j[d],a.nodeName),!1!==e&&(m[f[g]]=e);else e=l(d,n[d],j[d],a.nodeName),!1!==e&&(m[d]=e);return m}function n(a,c,d,e){var f,g,h,i,j,k={},l=d.set_class,n=d.add_class,o=d.add_style,p=d.set_attributes,q=u.classes,r=0,t=[],v=[],w=[],z=[];if(p&&(k=b.lang.object(p).clone()),k=b.lang.object(k).merge(m(a,d.check_attributes)).get(),l&&t.push(l),n)for(i in n)j=y[n[i]],j&&(h=j(b.dom.getAttribute(a,i)),"string"==typeof h&&t.push(h));if(o)for(i in o)j=x[o[i]],j&&(newStyle=j(b.dom.getAttribute(a,i)),"string"==typeof newStyle&&v.push(newStyle));if("string"==typeof q&&"any"===q)if(a.getAttribute("class"))if(u.classes_blacklist){for(z=a.getAttribute("class"),z&&(t=t.concat(z.split(s))),f=t.length;r<f;r++)g=t[r],u.classes_blacklist[g]||w.push(g);w.length&&(k.class=b.lang.array(w).unique().join(" "))}else k.class=a.getAttribute("class");else t&&t.length>0&&(k.class=b.lang.array(t).unique().join(" "));else{for(e||(q["_wysihtml5-temp-placeholder"]=1,q._rangySelectionBoundary=1,q["wysiwyg-tmp-selected-cell"]=1),z=a.getAttribute("class"),z&&(t=t.concat(z.split(s))),f=t.length;r<f;r++)g=t[r],q[g]&&w.push(g);w.length&&(k.class=b.lang.array(w).unique().join(" "))}k.class&&e&&(k.class=k.class.replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(k.class)&&delete k.class),v.length&&(k.style=b.lang.array(v).unique().join(" "));for(i in k)try{c.setAttribute(i,k[i])}catch(a){}k.src&&(void 0!==k.width&&c.setAttribute("width",k.width),void 0!==k.height&&c.setAttribute("height",k.height))}function o(a){var c,d=a.nextSibling;if(!d||d.nodeType!==b.TEXT_NODE)return c=a.data.replace(b.INVISIBLE_SPACE_REG_EXP,""),a.ownerDocument.createTextNode(c);d.data=a.data.replace(b.INVISIBLE_SPACE_REG_EXP,"")+d.data.replace(b.INVISIBLE_SPACE_REG_EXP,"")}function p(a){if(u.comments)return a.ownerDocument.createComment(a.nodeValue)}var q={1:g,3:o,8:p},r="span",s=/\s+/,t={tags:{},classes:{}},u={},v=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"],w={url:function(){var a=/^https?:\/\//i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),src:function(){var a=/^(\/|https?:\/\/)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),href:function(){var a=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),alt:function(){var a=/[^ a-z0-9_\-]/gi;return function(b,c){return b?b.replace(a,""):"IMG"===c?"":null}}(),numbers:function(){var a=/\D/g;return function(b){return b=(b||"").replace(a,""),b||null}}(),dimension:function(){var a=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(b){return b=(b||"").replace(a,"$1$2$3"),b||null}}(),any:function(){return function(a){return a||null}}()},x={align_text:function(){var a={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(b){return a[(b+"").toLowerCase()]}}()},y={align_img:function(){var a={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(b){return a[(b+"").toLowerCase()]}}(),align_text:function(){var a={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(b){return a[(b+"").toLowerCase()]}}(),clear_br:function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(b){return a[(b+"").toLowerCase()]}}(),size_font:function(){var a={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(b){return a[(b+"")[0]]}}()},z={has_visible_contet:function(){var a,b=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(c){if(a=(c.innerText||c.textContent).replace(/\s/g,""),a&&a.length>0)return!0;for(var d=b.length;d--;)if(c.querySelector(b[d]))return!0;return!!(c.offsetWidth&&c.offsetWidth>0&&c.offsetHeight&&c.offsetHeight>0)}}()},A={unwrap:function(a){b.dom.unwrap(a)},remove:function(a){a.parentNode.removeChild(a)}};return d(a,c)},b.dom.removeEmptyTextNodes=function(a){for(var c,d=b.lang.array(a.childNodes).get(),e=d.length,f=0;f<e;f++)c=d[f],c.nodeType===b.TEXT_NODE&&/^[\n\r]*$/.test(c.data)&&c.parentNode.removeChild(c)},b.dom.renameElement=function(a,c){for(var d,e=a.ownerDocument.createElement(c);d=a.firstChild;)e.appendChild(d);return b.dom.copyAttributes(["align","className"]).from(a).to(e),a.parentNode&&a.parentNode.replaceChild(e,a),e},b.dom.replaceWithChildNodes=function(a){if(a.parentNode){for(;a.firstChild;)a.parentNode.insertBefore(a.firstChild,a);a.parentNode.removeChild(a)}},function(a){function c(b){return"block"===a.getStyle("display").from(b)}function d(a){return"BR"===a.nodeName}function e(a){var b=a.ownerDocument.createElement("br");a.appendChild(b)}function f(a,f){if(a.nodeName.match(/^(MENU|UL|OL)$/)){var g,h,i,j,k,l,m,n=a.ownerDocument,o=n.createDocumentFragment(),p=b.dom.domNode(a).prev({ignoreBlankTexts:!0}),q=b.dom.domNode(a).next({ignoreBlankTexts:!0}),r=a.lastElementChild||a.lastChild;if(f)for(!p||c(p)||d(p)||e(o);l=a.firstElementChild||a.firstChild;){for(h=l.lastChild,m=l===r;g=l.firstChild;)i=g===h,j=(!m||q&&!c(q))&&i&&!c(g)&&!d(g),o.appendChild(g),j&&e(o);l.parentNode.removeChild(l)}else for(;l=a.firstElementChild||a.firstChild;){if(l.querySelector&&l.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;g=l.firstChild;)o.appendChild(g);else{for(k=n.createElement("p");g=l.firstChild;)k.appendChild(g);o.appendChild(k)}l.parentNode.removeChild(l)}a.parentNode.replaceChild(o,a)}}a.resolveList=f}(b.dom),function(a){var b=document,c=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],e=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],f=["referrer","write","open","close"];a.dom.Sandbox=d.extend({constructor:function(b,c){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),this.editableArea=this._createIframe()},insertInto:function(a){"string"==typeof a&&(a=b.getElementById(a)),a.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var c=this,d=b.createElement("iframe");return d.className=this.config.className,a.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(d),a.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(d.src="javascript:'<html></html>'"),d.onload=function(){d.onreadystatechange=d.onload=null,c._onLoadIframe(d)},d.onreadystatechange=function(){/loaded|complete/.test(d.readyState)&&(d.onreadystatechange=d.onload=null,c._onLoadIframe(d))},d},_onLoadIframe:function(d){var g,h,i,j,k,l,m;if(a.dom.contains(b.documentElement,d)){if(g=this,h=d.contentWindow,i=d.contentWindow.document,j=b.characterSet||b.charset||"utf-8",k=this._getHtml({charset:j,stylesheets:this.config.stylesheets}),i.open("text/html","replace"),i.write(k),i.close(),this.getWindow=function(){return d.contentWindow},this.getDocument=function(){return d.contentWindow.document},h.onerror=function(a,b,c){throw Error("wysihtml5.Sandbox: "+a,b,c)},!a.browser.supportsSandboxedIframes()){for(l=0,m=c.length;l<m;l++)this._unset(h,c[l]);for(l=0,m=e.length;l<m;l++)this._unset(h,e[l],a.EMPTY_FUNCTION);for(l=0,m=f.length;l<m;l++)this._unset(i,f[l]);this._unset(i,"cookie","",!0)}a.polyfills&&a.polyfills(h,i),this.loaded=!0,setTimeout(function(){g.callback(g)},0)}},_getHtml:function(b){var c,d=b.stylesheets,e="",f=0;if(d="string"==typeof d?[d]:d,d)for(c=d.length;f<c;f++)e+='<link rel="stylesheet" href="'+d[f]+'">';return b.stylesheets=e,a.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},_unset:function(b,c,d,e){try{b[c]=d}catch(a){}try{b.__defineGetter__(c,function(){return d})}catch(a){}if(e)try{b.__defineSetter__(c,function(){})}catch(a){}if(!a.browser.crashesWhenDefineProperty(c))try{var f={get:function(){return d}};e&&(f.set=function(){}),Object.defineProperty(b,c,f)}catch(a){}}})}(b),function(a){var b=document;a.dom.ContentEditableArea=d.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(b,c,d){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),this.config.className||(this.config.className="wysihtml5-sandbox"),this.element=d?this._bindElement(d):this._createElement()},destroy:function(){},_createElement:function(){var a=b.createElement("div");return a.className=this.config.className,this._loadElement(a),a},_bindElement:function(a){return a.className=a.className?a.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(a,!0),a},_loadElement:function(a,b){var c,d=this;b||(c=this._getHtml(),a.innerHTML=c),this.loaded=!0,setTimeout(function(){d.callback(d)},0)},_getHtml:function(a){return""}})}(b),function(){var a={className:"class"};b.dom.setAttributes=function(b){return{on:function(c){for(var d in b)c.setAttribute(a[d]||d,b[d])}}}}(),b.dom.setStyles=function(a){return{on:function(b){var c,d=b.style;if("string"==typeof a)return d.cssText+=";"+a,void 0;for(c in a)"float"===c?(d.cssFloat=a[c],d.styleFloat=a[c]):d[c]=a[c]}}},function(a){a.simulatePlaceholder=function(b,c,d,e){var f=e||"wysihtml5-placeholder",g=function(){var b=c.element.offsetWidth>0&&c.element.offsetHeight>0;c.hasPlaceholderSet()&&(c.clear(),c.element.focus(),b&&setTimeout(function(){var a=c.selection.getSelection();a.focusNode&&a.anchorNode||c.selection.selectNode(c.element.firstChild||c.element)},0)),c.placeholderSet=!1,a.removeClass(c.element,f)},h=function(){c.isEmpty()&&!c.placeholderSet&&(c.placeholderSet=!0,c.setValue(d,!1),a.addClass(c.element,f))};b.on("set_placeholder",h).on("unset_placeholder",g).on("focus:composer",g).on("paste:composer",g).on("blur:composer",h),h()}}(b.dom),function(a){var b=document.documentElement;"textContent"in b?(a.setTextContent=function(a,b){a.textContent=b},a.getTextContent=function(a){return a.textContent}):"innerText"in b?(a.setTextContent=function(a,b){a.innerText=b},a.getTextContent=function(a){return a.innerText}):(a.setTextContent=function(a,b){a.nodeValue=b},a.getTextContent=function(a){return a.nodeValue})}(b.dom),b.dom.getAttribute=function(a,c){var d,e,f,g=!b.browser.supportsGetAttributeCorrectly();return c=c.toLowerCase(),d=a.nodeName,"IMG"==d&&"src"==c&&!0===b.dom.isLoadedImage(a)?a.src:g&&"outerHTML"in a?(e=a.outerHTML.toLowerCase(),f=-1!=e.indexOf(" "+c+"="),f?a.getAttribute(c):null):a.getAttribute(c)},b.dom.getAttributes=function(a){var c,d=!b.browser.supportsGetAttributeCorrectly(),e=a.nodeName,f=[];for(c in a.attributes)(a.attributes.hasOwnProperty&&a.attributes.hasOwnProperty(c)||!a.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(a.attributes,c))&&a.attributes[c].specified&&("IMG"==e&&"src"==a.attributes[c].name.toLowerCase()&&!0===b.dom.isLoadedImage(a)?f.src=a.src:b.lang.array(["rowspan","colspan"]).contains(a.attributes[c].name.toLowerCase())&&d?1!==a.attributes[c].value&&(f[a.attributes[c].name]=a.attributes[c].value):f[a.attributes[c].name]=a.attributes[c].value);return f},b.dom.isLoadedImage=function(a){try{return a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(b){if(a.complete&&"complete"===a.readyState)return!0}},function(a){function b(a,b){var c,d,e,f,g=[];for(d=0,e=a.length;d<e;d++)if(c=a[d].querySelectorAll(b),c)for(f=c.length;f--;g.unshift(c[f]));return g}function d(a){a.parentNode.removeChild(a)}function e(a,b){a.parentNode.insertBefore(b,a.nextSibling)}function f(a,b){for(var c=a.nextSibling;1!=c.nodeType;)if(c=c.nextSibling,!b||b==c.tagName.toLowerCase())return c;return null}var g=a.dom,h=function(a){this.el=a,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},i=function(a,b){a?(this.cell=a,this.table=g.getParentElement(a,{query:"table"})):b&&(this.table=b,this.cell=this.table.querySelectorAll("th, td")[0])};i.prototype={addSpannedCellToMap:function(a,b,c,d,e,f){var g,i,j=[],k=c+(f?parseInt(f,10)-1:0),l=d+(e?parseInt(e,10)-1:0);for(g=c;g<=k;g++)for(void 0===b[g]&&(b[g]=[]),i=d;i<=l;i++)b[g][i]=new h(a),b[g][i].isColspan=e&&parseInt(e,10)>1,b[g][i].isRowspan=f&&parseInt(f,10)>1,b[g][i].firstCol=i==d,b[g][i].lastCol=i==l,b[g][i].firstRow=g==c,b[g][i].lastRow=g==k,b[g][i].isReal=i==d&&g==c,b[g][i].spanCollection=j,j.push(b[g][i])},setCellAsModified:function(a){if(a.modified=!0,a.spanCollection.length>0)for(var b=0,c=a.spanCollection.length;b<c;b++)a.spanCollection[b].modified=!0},setTableMap:function(){var a,b,c,d,e,f,i,j,k=[],l=this.getTableRows();for(a=0;a<l.length;a++)for(b=l[a],c=this.getRowCells(b),f=0,void 0===k[a]&&(k[a]=[]),d=0;d<c.length;d++){for(e=c[d];void 0!==k[a][f];)f++;i=g.getAttribute(e,"colspan"),j=g.getAttribute(e,"rowspan"),i||j?(this.addSpannedCellToMap(e,k,a,f,i,j),f+=i?parseInt(i,10):1):(k[a][f]=new h(e),f++)}return this.map=k,k},getRowCells:function(c){var d=this.table.querySelectorAll("table"),e=d?b(d,"th, td"):[],f=c.querySelectorAll("th, td");return e.length>0?a.lang.array(f).without(e):f},getTableRows:function(){var c=this.table.querySelectorAll("table"),d=c?b(c,"tr"):[],e=this.table.querySelectorAll("tr");return d.length>0?a.lang.array(e).without(d):e},getMapIndex:function(a){var b,c,d=this.map.length,e=this.map&&this.map[0]?this.map[0].length:0;for(b=0;b<d;b++)for(c=0;c<e;c++)if(this.map[b][c].el===a)return{row:b,col:c};return!1},getElementAtIndex:function(a){return this.setTableMap(),this.map[a.row]&&this.map[a.row][a.col]&&this.map[a.row][a.col].el?this.map[a.row][a.col].el:null},getMapElsTo:function(a){var b,c,d,e,f,g,h=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(a),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(b=this.idx_start,this.idx_start=this.idx_end,this.idx_end=b),this.idx_start.col>this.idx_end.col&&(c=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=c),null!=this.idx_start&&null!=this.idx_end)for(d=this.idx_start.row,e=this.idx_end.row;d<=e;d++)for(f=this.idx_start.col,g=this.idx_end.col;f<=g;f++)h.push(this.map[d][f].el);return h},orderSelectionEnds:function(a){var b,c;return this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(a),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(b=this.idx_start,this.idx_start=this.idx_end,this.idx_end=b),this.idx_start.col>this.idx_end.col&&(c=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=c),{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(a,b,c){var d,e,f,g=this.table.ownerDocument,h=g.createDocumentFragment();for(e=0;e<b;e++){if(d=g.createElement(a),c)for(f in c)c.hasOwnProperty(f)&&d.setAttribute(f,c[f]);d.appendChild(document.createTextNode(" ")),h.appendChild(d)}return h},correctColIndexForUnreals:function(a,b){var c,d=this.map[b],e=-1;for(c=0,a;c<a;c++)d[c].isReal&&e++;return e},getLastNewCellOnRow:function(a,b){var c,d,e,f,g=this.getRowCells(a);for(e=0,f=g.length;e<f;e++)if(c=g[e],d=this.getMapIndex(c),!1===d||void 0!==b&&d.row!=b)return c;return null},removeEmptyTable:function(){var a=this.table.querySelectorAll("td, th");return(!a||0==a.length)&&(d(this.table),!0)},splitRowToCells:function(a){var b,c,d;a.isColspan&&(b=parseInt(g.getAttribute(a.el,"colspan")||1,10),c=a.el.tagName.toLowerCase(),b>1&&(d=this.createCells(c,b-1),e(a.el,d)),a.el.removeAttribute("colspan"))},getRealRowEl:function(a,b){var c,d,e=null,f=null;for(b=b||this.idx,c=0,d=this.map[b.row].length;c<d;c++)if(f=this.map[b.row][c],f.isReal&&(e=g.getParentElement(f.el,{query:"tr"}),e))return e;return null===e&&a&&(e=g.getParentElement(this.map[b.row][b.col].el,{query:"tr"})||null),e},injectRowAt:function(a,b,c,d,f){var h,i,j=this.getRealRowEl(!1,{row:a,col:b}),k=this.createCells(d,c);j?(h=this.correctColIndexForUnreals(b,a),h>=0?e(this.getRowCells(j)[h],k):j.insertBefore(k,j.firstChild)):(i=this.table.ownerDocument.createElement("tr"),i.appendChild(k),e(g.getParentElement(f.el,{query:"tr"}),i))},canMerge:function(a){var b,c,d,e,f,g;for(this.to=a,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(b=this.idx_start,this.idx_start=this.idx_end,this.idx_end=b),this.idx_start.col>this.idx_end.col&&(c=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=c),d=this.idx_start.row,e=this.idx_end.row;d<=e;d++)for(f=this.idx_start.col,g=this.idx_end.col;f<=g;f++)if(this.map[d][f].isColspan||this.map[d][f].isRowspan)return!1;return!0},decreaseCellSpan:function(a,b){var c=parseInt(g.getAttribute(a.el,b),10)-1;c>=1?a.el.setAttribute(b,c):(a.el.removeAttribute(b),"colspan"==b&&(a.isColspan=!1),"rowspan"==b&&(a.isRowspan=!1),a.firstCol=!0,a.lastCol=!0,a.firstRow=!0,a.lastRow=!0,a.isReal=!0)},removeSurplusLines:function(){var a,b,c,e,f,h,i,j;if(this.setTableMap(),this.map){for(c=0,e=this.map.length;c<e;c++){for(a=this.map[c],i=!0,f=0,h=a.length;f<h;f++)if(b=a[f],!(g.getAttribute(b.el,"rowspan")&&parseInt(g.getAttribute(b.el,"rowspan"),10)>1&&!0!==b.firstRow)){i=!1;break}if(i)for(f=0;f<h;f++)this.decreaseCellSpan(a[f],"rowspan")}for(j=this.getTableRows(),c=0,e=j.length;c<e;c++)a=j[c],0==a.childNodes.length&&/^\s*$/.test(a.textContent||a.innerText)&&d(a)}},fillMissingCells:function(){var a,b,c,d=0,f=0,g=null;if(this.setTableMap(),this.map){for(d=this.map.length,a=0;a<d;a++)this.map[a].length>f&&(f=this.map[a].length);for(b=0;b<d;b++)for(c=0;c<f;c++)this.map[b]&&!this.map[b][c]&&c>0&&(this.map[b][c]=new h(this.createCells("td",1)),g=this.map[b][c-1],g&&g.el&&g.el.parent&&e(this.map[b][c-1].el,this.map[b][c].el))}},rectify:function(){return!this.removeEmptyTable()&&(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){var a,b,c,d,e,f;if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){if(a=this.map[this.idx.row][this.idx.col],b=g.getAttribute(a.el,"colspan")?parseInt(g.getAttribute(a.el,"colspan"),10):1,c=a.el.tagName.toLowerCase(),a.isRowspan){if(d=parseInt(g.getAttribute(a.el,"rowspan"),10),d>1)for(e=1,f=d-1;e<=f;e++)this.injectRowAt(this.idx.row+e,this.idx.col,b,c,a);a.el.removeAttribute("rowspan")}this.splitRowToCells(a)}},merge:function(a){var b,c,e,f,g,h;if(this.rectify())if(this.canMerge(a)){for(b=this.idx_end.row-this.idx_start.row+1,c=this.idx_end.col-this.idx_start.col+1,e=this.idx_start.row,f=this.idx_end.row;e<=f;e++)for(g=this.idx_start.col,h=this.idx_end.col;g<=h;g++)e==this.idx_start.row&&g==this.idx_start.col?(b>1&&this.map[e][g].el.setAttribute("rowspan",b),c>1&&this.map[e][g].el.setAttribute("colspan",c)):(/^\s*<br\/?>\s*$/.test(this.map[e][g].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[e][g].el.innerHTML),d(this.map[e][g].el));this.rectify()}else window.console&&void 0},collapseCellToNextRow:function(a){var b,c,d,f=this.getMapIndex(a.el),h=f.row+1,i={row:h,col:f.col};h<this.map.length&&(b=this.getRealRowEl(!1,i),null!==b&&(c=this.correctColIndexForUnreals(i.col,i.row),c>=0?e(this.getRowCells(b)[c],a.el):(d=this.getLastNewCellOnRow(b,h),null!==d?e(d,a.el):b.insertBefore(a.el,b.firstChild)),parseInt(g.getAttribute(a.el,"rowspan"),10)>2?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")))},removeRowCell:function(a){a.isReal?a.isRowspan?this.collapseCellToNextRow(a):d(a.el):parseInt(g.getAttribute(a.el,"rowspan"),10)>2?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var a,b,c,d=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(a=this.map[this.idx.row],b=0,c=a.length;b<c;b++)a[b].isReal&&d.push(a[b].el);return d},getColumnElementsByCell:function(){var a,b,c=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(a=0,b=this.map.length;a<b;a++)this.map[a][this.idx.col]&&this.map[a][this.idx.col].isReal&&c.push(this.map[a][this.idx.col].el);return c},removeRow:function(){var a,b,c,e=g.getParentElement(this.cell,{query:"tr"});if(e){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(a=this.map[this.idx.row],b=0,c=a.length;b<c;b++)a[b].modified||(this.setCellAsModified(a[b]),this.removeRowCell(a[b]));d(e)}},removeColCell:function(a){a.isColspan?parseInt(g.getAttribute(a.el,"colspan"),10)>2?a.el.setAttribute("colspan",parseInt(g.getAttribute(a.el,"colspan"),10)-1):a.el.removeAttribute("colspan"):a.isReal&&d(a.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),!1!==this.idx)for(var a=0,b=this.map.length;a<b;a++)this.map[a][this.idx.col].modified||(this.setCellAsModified(this.map[a][this.idx.col]),this.removeColCell(this.map[a][this.idx.col]))},remove:function(a){if(this.rectify()){switch(a){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(a){var b,c,d,f,h,i=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==a&&g.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(g.getAttribute(this.cell,"rowspan"),10)-1),!1!==this.idx){for(b=this.map[this.idx.row],c=i.createElement("tr"),d=0,f=b.length;d<f;d++)b[d].modified||(this.setCellAsModified(b[d]),this.addRowCell(b[d],c,a));switch(a){case"below":e(this.getRealRowEl(!0),c);break;case"above":h=g.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"}),h&&h.parentNode.insertBefore(c,h)}}},addRowCell:function(a,b,d){var e=a.isColspan?{colspan:g.getAttribute(a.el,"colspan")}:null;a.isReal?"above"!=d&&a.isRowspan?a.el.setAttribute("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)+1):b.appendChild(this.createCells("td",1,e)):"above"!=d&&a.isRowspan&&a.lastRow?b.appendChild(this.createCells("td",1,e)):c.isRowspan&&a.el.attr("rowspan",parseInt(g.getAttribute(a.el,"rowspan"),10)+1)},add:function(a){this.rectify()&&("below"!=a&&"above"!=a||this.addRow(a),"before"!=a&&"after"!=a||this.addColumn(a))},addColCell:function(a,b,d){var f,h=a.el.tagName.toLowerCase();switch(d){case"before":f=!a.isColspan||a.firstCol;break;case"after":f=!a.isColspan||a.lastCol||a.isColspan&&c.el==this.cell}if(f){switch(d){case"before":a.el.parentNode.insertBefore(this.createCells(h,1),a.el);break;case"after":e(a.el,this.createCells(h,1))}a.isRowspan&&this.handleCellAddWithRowspan(a,b+1,d)}else a.el.setAttribute("colspan",parseInt(g.getAttribute(a.el,"colspan"),10)+1)},addColumn:function(a){var b,c,d,e;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==a&&g.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(g.getAttribute(this.cell,"colspan"),10)-1),!1!==this.idx)for(d=0,e=this.map.length;d<e;d++)b=this.map[d],b[this.idx.col]&&(c=b[this.idx.col],c.modified||(this.setCellAsModified(c),this.addColCell(c,d,a)))},handleCellAddWithRowspan:function(a,b,c){var d,h,i,j,k=parseInt(g.getAttribute(this.cell,"rowspan"),10)-1,l=g.getParentElement(a.el,{query:"tr"}),m=a.el.tagName.toLowerCase(),n=this.table.ownerDocument;for(j=0;j<k;j++)if(d=this.correctColIndexForUnreals(this.idx.col,b+j),l=f(l,"tr"),l)if(d>0)switch(c){case"before":h=this.getRowCells(l),d>0&&this.map[b+j][this.idx.col].el!=h[d]&&d==h.length-1?e(h[d],this.createCells(m,1)):h[d].parentNode.insertBefore(this.createCells(m,1),h[d]);break;case"after":e(this.getRowCells(l)[d],this.createCells(m,1))}else l.insertBefore(this.createCells(m,1),l.firstChild);else i=n.createElement("tr"),i.appendChild(this.createCells(m,1)),this.table.appendChild(i)}},g.table={getCellsBetween:function(a,b){return new i(a).getMapElsTo(b)},addCells:function(a,b){new i(a).add(b)},removeCells:function(a,b){new i(a).remove(b)},mergeCellsBetween:function(a,b){new i(a).merge(b)},unmergeCell:function(a){new i(a).unmerge()},orderSelectionEnds:function(a,b){return new i(a).orderSelectionEnds(b)},indexOf:function(a){var b=new i(a);return b.setTableMap(),b.getMapIndex(a)},findCell:function(a,b){return new i(null,a).getElementAtIndex(b)},findRowByCell:function(a){return new i(a).getRowElementsByCell()},findColumnByCell:function(a){return new i(a).getColumnElementsByCell()},canMerge:function(a,b){return new i(a).canMerge(b)}}}(b),b.dom.query=function(a,b){var c,d,e,f,g=[];for(a.nodeType&&(a=[a]),d=0,e=a.length;d<e;d++)if(c=a[d].querySelectorAll(b),c)for(f=c.length;f--;g.unshift(c[f]));return g},b.dom.compareDocumentPosition=function(){return document.documentElement.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)}:function(a,c){var d,e,f,g,h,i,j,k,l;if(d=9===a.nodeType?a:a.ownerDocument,e=9===c.nodeType?c:c.ownerDocument,a===c)return 0;if(a===c.ownerDocument)return 20;if(a.ownerDocument===c)return 10;if(d!==e)return 1;if(2===a.nodeType&&a.childNodes&&-1!==b.lang.array(a.childNodes).indexOf(c))return 20;if(2===c.nodeType&&c.childNodes&&-1!==b.lang.array(c.childNodes).indexOf(a))return 10;for(f=a,g=[],h=null;f;){if(f==c)return 10;g.push(f),f=f.parentNode}for(f=c,h=null;f;){if(f==a)return 20;if(i=b.lang.array(g).indexOf(f),-1!==i)return j=g[i],k=b.lang.array(j.childNodes).indexOf(g[i-1]),l=b.lang.array(j.childNodes).indexOf(h),k>l?2:4;h=f,f=f.parentNode}return 1}}(),b.dom.unwrap=function(a){var c=[];if(a.parentNode){for(;a.lastChild;)c.unshift(a.lastChild),b.dom.insert(a.lastChild).after(a);a.parentNode.removeChild(a)}return c},b.dom.getPastedHtml=function(a){var c;return b.browser.supportsModernPaste()&&a.clipboardData&&(b.lang.array(a.clipboardData.types).contains("text/html")?c=a.clipboardData.getData("text/html"):b.lang.array(a.clipboardData.types).contains("text/plain")&&(c=b.lang.string(a.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),c},b.dom.getPastedHtmlWithDiv=function(a,b){var c=a.selection.getBookmark(),d=a.element.ownerDocument,e=d.createElement("DIV"),f=a.getScrollPos();d.body.appendChild(e),e.style.width="1px",e.style.height="1px",e.style.overflow="hidden",e.style.position="absolute",e.style.top=f.y+"px",e.style.left=f.x+"px",e.setAttribute("contenteditable","true"),e.focus(),setTimeout(function(){var d;a.selection.setBookmark(c),d=e.innerHTML,d&&/^<br\/?>$/i.test(d.trim())&&(d=!1),b(d),e.parentNode.removeChild(e)},0)},b.dom.removeInvisibleSpaces=function(a){var c,d=b.dom.getTextNodes(a);for(c=d.length;c--;)d[c].nodeValue=d[c].nodeValue.replace(b.INVISIBLE_SPACE_REG_EXP,"")},b.quirks.cleanPastedHTML=function(){var a=function(a){var c=b.lang.string(a).trim(),d=c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return RegExp("^((?!^"+d+"$).)*$","i")},c=function(c,d){var e,f,g=b.lang.object(c).clone(!0);for(e in g.tags)if(g.tags.hasOwnProperty(e)&&g.tags[e].keep_styles)for(f in g.tags[e].keep_styles)g.tags[e].keep_styles.hasOwnProperty(f)&&d[f]&&(g.tags[e].keep_styles[f]=a(d[f]));return g},d=function(a,b){var c,d,e;if(!a)return null;for(d=0,e=a.length;d<e;d++)if(a[d].condition||(c=a[d].set),a[d].condition&&a[d].condition.test(b))return a[d].set;return c};return function(a,e){var f,g={color:b.dom.getStyle("color").from(e.referenceNode),fontSize:b.dom.getStyle("font-size").from(e.referenceNode)},h=c(d(e.rules,a)||{},g);return f=b.dom.parse(a,{rules:h,cleanUp:!0,context:e.referenceNode.ownerDocument,uneditableClass:e.uneditableClass,clearInternals:!0,unjoinNbsps:!0}),f}}(),b.quirks.ensureProperClearing=function(){var a=function(){var a=this;setTimeout(function(){var b=a.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=b&&"<p>&nbsp;</p><p>&nbsp;</p>"!=b||(a.innerHTML="")},0)};return function(c){b.dom.observe(c.element,["cut","keydown"],a)}}(),function(a){var b="%7E";a.quirks.getCorrectInnerHTML=function(c){var d,e,f,g,h,i=c.innerHTML;if(-1===i.indexOf(b))return i;for(d=c.querySelectorAll("[href*='~'], [src*='~']"),h=0,g=d.length;h<g;h++)e=d[h].href||d[h].src,f=a.lang.string(e).replace("~").by(b),i=a.lang.string(i).replace(f).by(e);return i}}(b),function(a){var b="wysihtml5-quirks-redraw";a.quirks.redraw=function(c){a.dom.addClass(c,b),a.dom.removeClass(c,b);try{var d=c.ownerDocument;d.execCommand("italic",!1,null),d.execCommand("italic",!1,null)}catch(a){}}}(b),b.quirks.tableCellsSelection=function(a,c){function d(){return a.addEventListener("mousedown",o),m}function e(b){m.start=b,m.end=b,m.cells=[b],m.table=l.getParentElement(m.start,{query:"table"},!1,a),m.table&&(f(),l.addClass(b,n),a.addEventListener("mousemove",h),a.addEventListener("mouseup",i),c.fire("tableselectstart").fire("tableselectstart:composer"))}function f(){var b,c;if(a&&(b=a.querySelectorAll("."+n),b.length>0))for(c=0;c<b.length;c++)l.removeClass(b[c],n)}function g(a){for(var b=0;b<a.length;b++)l.addClass(a[b],n)}function h(b){var d,e=null,h=l.getParentElement(b.target,{query:"td, th"},!1,a);h&&m.table&&m.start&&(e=l.getParentElement(h,{query:"table"},!1,a),e&&e===m.table&&(f(),d=m.end,m.end=h,m.cells=l.table.getCellsBetween(m.start,h),m.cells.length>1&&c.composer.selection.deselect(),g(m.cells),m.end!==d&&c.fire("tableselectchange").fire("tableselectchange:composer")))}function i(b){a.removeEventListener("mousemove",h),a.removeEventListener("mouseup",i),c.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){j()},0)}function j(){a.ownerDocument.addEventListener("click",p)}function k(b,d){m.start=b,m.end=d,m.table=l.getParentElement(m.start,{query:"table"},!1,a),selectedCells=l.table.getCellsBetween(m.start,m.end),g(selectedCells),j(),c.fire("tableselect").fire("tableselect:composer")}var l=b.dom,m={table:null,start:null,end:null,cells:null,select:k},n="wysiwyg-tmp-selected-cell",o=function(c){var d=b.dom.getParentElement(c.target,{query:"td, th"},!1,a);d&&e(d)},p=function(b){a.ownerDocument.removeEventListener("click",p),l.getParentElement(b.target,{query:"table"},!1,a)!=m.table&&(f(),m.table=null,m.start=null,m.end=null,c.fire("tableunselect").fire("tableunselect:composer"))};return d()},function(a){function b(a){var b,c;for(b in d)if(d.hasOwnProperty(b)&&(c=d[b],c.regex.test(a)))return c}function c(a){var c=b(a);return c?c.name:void 0}var d={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},e=function(a){return RegExp("(^|\\s|;)"+a+"\\s*:\\s*[^;$]+","gi")};a.quirks.styleParser={getColorParseMethod:b,getColorFormat:c,parseColor:function(c,f){var g,h,i,j,k,l=c;if(f){if(g=e(f),!(h=c.match(g)))return!1;h=h.pop().split(":")[1],l=a.lang.string(h).trim()}return!!(i=b(l))&&(!!(j=l.match(i.regex))&&(k=i.radix||10,i===d.hex3?(j.shift(),j.push(1),a.lang.array(j).map(function(a,b){return b<3?parseInt(a,k)*k+parseInt(a,k):parseFloat(a)})):(j.shift(),j[3]||j.push(1),a.lang.array(j).map(function(a,b){return b<3?parseInt(a,k):parseFloat(a)}))))},unparseColor:function(a,b){var c=16;return"hex"===b?(a[0].toString(c)+a[1].toString(c)+a[2].toString(c)).toUpperCase():"hash"===b?"#"+(a[0].toString(c)+a[1].toString(c)+a[2].toString(c)).toUpperCase():"rgb"===b?"rgb("+a[0]+","+a[1]+","+a[2]+")":"rgba"===b?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"csv"===b?a[0]+","+a[1]+","+a[2]+","+a[3]:a[3]&&1!==a[3]?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"rgb("+a[0]+","+a[1]+","+a[2]+")"},parseFontSize:function(b){var c=b.match(e("font-size"));return!!c&&a.lang.string(c[c.length-1].split(":")[1]).trim()}}}(b),function(b){function c(a){var b=0;if(a.parentNode)do{b+=a.offsetTop||0,a=a.offsetParent}while(a);return b}function e(a,b){for(var c=0;b!==a;)if(c++,b=b.parentNode,!b)throw Error("not a descendant of ancestor!");return c}function f(a,b){return 3===a.nodeType?a:a.childNodes[b]||a}function g(a){var c=document.createElement("span"),d=function(b){a.removeEventListener("mouseup",d),a.removeEventListener("keydown",d),a.removeEventListener("touchstart",d),a.removeEventListener("focus",d),a.removeEventListener("blur",d),a.removeEventListener("paste",e),a.removeEventListener("drop",e),a.removeEventListener("beforepaste",e),c&&c.parentNode&&c.parentNode.removeChild(c)},e=function(a){c&&c.parentNode&&setTimeout(d,0)};return c.appendChild(a.ownerDocument.createTextNode(b.INVISIBLE_SPACE)),c.className="_wysihtml5-temp-caret-fix",c.style.display="block",c.style.minWidth="1px",c.style.height="0px",a.addEventListener("mouseup",d),a.addEventListener("keydown",d),a.addEventListener("touchstart",d),a.addEventListener("focus",d),a.addEventListener("blur",d),a.addEventListener("paste",e),a.addEventListener("drop",e),a.addEventListener("beforepaste",e),c}function h(a){if(!a.canSurroundContents())for(var b=a.commonAncestorContainer,c=e(b,a.startContainer),d=e(b,a.endContainer);!a.canSurroundContents();)c>d?(a.setStartBefore(a.startContainer),c=e(b,a.startContainer)):(a.setEndAfter(a.endContainer),d=e(b,a.endContainer))}var i=b.dom;b.Selection=d.extend({constructor:function(b,c,d){a.init(),this.editor=b,this.composer=b.composer,this.doc=this.composer.doc,this.win=this.composer.win,this.contain=c,this.unselectableClass=d||!1},getBookmark:function(){var a=this.getRange();return a&&a.cloneRange()},setBookmark:function(a){a&&this.setSelection(a)},setBefore:function(b){var c=a.createRange(this.doc);return c.setStartBefore(b),c.setEndBefore(b),this.setSelection(c)},createTemporaryCaretSpaceAfter:function(a){var c=this.doc.createElement("span"),d=this.doc.createTextNode(b.INVISIBLE_SPACE),e=function(a){var d;this.contain.removeEventListener("mouseup",e),this.contain.removeEventListener("keydown",g),this.contain.removeEventListener("touchstart",e),this.contain.removeEventListener("focus",e),this.contain.removeEventListener("blur",e),this.contain.removeEventListener("paste",f),this.contain.removeEventListener("drop",f),this.contain.removeEventListener("beforepaste",f),c&&c.parentNode&&(c.innerHTML=c.innerHTML.replace(b.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(c.innerHTML)?(d=c.lastChild,b.dom.unwrap(c),this.setAfter(d)):c.parentNode.removeChild(c))}.bind(this),f=function(a){c&&c.parentNode&&setTimeout(e,0)},g=function(a){8===a.which||91===a.which||17===a.which||86===a.which&&(a.ctrlKey||a.metaKey)||e()};return c.className="_wysihtml5-temp-caret-fix",c.style.position="absolute",c.style.display="block",c.style.minWidth="1px",c.style.zIndex="99999",c.appendChild(d),a.parentNode.insertBefore(c,a.nextSibling),this.setBefore(d),this.contain.addEventListener("mouseup",e),this.contain.addEventListener("keydown",g),this.contain.addEventListener("touchstart",e),this.contain.addEventListener("focus",e),this.contain.addEventListener("blur",e),this.contain.addEventListener("paste",f),this.contain.addEventListener("drop",f),this.contain.addEventListener("beforepaste",f),c},setAfter:function(c,d,e){var f,g,h=this.win,i=a.createRange(this.doc),j=function(){var a,e=c.parentNode,g=e?e.childNodes[e.childNodes.length-1]:null;(!f||g===c&&1===c.nodeType&&"block"===h.getComputedStyle(c).display)&&(d?(a=this.doc.createTextNode(b.INVISIBLE_SPACE),c.parentNode.insertBefore(a,c.nextSibling),this.selectNode(a),setTimeout(function(){a&&a.parentNode&&a.parentNode.removeChild(a)},0)):this.createTemporaryCaretSpaceAfter(c))}.bind(this);i.setStartAfter(c),i.setEndAfter(c),document.activeElement&&document.activeElement===this.composer.element?(f=this.setSelection(i),j(),e&&e(f)):(g=this.composer.getScrollPos(),this.composer.element.focus(),this.composer.setScrollPos(g),setTimeout(function(){f=this.setSelection(i),j(),e&&e(f)}.bind(this),0))},selectNode:function(c,d){var e=a.createRange(this.doc),f=c.nodeType===b.ELEMENT_NODE,g="canHaveHTML"in c?c.canHaveHTML:"IMG"!==c.nodeName,h=f?c.innerHTML:c.data,j=""===h||h===b.INVISIBLE_SPACE,k=i.getStyle("display").from(c),l="block"===k||"list-item"===k;if(j&&f&&g&&!d)try{c.innerHTML=b.INVISIBLE_SPACE}catch(a){}g?e.selectNodeContents(c):e.selectNode(c),g&&j&&f?e.collapse(l):g&&j&&(e.setStartAfter(c),e.setEndAfter(c)),this.setSelection(e)},getSelectedNode:function(a){var b,c;return a&&this.doc.selection&&"Control"===this.doc.selection.type&&(c=this.doc.selection.createRange(),c&&c.length)?c.item(0):(b=this.getSelection(this.doc),b.focusNode===b.anchorNode?b.focusNode:(c=this.getRange(this.doc),c?c.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var a=this.getRange();h(a),this.setSelection(a)},getSelectedOwnNodes:function(a){var b,c,d=this.getOwnRanges(),e=[];for(b=0,c=d.length;b<c;b++)e.push(d[b].commonAncestorContainer||this.doc.body);return e},findNodesInSelection:function(a){var c,d,e,f=this.getOwnRanges(),g=[];for(d=0,e=f.length;d<e;d++)c=f[d].getNodes([1],function(c){return b.lang.array(a).contains(c.nodeName)}),g=g.concat(c);return g},filterElements:function(a){var b,c,d,e=this.getOwnRanges(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c].getNodes([1],function(b){return a(b,e[c])}),f=f.concat(b);return f},containsUneditable:function(){var a,b,c=this.getOwnUneditables(),d=this.getSelection();for(a=0,b=c.length;a<b;a++)if(d.containsNode(c[a]))return!0;return!1},deleteContents:function(){var a=this.getRange();this.deleteRangeContents(a),this.setSelection(a)},deleteRangeContents:function(a){var c,d,e,f,g;if(this.unselectableClass)for((c=b.dom.getParentElement(a.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&a.setStartBefore(c),(d=b.dom.getParentElement(a.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&a.setEndAfter(d),e=a.getNodes([1],function(a){return b.dom.hasClass(a,this.unselectableClass)}.bind(this)),g=e.length;g--;)try{f=new CustomEvent("wysihtml5:uneditable:delete"),e[g].dispatchEvent(f)}catch(a){}a.deleteContents()},getCaretNode:function(){var a=this.getSelection();return a&&a.anchorNode?f(a.anchorNode,a.anchorOffset):null},getPreviousNode:function(a,c){var d,e,g,h;return a||(e=this.getSelection(),a=e&&e.anchorNode?f(e.anchorNode,e.anchorOffset):null),a!==this.contain&&(g=a.previousSibling,g!==this.contain&&(g&&3!==g.nodeType&&1!==g.nodeType?g=this.getPreviousNode(g,c):g&&3===g.nodeType&&/^\s*$/.test(g.textContent)?g=this.getPreviousNode(g,c):c&&g&&1===g.nodeType?(d=b.dom.getStyle("display").from(g),b.lang.array(["BR","HR","IMG"]).contains(g.nodeName)||b.lang.array(["block","inline-block","flex","list-item","table"]).contains(d)||!/^[\s]*$/.test(g.innerHTML)||(g=this.getPreviousNode(g,c))):g||a===this.contain||(h=a.parentNode,h!==this.contain&&(g=this.getPreviousNode(h,c))),g!==this.contain&&g))},getNodesNearCaret:function(){if(!this.isCollapsed())throw"Selection must be caret when using selection.getNodesNearCaret()";var a,b,c,d,e=this.getOwnRanges();return e&&e.length>0?(1===e[0].startContainer.nodeType?(a=e[0].startContainer.childNodes[e[0].startOffset-1],a||0!==e[0].startOffset?a&&(b=a.previousSibling,c=a.nextSibling):c=e[0].startContainer.childNodes[0]):(0===e[0].startOffset&&e[0].startContainer.previousSibling?(a=e[0].startContainer.previousSibling,3===a.nodeType&&(d=a.data.length)):(a=e[0].startContainer,d=e[0].startOffset),b=a.previousSibling,c=a.nextSibling),{caretNode:a,prevNode:b,nextNode:c,textOffset:d}):null},getSelectionParentsByTag:function(a){var c,d,e,f=this.getSelectedOwnNodes(),g=[];for(d=0,e=f.length;d<e;d++)c=f[d].nodeName&&"LI"===f[d].nodeName?f[d]:b.dom.getParentElement(f[d],{query:"li"},!1,this.contain),c&&g.push(c);return g.length?g:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var b=this.getRange(),c=b.startContainer,d=b.startOffset,e=a.createRange(this.doc);return e.selectNodeContents(c),e.setStart(c,d),e}},caretIsLastInSelection:function(){a.createRange(this.doc),this.getSelection();return/^\s*$/.test(this.getRangeToNodeEnd().cloneContents().textContent)},caretIsFirstInSelection:function(c){var d,e=a.createRange(this.doc),g=this.getSelection(),h=this.getRange(),i=f(h.startContainer,h.startOffset);if(i)return i.nodeType===b.TEXT_NODE?!!i.parentNode&&(!(!this.isCollapsed()||i.parentNode.firstChild!==i&&!b.dom.domNode(i.previousSibling).is.block())&&(d=this.win.getComputedStyle(i.parentNode).whiteSpace,"pre"===d||"pre-wrap"===d?0===h.startOffset:/^\s*$/.test(i.data.substr(0,h.startOffset)))):!(!c||!b.dom.domNode(i).is.lineBreak())||(e.selectNodeContents(this.getRange().commonAncestorContainer),e.collapse(!0),this.isCollapsed()&&(e.startContainer===g.anchorNode||e.endContainer===g.anchorNode)&&e.startOffset===g.anchorOffset)},caretIsInTheBeginnig:function(a){var c=this.getSelection(),d=c.anchorNode,e=c.anchorOffset;return a&&d?0===e&&(d.nodeName&&d.nodeName===a.toUpperCase()||b.dom.getParentElement(d.parentNode,{query:a},1)):d?0===e&&!this.getPreviousNode(d,!0):void 0},getBeforeSelection:function(a){var c,d,e,f,g=this.getSelection(),h=g.isBackwards()?g.focusNode:g.anchorNode,i=g.isBackwards()?g.focusOffset:g.anchorOffset,j=this.createRange();return h&&3===h.nodeType&&/^\s*$/.test(h.data.slice(0,i))&&(i=0),d=b.dom.getParentElement(h,{query:"._wysihtml5-temp-caret-fix"},1),d&&(h=d.parentNode,i=Array.prototype.indexOf.call(h.childNodes,d)),h?i>0?3===h.nodeType?(j.setStart(h,0),j.setEnd(h,i),{type:"text",range:j,offset:i,node:h}):(j.setStartBefore(h.childNodes[0]),c=h.childNodes[i-1],j.setEndAfter(c),{type:"element",range:j,offset:i,node:c}):(j.setStartAndEnd(h,0),a&&(e=this.getPreviousNode(h,!0),f=null,e&&(f=1===e.nodeType&&b.dom.hasClass(e,this.unselectableClass)?e:b.dom.domNode(e).lastLeafNode()),f)?{type:"leafnode",range:j,offset:i,node:f}:{type:"none",range:j,offset:i,node:h}):null},executeAndRestoreRangy:function(b,c){var d=a.saveSelection(this.win);if(d)try{b()}catch(a){setTimeout(function(){throw a},0)}else b();a.restoreSelection(d)},executeAndRestore:function(c,d){var e,f,g,h,j,k,l,m,n,o=this.doc.body,p=d&&o.scrollTop,q=d&&o.scrollLeft,r="_wysihtml5-temp-placeholder",s='<span class="'+r+'">'+b.INVISIBLE_SPACE+"</span>",t=this.getRange(!0);if(!t)return c(o,o),void 0;t.collapsed||(l=t.cloneRange(),k=l.createContextualFragment(s),l.collapse(!1),l.insertNode(k),l.detach()),j=t.createContextualFragment(s),t.insertNode(j),k&&(e=this.contain.querySelectorAll("."+r),t.setStartBefore(e[0]),t.setEndAfter(e[e.length-1])),this.setSelection(t);try{c(t.startContainer,t.endContainer)}catch(a){setTimeout(function(){throw a},0)}if(e=this.contain.querySelectorAll("."+r),e&&e.length)for(m=a.createRange(this.doc),g=e[0].nextSibling,e.length>1&&(h=e[e.length-1].previousSibling),h&&g?(m.setStartBefore(g),m.setEndAfter(h)):(f=this.doc.createTextNode(b.INVISIBLE_SPACE),i.insert(f).after(e[0]),m.setStartBefore(f),m.setEndAfter(f)),this.setSelection(m),n=e.length;n--;)e[n].parentNode.removeChild(e[n]);else this.contain.focus();d&&(o.scrollTop=p,o.scrollLeft=q);try{e.parentNode.removeChild(e)}catch(a){}},set:function(b,c){var d=a.createRange(this.doc);d.setStart(b,c||0),this.setSelection(d)},insertHTML:function(a){var b,c,d=this.getRange(),e=this.doc.createElement("DIV"),f=this.doc.createDocumentFragment();if(d){for(d.deleteContents(),e.innerHTML=a,b=e.lastChild;e.firstChild;)f.appendChild(e.firstChild);for(d.insertNode(f),c=this.contain.lastChild;c&&3===c.nodeType&&c.previousSibling&&/^\s*$/.test(c.data);)c=c.previousSibling;b&&(c&&b===c&&1===b.nodeType&&this.contain.appendChild(this.doc.createElement("br")),this.setAfter(b))}},insertNode:function(a){var b=this.getRange();b&&b.insertNode(a)},canAppendChild:function(a){var b,c,d=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],e=this.getRange();return b=a||e.startContainer,b&&(c=(b.tagName||b.nodeName).toLowerCase()),-1===d.indexOf(c)},splitElementAtCaret:function(a,c){var d,e,f,g,h,i,j=this.getSelection();if(j.rangeCount>0){for(d=j.getRangeAt(0).cloneRange(),d.setEndAfter(a),e=d.extractContents(),h=e.childNodes,i=h.length;i--;)b.dom.domNode(h[i]).is.visible()||e.removeChild(h[i]);a.parentNode.insertBefore(e,a.nextSibling),c?(f=c.firstChild||c,g=c.lastChild||c,a.parentNode.insertBefore(c,a.nextSibling),f&&g&&(d.setStartBefore(f),d.setEndAfter(g),this.setSelection(d))):(d.setStartAfter(a),d.setEndAfter(a)),b.dom.domNode(a).is.visible()||(""===b.dom.getTextContent(a)?a.parentNode.removeChild(a):a.parentNode.replaceChild(this.doc.createTextNode(" "),a))}},surround:function(a){var b,c,d=this.getOwnRanges(),e=[];if(0==d.length)return e;for(c=d.length;c--;){b=this.doc.createElement(a.nodeName),e.push(b),a.className&&(b.className=a.className),a.cssStyle&&b.setAttribute("style",a.cssStyle);try{d[c].surroundContents(b),this.selectNode(b)}catch(a){b.appendChild(d[c].extractContents()),d[c].insertNode(b)}}return e},scrollIntoView:function(){var a,d=this.doc,e=5,f=d.documentElement.scrollHeight>d.documentElement.offsetHeight,g=d._wysihtml5ScrollIntoViewElement=d._wysihtml5ScrollIntoViewElement||function(){var a=d.createElement("span");return a.innerHTML=b.INVISIBLE_SPACE,a}();f&&(this.insertNode(g),a=c(g),g.parentNode.removeChild(g),a>=d.body.scrollTop+d.documentElement.offsetHeight-e&&(d.body.scrollTop=a))},selectLine:function(){var c=a.createRange();b.browser.supportsSelectionModify()?this._selectLine_W3C():c.nativeRange&&c.nativeRange.getBoundingClientRect&&this._selectLineUniversal()},includeRangyRangeHelpers:function(){var a=this.getSelection(),b=a.getRangeAt(0),c=function(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")},d=function(a){return 1===a.nodeType?a.childNodes&&a.childNodes.length||0:a.data&&a.data.length||0},e=1===a.anchorNode.nodeType?a.anchorNode.childNodes[a.anchorOffset]:a.anchorNode,f=1===a.focusNode.nodeType?a.focusNode.childNodes[a.focusOffset]:a.focusNode;f&&a.focusOffset===d(f)&&f.nextSibling&&c(f.nextSibling)&&b.setEndAfter(f.nextSibling),e&&0===a.anchorOffset&&e.previousSibling&&c(e.previousSibling)&&b.setStartBefore(e.previousSibling),b.select()},_selectLine_W3C:function(){var a=this.win.getSelection(),b=[a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset];a.modify("move","left","lineboundary"),a.modify("extend","right","lineboundary"),a.anchorNode===b[0]&&a.anchorOffset===b[1]&&a.focusNode===b[2]&&a.focusOffset===b[3]?this._selectLineUniversal():this.includeRangyRangeHelpers()},toLineBoundary:function(a,c){if(c=void 0!==c&&c,b.browser.supportsSelectionModify()){var d=this.win.getSelection();d.modify("extend",a,"lineboundary"),c&&("left"===a?d.collapseToStart():"right"===a&&d.collapseToEnd())}},getRangeRect:function(a){var b,c=(this.doc.createTextNode("i"),this.doc.createTextNode("i"));return a.collapsed?(a.insertNode(c),a.selectNode(c),b=a.nativeRange.getBoundingClientRect(),a.deleteContents()):b=a.nativeRange.getBoundingClientRect(),b},_selectLineUniversal:function(){var a,c,d,e,f=this.getSelection(),g=f.getRangeAt(0),h=0,i=this,j=function(a){return a&&1===a.nodeType&&("block"===i.win.getComputedStyle(a).display||b.lang.array(["BR","HR"]).contains(a.nodeName))},k=function(a){var b=a;if(b)for(;b&&(1===b.nodeType&&b.classList.contains("rangySelectionBoundary")||3===b.nodeType&&/^\s*$/.test(b.data));)b=b.previousSibling;return b};g.cloneRange(),g.cloneRange(),g.collapsed&&(3===g.startContainer.nodeType&&g.startOffset<g.startContainer.data.length?g.moveEnd("character",1):1===g.startContainer.nodeType&&g.startContainer.childNodes[g.startOffset]&&3===g.startContainer.childNodes[g.startOffset].nodeType&&g.startContainer.childNodes[g.startOffset].data.length>0?g.moveEnd("character",1):g.startOffset>0&&(3===g.startContainer.nodeType||1===g.startContainer.nodeType&&!j(k(g.startContainer.childNodes[g.startOffset-1])))&&g.moveStart("character",-1)),g.collapsed||g.insertNode(this.doc.createTextNode(b.INVISIBLE_SPACE)),a=g.nativeRange.getBoundingClientRect();do{c=g.moveStart("character",-1),d=g.nativeRange.getBoundingClientRect(),d&&Math.floor(d.top)===Math.floor(a.top)||(g.moveStart("character",1),e=!0),h++}while(0!==c&&!e&&h<2e3);if(h=0,e=!1,a=g.nativeRange.getBoundingClientRect(),g.endContainer!==this.contain||this.contain.lastChild&&this.contain.childNodes[g.endOffset]!==this.contain.lastChild)do{c=g.moveEnd("character",1),d=g.nativeRange.getBoundingClientRect(),d&&Math.floor(d.bottom)===Math.floor(a.bottom)||(g.moveEnd("character",-1),g.endContainer&&1===g.endContainer.nodeType&&g.endContainer.childNodes[g.endOffset]&&1===g.endContainer.childNodes[g.endOffset].nodeType&&"BR"===g.endContainer.childNodes[g.endOffset].nodeName&&g.endContainer.childNodes[g.endOffset].previousSibling&&(1===g.endContainer.childNodes[g.endOffset].previousSibling.nodeType?g.setEnd(g.endContainer.childNodes[g.endOffset].previousSibling,g.endContainer.childNodes[g.endOffset].previousSibling.childNodes.length):3===g.endContainer.childNodes[g.endOffset].previousSibling.nodeType&&g.setEnd(g.endContainer.childNodes[g.endOffset].previousSibling,g.endContainer.childNodes[g.endOffset].previousSibling.data.length)),e=!0),h++}while(0!==c&&!e&&h<2e3);g.select(),this.includeRangyRangeHelpers()},getText:function(){var a=this.getSelection();return a?""+a:""},getNodes:function(a,b){var c=this.getRange();return c?c.getNodes(Array.isArray(a)?a:[a],b):[]},getOwnNodes:function(a,b,c){var d,e,f=this.getOwnRanges(),g=[];for(d=0,e=f.length;d<e;d++)f[d]&&(c&&f[d].splitBoundaries(),g=g.concat(f[d].getNodes(Array.isArray(a)?a:[a],b)));return g},fixRangeOverflow:function(a){var b,c;this.contain&&this.contain.firstChild&&a&&(b=a.compareNode(this.contain),2!==b?(1===b&&a.setStartBefore(this.contain.firstChild),0===b&&a.setEndAfter(this.contain.lastChild),3===b&&(a.setStartBefore(this.contain.firstChild),a.setEndAfter(this.contain.lastChild))):this._detectInlineRangeProblems(a)&&(c=a.endContainer.previousElementSibling,c&&a.setEnd(c,this._endOffsetForNode(c))))},_endOffsetForNode:function(a){var b=document.createRange();return b.selectNodeContents(a),b.endOffset},_detectInlineRangeProblems:function(a){var b=i.compareDocumentPosition(a.startContainer,a.endContainer);return 0==a.endOffset&&4&b},getRange:function(a){var b=this.getSelection(),c=b&&b.rangeCount&&b.getRangeAt(0);return!0!==a&&this.fixRangeOverflow(c),c},getOwnUneditables:function(){var a=i.query(this.contain,"."+this.unselectableClass),c=i.query(a,"."+this.unselectableClass);return b.lang.array(a).without(c)},getOwnRanges:function(){var a,b,c,d,e,f,g,h=[],i=this.getRange();if(i&&h.push(i),this.unselectableClass&&this.contain&&i&&(b=this.getOwnUneditables(),b.length>0))for(d=0,e=b.length;d<e;d++)for(a=[],f=0,g=h.length;f<g;f++){if(h[f])switch(h[f].compareNode(b[d])){case 2:break;case 3:c=h[f].cloneRange(),c.setEndBefore(b[d]),a.push(c),c=h[f].cloneRange(),c.setStartAfter(b[d]),a.push(c);break;default:a.push(h[f])}h=a}return h},getSelection:function(){return a.getSelection(this.win)},setSelection:function(b){var c=a.getSelection(this.win);return c.setSingleRange(b),c&&c.anchorNode&&c.focusNode?c:null},selectAll:function(){var a,c=this.createRange(),d=this.composer,e=this,f=g(this.composer.element),h=g(this.composer.element),i=function(){c.setStart(d.element,0),c.setEnd(d.element,d.element.childNodes.length),a=e.setSelection(c)},j=function(){return!a||a.nativeSelection&&a.nativeSelection.type&&("Caret"===a.nativeSelection.type||"None"===a.nativeSelection.type)};b.dom.removeInvisibleSpaces(this.composer.element),i(),this.composer.element.firstChild&&j()&&(this.composer.element.appendChild(f),i(),j()&&(f.parentNode.removeChild(f),this.composer.element.insertBefore(h,this.composer.element.firstChild),i(),j()&&(this.composer.element.appendChild(f),i())))},createRange:function(){return a.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return""+this.getSelection()},isEndToEndInNode:function(a){var c=this.getRange(),d=c.commonAncestorContainer,e=c.startContainer,f=c.endContainer;if(d.nodeType===b.TEXT_NODE&&(d=d.parentNode),e.nodeType===b.TEXT_NODE&&!/^\s*$/.test(e.data.substr(c.startOffset)))return!1;if(f.nodeType===b.TEXT_NODE&&!/^\s*$/.test(f.data.substr(c.endOffset)))return!1;for(;e&&e!==d;){if(e.nodeType!==b.TEXT_NODE&&!b.dom.contains(d,e))return!1;if(b.dom.domNode(e).prev({ignoreBlankTexts:!0}))return!1;e=e.parentNode}for(;f&&f!==d;){if(f.nodeType!==b.TEXT_NODE&&!b.dom.contains(d,f))return!1;if(b.dom.domNode(f).next({ignoreBlankTexts:!0}))return!1;f=f.parentNode}return!!b.lang.array(a).contains(d.nodeName)&&d},isInThisEditable:function(){var a=this.getSelection(),c=a.focusNode,d=a.anchorNode;return c&&1!==c.nodeType&&(c=c.parentNode),d&&1!==d.nodeType&&(d=d.parentNode),d&&c&&(b.dom.contains(this.composer.element,c)||this.composer.element===c)&&(b.dom.contains(this.composer.element,d)||this.composer.element===d)},deselect:function(){var a=this.getSelection();a&&a.removeAllRanges()}})}(b),function(a,b){function c(a,b,c){if(!a.className)return!1;var d=a.className.match(c)||[];return d[d.length-1]===b}function d(a,b){if(!a.getAttribute||!a.getAttribute("style"))return!1;a.getAttribute("style").match(b);return!!a.getAttribute("style").match(b)}function e(a,b,c){a.getAttribute("style")?(h(a,c),a.getAttribute("style")&&!/^\s*$/.test(a.getAttribute("style"))?a.setAttribute("style",b+";"+a.getAttribute("style")):a.setAttribute("style",b)):a.setAttribute("style",b)}function f(a,b,c){a.className?(g(a,c),a.className+=" "+b):a.className=b}function g(a,b){a.className&&(a.className=a.className.replace(b,""))}function h(a,b){var c,d,e=[];if(a.getAttribute("style")){for(c=a.getAttribute("style").split(";"),d=c.length;d--;)c[d].match(b)||/^\s*$/.test(c[d])||e.push(c[d]);e.length?a.setAttribute("style",e.join(";")):a.removeAttribute("style")}}function i(a,b){var c,d,e,f=[],g=b.split(";"),h=a.getAttribute("style");if(h){for(h=h.replace(/\s/gi,"").toLowerCase(),f.push(RegExp("(^|\\s|;)"+b.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi")),c=g.length;c-- >0;)/^\s*$/.test(g[c])||f.push(RegExp("(^|\\s|;)"+g[c].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(d=0,e=f.length;d<e;d++)if(h.match(f[d]))return f[d]}return!1}function j(c,d,e,f){return e?i(c,e):f?a.dom.hasClass(c,f):b.dom.arrayContains(d,c.tagName.toLowerCase())}function k(a,b,c,d){for(var e=a.length;e--;)if(!j(a[e],b,c,d))return!1;return!!a.length}function l(a,b,c){var d=i(a,b);return d?(h(a,d),"remove"):(e(a,b,c),"change")}function m(a,b){return a.className.replace(u," ")==b.className.replace(u," ")}function n(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);b.removeChild(a)}function o(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var c,d,e,f=0,g=a.attributes.length;f<g;++f)if(c=a.attributes[f],e=c.name,"class"!=e){if(d=b.attributes.getNamedItem(e),c.specified!=d.specified)return!1;if(c.specified&&c.nodeValue!==d.nodeValue)return!1}return!0}function p(a,c){return b.dom.isCharacterDataNode(a)?0==c?!!a.previousSibling:c!=a.length||!!a.nextSibling:c>0&&c<a.childNodes.length}function q(a,c,d,e){var f,g;if(b.dom.isCharacterDataNode(c)&&(0==d?(d=b.dom.getNodeIndex(c),c=c.parentNode):d==c.length?(d=b.dom.getNodeIndex(c)+1,c=c.parentNode):f=b.dom.splitDataNode(c,d)),!(f||e&&c===e)){for(f=c.cloneNode(!1),f.id&&f.removeAttribute("id");g=c.childNodes[d];)f.appendChild(g);b.dom.insertAfter(f,c)}return c==a?f:q(a,f.parentNode,b.dom.getNodeIndex(f),e)}function r(b){this.isElementMerge=b.nodeType==a.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?b.lastChild:b,this.textNodes=[this.firstTextNode]}function s(a,b,c,d,e,f,g){this.tagNames=a||[t],this.cssClass=b||!1!==b&&"",this.similarClassRegExp=c,this.cssStyle=e||"",this.similarStyleRegExp=f,this.normalize=d,this.applyToAnyTagName=!1,this.container=g}var t="span",u=/\s+/g;r.prototype={doMerge:function(){var a,b,c,d,e,f=[];for(d=0,e=this.textNodes.length;d<e;++d)a=this.textNodes[d],b=a.parentNode,f[d]=a.data,d&&(b.removeChild(a),b.hasChildNodes()||b.parentNode.removeChild(b));return this.firstTextNode.data=c=f.join(""),c},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){var a,b,c=[];for(a=0,b=this.textNodes.length;a<b;++a)c[a]="'"+this.textNodes[a].data+"'";return"[Merge("+c.join(",")+")]"}},s.prototype={getAncestorWithClass:function(d){for(var e;d;){if(e=this.cssClass?c(d,this.cssClass,this.similarClassRegExp):""===this.cssStyle,d.nodeType==a.ELEMENT_NODE&&"false"!=d.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,d.tagName.toLowerCase())&&e)return d;d=d.parentNode}return!1},getAncestorWithStyle:function(c){for(var e;c;){if(e=!!this.cssStyle&&d(c,this.similarStyleRegExp),c.nodeType==a.ELEMENT_NODE&&"false"!=c.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&e)return c;c=c.parentNode}return!1},getMatchingAncestor:function(a){var b=this.getAncestorWithClass(a),c=!1;return b?this.cssStyle&&(c="class"):(b=this.getAncestorWithStyle(a),b&&(c="style")),{element:b,type:c}},postApply:function(a,b){var c,d,e,f,g,h,i=a[0],j=a[a.length-1],k=[],l=i,m=j,n=0,o=j.length;for(f=0,g=a.length;f<g;++f)d=a[f],e=null,d&&d.parentNode&&(e=this.getAdjacentMergeableTextNode(d.parentNode,!1)),e?(c||(c=new r(e),k.push(c)),c.textNodes.push(d),d===i&&(l=c.firstTextNode,n=l.length),d===j&&(m=c.firstTextNode,o=c.getLength())):c=null;if(j&&j.parentNode&&(h=this.getAdjacentMergeableTextNode(j.parentNode,!0),h&&(c||(c=new r(j),k.push(c)),c.textNodes.push(h))),k.length){for(f=0,g=k.length;f<g;++f)k[f].doMerge();b.setStart(l,n),b.setEnd(m,o)}},getAdjacentMergeableTextNode:function(b,c){var d,e=b.nodeType==a.TEXT_NODE,f=e?b.parentNode:b,g=c?"nextSibling":"previousSibling";if(e){if(d=b[g],d&&d.nodeType==a.TEXT_NODE)return d}else if(d=f[g],d&&this.areElementsMergeable(b,d))return d[c?"firstChild":"lastChild"];return null},areElementsMergeable:function(a,c){return b.dom.arrayContains(this.tagNames,(a.tagName||"").toLowerCase())&&b.dom.arrayContains(this.tagNames,(c.tagName||"").toLowerCase())&&m(a,c)&&o(a,c)},createContainer:function(a){var b=a.createElement(this.tagNames[0]);return this.cssClass&&(b.className=this.cssClass),this.cssStyle&&b.setAttribute("style",this.cssStyle),b},applyToTextNode:function(a){var c,d=a.parentNode;1==d.childNodes.length&&b.dom.arrayContains(this.tagNames,d.tagName.toLowerCase())?(this.cssClass&&f(d,this.cssClass,this.similarClassRegExp),this.cssStyle&&e(d,this.cssStyle,this.similarStyleRegExp)):(c=this.createContainer(b.dom.getDocument(a)),a.parentNode.insertBefore(c,a),c.appendChild(a))},isRemovable:function(c){return b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&""===a.lang.string(c.className).trim()&&(!c.getAttribute("style")||""===a.lang.string(c.getAttribute("style")).trim())},undoToTextNode:function(a,b,c,d){var e,f=!c,h=c||d,i=!1;b.containsNode(h)||(e=b.cloneRange(),e.selectNode(h),e.isPointInRange(b.endContainer,b.endOffset)&&p(b.endContainer,b.endOffset)&&(q(h,b.endContainer,b.endOffset,this.container),b.setEndAfter(h)),e.isPointInRange(b.startContainer,b.startOffset)&&p(b.startContainer,b.startOffset)&&(h=q(h,b.startContainer,b.startOffset,this.container))),!f&&this.similarClassRegExp&&g(h,this.similarClassRegExp),f&&this.similarStyleRegExp&&(i="change"===l(h,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(h)&&!i&&n(h)},applyToRange:function(b){var c,d,e,f,g,h;for(d=b.length;d--;){if(c=b[d].getNodes([a.TEXT_NODE]),!c.length)try{return e=this.createContainer(b[d].endContainer.ownerDocument),b[d].surroundContents(e),this.selectNode(b[d],e),void 0}catch(a){}if(b[d].splitBoundaries(),c=b[d].getNodes([a.TEXT_NODE]),c.length){for(g=0,h=c.length;g<h;++g)f=c[g],this.getMatchingAncestor(f).element||this.applyToTextNode(f);b[d].setStart(c[0],0),f=c[c.length-1],b[d].setEnd(f,f.length),this.normalize&&this.postApply(c,b[d])}}},undoToRange:function(b){var c,d,e,f,g,h,i,j;for(f=b.length;f--;){for(c=b[f].getNodes([a.TEXT_NODE]),c.length?(b[f].splitBoundaries(),c=b[f].getNodes([a.TEXT_NODE])):(g=b[f].endContainer.ownerDocument,h=g.createTextNode(a.INVISIBLE_SPACE),b[f].insertNode(h),b[f].selectNode(h),c=[h]),i=0,j=c.length;i<j;++i)b[f].isValid()&&(d=c[i],e=this.getMatchingAncestor(d),"style"===e.type?this.undoToTextNode(d,b[f],!1,e.element):e.element&&this.undoToTextNode(d,b[f],e.element));1==j?this.selectNode(b[f],c[0]):(b[f].setStart(c[0],0),d=c[c.length-1],b[f].setEnd(d,d.length),this.normalize&&this.postApply(c,b[f]))}},selectNode:function(b,c){var d=c.nodeType===a.ELEMENT_NODE,e=!("canHaveHTML"in c)||c.canHaveHTML,f=d?c.innerHTML:c.data,g=""===f||f===a.INVISIBLE_SPACE;if(g&&d&&e)try{c.innerHTML=a.INVISIBLE_SPACE}catch(a){}b.selectNodeContents(c),g&&d?b.collapse(!1):g&&(b.setStartAfter(c),b.setEndAfter(c))},getTextSelectedByRange:function(a,b){var c,d,e=b.cloneRange();return e.selectNodeContents(a),c=e.intersection(b),d=c?""+c:"",e.detach(),d},isAppliedToRange:function(b){var c,d,e,f,g,h,i=[],j="full";for(e=b.length;e--;){if(d=b[e].getNodes([a.TEXT_NODE]),!d.length)return c=this.getMatchingAncestor(b[e].startContainer).element,!!c&&{elements:[c],coverage:j};for(f=0,g=d.length;f<g;++f)h=this.getTextSelectedByRange(d[f],b[e]),c=this.getMatchingAncestor(d[f]).element,c&&""!=h?(i.push(c),1===a.dom.getTextNodes(c,!0).length?j="full":"full"===j&&(j="inline")):c||(j="partial")}return!!i.length&&{elements:i,coverage:j}},toggleRange:function(a){var b,c=this.isAppliedToRange(a);c?"full"===c.coverage?this.undoToRange(a):"inline"===c.coverage?(b=k(c.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(a),b||this.applyToRange(a)):(k(c.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(a),this.applyToRange(a)):this.applyToRange(a)}},a.selection.HTMLApplier=s}(b,a),b.Commands=d.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.doc=this.composer.doc},support:function(a){return b.browser.supportsCommand(this.doc,a)},exec:function(a,c){var d=b.commands[a],e=b.lang.array(arguments).get(),f=d&&d.exec,g=null;if(this.composer.hasPlaceholderSet()&&!b.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(a)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer"),f)e.unshift(this.composer),g=f.apply(d,e);else try{g=this.doc.execCommand(a,!1,c)}catch(a){}return this.editor.fire("aftercommand:composer"),g},remove:function(a,c){var d=b.commands[a],e=b.lang.array(arguments).get(),f=d&&d.remove;if(f)return e.unshift(this.composer),f.apply(d,e)},state:function(a,c){var d=b.commands[a],e=b.lang.array(arguments).get(),f=d&&d.state;if(f)return e.unshift(this.composer),f.apply(d,e);try{return this.doc.queryCommandState(a)}catch(a){return!1}},stateValue:function(a){var c=b.commands[a],d=b.lang.array(arguments).get(),e=c&&c.stateValue;return!!e&&(d.unshift(this.composer),e.apply(c,d))}}),function(a){var b={nodeName:"B",toggle:!0};a.commands.bold={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(b),function(a){function b(b){return a.lang.object({}).merge(c).merge({attribute:b}).get()}var c={nodeName:"A",toggle:!1};a.commands.createLink={exec:function(c,d,e){var f,g=b(e);c.selection.isCollapsed()&&!this.state(c,d)&&(f=c.doc.createTextNode(g.attribute.href),c.selection.insertNode(f),c.selection.selectNode(f)),a.commands.formatInline.exec(c,d,g)},state:function(b,d){return a.commands.formatInline.state(b,d,c)}}}(b),function(a){var b={nodeName:"A"};a.commands.removeLink={exec:function(c,d){a.commands.formatInline.remove(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(b),function(a){var b=/wysiwyg-font-size-[0-9a-z\-]+/g;a.commands.fontSize={exec:function(c,d,e){a.commands.formatInline.exec(c,d,{className:"wysiwyg-font-size-"+e,classRegExp:b,toggle:!0})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{className:"wysiwyg-font-size-"+d})}}}(b),function(a){a.commands.fontSizeStyle={exec:function(b,c,d){d=d.size||d,/^\s*$/.test(d)||a.commands.formatInline.exec(b,c,{styleProperty:"fontSize",styleValue:d,toggle:!1})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{styleProperty:"fontSize",styleValue:d||void 0})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"fontSize"})},stateValue:function(b,c){var d,e=this.state(b,c);return e&&a.lang.object(e).isArray()&&(e=e[0]),!(!e||(d=e.getAttribute("style"),!d))&&a.quirks.styleParser.parseFontSize(d)}}}(b),function(a){var b=/wysiwyg-color-[0-9a-z]+/g;a.commands.foreColor={exec:function(c,d,e){a.commands.formatInline.exec(c,d,{className:"wysiwyg-color-"+e,classRegExp:b,toggle:!0})},state:function(b,c,d){return a.commands.formatInline.state(b,c,{className:"wysiwyg-color-"+d})}}}(b),function(a){a.commands.foreColorStyle={exec:function(b,c,d){var e,f;d&&(e=a.quirks.styleParser.parseColor("color:"+(d.color||d),"color"),e&&(f=(1===e[3]?"rgb("+[e[0],e[1],e[2]].join(", "):"rgba("+e.join(", "))+")",a.commands.formatInline.exec(b,c,{styleProperty:"color",styleValue:f})))},state:function(b,c,d){var e,f=d?a.quirks.styleParser.parseColor("color:"+(d.color||d),"color"):null;return f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")"),a.commands.formatInline.state(b,c,{styleProperty:"color",styleValue:e})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"color"})},stateValue:function(b,c,d){var e,f=this.state(b,c),g=!1;return f&&a.lang.object(f).isArray()&&(f=f[0]),!(!f||(e=f.getAttribute("style"),!e))&&(g=a.quirks.styleParser.parseColor(e,"color"),a.quirks.styleParser.unparseColor(g,d))}}}(b),function(a){a.commands.bgColorStyle={exec:function(b,c,d){var e,f=a.quirks.styleParser.parseColor("background-color:"+(d.color||d),"background-color");f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")",a.commands.formatInline.exec(b,c,{styleProperty:"backgroundColor",styleValue:e}))},state:function(b,c,d){var e,f=d?a.quirks.styleParser.parseColor("background-color:"+(d.color||d),"background-color"):null;return f&&(e=(1===f[3]?"rgb("+[f[0],f[1],f[2]].join(", "):"rgba("+f.join(", "))+")"),a.commands.formatInline.state(b,c,{styleProperty:"backgroundColor",styleValue:e})},remove:function(b,c){return a.commands.formatInline.remove(b,c,{styleProperty:"backgroundColor"})},stateValue:function(b,c,d){var e,f=this.state(b,c),g=!1;return f&&a.lang.object(f).isArray()&&(f=f[0]),!(!f||(e=f.getAttribute("style"),!e))&&(g=a.quirks.styleParser.parseColor(e,"background-color"),a.quirks.styleParser.unparseColor(g,d))}}}(b),function(b){function c(a){return{nodeName:a.nodeName||null,className:a.classRegExp?null:a.className||null,classRegExp:a.classRegExp||null,styleProperty:a.styleProperty||null}}function d(a,b){return 3===a.nodeType?a:a.childNodes[b]||a}function e(a){return a&&1===a.nodeType&&"BR"===a.nodeName}function f(a,b){return a&&1===a.nodeType&&"block"===b.win.getComputedStyle(a).display}function g(a){return a&&1===a.nodeType&&a.classList.contains("rangySelectionBoundary")}function h(a,b){return e(a)||f(a,b)}function i(a,c){var d,e,f,g,h,i,j;for(b.dom.removeInvisibleSpaces(a.element),d=a.element,e=d.querySelectorAll(F),f=a.config.classNames.uneditableContainer+[""].concat(F.split(",")).join(", "+a.config.classNames.uneditableContainer+" "),g=d.querySelectorAll(f),h=b.lang.array(e).without(g),j=h.length;j--;)""!==h[j].innerHTML.replace(/[\uFEFF]/g,"")||0!==c.length&&h[j]===c[c.length-1]||(i=b.lang.array(c).indexOf(h[j]),i>-1&&c.splice(i,1),h[j].parentNode.removeChild(h[j]));return c}function j(a){return a.config.useLineBreaks?"DIV":"P"}function k(a,b,c){for(var d=a,e=null;d&&b&&d!==b;)1===d.nodeType&&d.matches(c?F:E)&&(e=d),d=d.parentNode;return e}function l(a,b){for(var c,d,e,f=a,g=null;f&&b&&f!==b;)1===f.nodeType&&f.matches(G)&&(d=f,null===g?(g=f.cloneNode(!1),c=g):(e=f.cloneNode(!1),e.appendChild(g),g=e)),f=f.parentNode;return{parent:d,outerNode:g,innerNode:c}}function m(a,c,d){return a||(a=d.doc.createElement(c.nodeName||j(d)),a.appendChild(d.doc.createTextNode(b.INVISIBLE_SPACE))),c.nodeName&&a.nodeName!==c.nodeName&&(a=D.renameElement(a,c.nodeName)),c.classRegExp&&(a.className=a.className.replace(c.classRegExp,"")),c.className&&a.classList.add(c.className),c.styleProperty&&void 0!==c.styleValue&&(a.style[b.browser.fixStyleKey(c.styleProperty)]=c.styleValue),a}function n(a,c,d){var e,f=a.previousSibling,g=a.nextSibling,h=!1;c.styleProperty&&(a.style[b.browser.fixStyleKey(c.styleProperty)]=""),c.className&&a.classList.remove(c.className),c.classRegExp&&(a.className=a.className.replace(c.classRegExp,"")),null!==a.getAttribute("class")&&""===a.getAttribute("class").trim()&&a.removeAttribute("class"),c.nodeName&&a.nodeName.toLowerCase()===c.nodeName.toLowerCase()&&(e=a.getAttribute("style"),e&&""!==e.trim()?a=D.renameElement(a,j(d)):(D.unwrap(a),h=!0)),null!==a.getAttribute("style")&&""===a.getAttribute("style").trim()&&a.removeAttribute("style"),h&&v(f,g,d)}function o(a){var c,d,e=a.querySelectorAll(F)||[];for(d=e.length;d--;)c=b.dom.domNode(e[d]).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),b.dom.domNode(e[d]).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),c&&1!==c.nodeType&&"BR"!==c.nodeName&&""!==(e[d].innerHTML||e[d].nodeValue||"").trim()&&e[d].parentNode.insertBefore(e[d].ownerDocument.createElement("BR"),c),c&&1!==c.nodeType&&"BR"!==c.nodeName&&""!==(e[d].innerHTML||e[d].nodeValue||"").trim()&&e[d].parentNode.insertBefore(e[d].ownerDocument.createElement("BR"),c),b.dom.unwrap(e[d])}function p(a,b){var c,d=a.startContainer,e=a.endContainer;return d&&1===d.nodeType&&d===e?(d.firstChild===d.lastChild&&1===a.endOffset&&d!==b.element&&"LI"!==d.nodeName&&"TD"!==d.nodeName&&(a.setStartBefore(d),a.setEndAfter(e)),void 0):d&&1===d.nodeType&&3===e.nodeType?(d.firstChild===e&&a.endOffset===e.data.length&&d!==b.element&&"LI"!==d.nodeName&&"TD"!==d.nodeName&&a.setEndAfter(d),void 0):e&&1===e.nodeType&&3===d.nodeType?(e.firstChild===d&&0===a.startOffset&&e!==b.element&&"LI"!==e.nodeName&&"TD"!==e.nodeName&&a.setStartBefore(e),void 0):d&&3===d.nodeType&&d===e&&1===d.parentNode.childNodes.length?(a.endOffset==e.data.length&&0===a.startOffset&&(c=d.parentNode,c!==b.element&&"LI"!==c.nodeName&&"TD"!==c.nodeName&&(a.setStartBefore(c),a.setEndAfter(c))),void 0):void 0}function q(a){var c,d,e,f,g,h,i,j,k=[];for(i=0,j=a.length;i<j;i++)if(1===a[i].startContainer.nodeType&&a[i].startContainer.matches("ul, ol")&&a[i].setStart(a[i].startContainer.childNodes[a[i].startOffset],0),1===a[i].endContainer.nodeType&&a[i].endContainer.matches("ul, ol")&&(h=a[i].endContainer.childNodes[Math.max(a[i].endOffset-1,0)],h.childNodes&&a[i].setEnd(h,h.childNodes.length)),c=a[i].getNodes([1],function(a){return"LI"===a.nodeName}),c.length>0){for(d=0,e=c.length;d<e;d++)g=a[i].compareNode(c[d]),g!==a[i].NODE_AFTER&&g!==a[i].NODE_INSIDE||(f=a[i].cloneRange(),h=b.dom.domNode(c[d]).prev({nodeTypes:[1]}),h?f.setEnd(h,h.childNodes.length):c[d].closest("ul, ol")?f.setEndBefore(c[d].closest("ul, ol")):f.setEndBefore(c[d]),k.push(f),a[i].setStart(c[d],0)),g!==a[i].NODE_BEFORE&&g!==a[i].NODE_INSIDE||(f=a[i].cloneRange(),f.setEnd(c[d],c[d].childNodes.length),k.push(f),h=b.dom.domNode(c[d]).next({nodeTypes:[1]}),h?a[i].setStart(h,0):c[d].closest("ul, ol")?a[i].setStartAfter(c[d].closest("ul, ol")):a[i].setStartAfter(c[d]));k.push(a[i])}else k.push(a[i]);return k}function r(a,c,d){var e=a?b.lang.object(a).clone(!0):null;return e&&(e.nodeName=e.nodeName||c||j(d)),e}function s(a,c,d,e){var f,g,i,j,m,n,o,p=c.startContainer;if(e=e||k(p,d.element,!0),e)g=a.firstChild,i=a.lastChild,d.selection.splitElementAtCaret(e,a),m=b.dom.domNode(i).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),j=b.dom.domNode(g).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),g&&!h(g,d)&&j&&!h(j,d)&&g.parentNode.insertBefore(d.doc.createElement("br"),g),i&&!h(i,d)&&m&&!h(m,d)&&m.parentNode.insertBefore(d.doc.createElement("br"),m);else if(f=l(p,d.element),f.outerNode&&f.innerNode&&f.parent){if(1===a.childNodes.length){for(;a.firstChild.firstChild;)f.innerNode.appendChild(a.firstChild.firstChild);a.firstChild.appendChild(f.outerNode)}d.selection.splitElementAtCaret(f.parent,a)}else n=a.firstChild,o=a.lastChild,c.insertNode(a),c.setStartBefore(n),c.setEndAfter(o)}function t(a,c,e){for(var f,g,i,j,k=a.cloneRange(),l=d(k.startContainer,k.startOffset).previousSibling,m=d(k.endContainer,k.endOffset).nextSibling,n=k.extractContents(),p=e.doc.createDocumentFragment();n.firstChild;){if(1===n.firstChild.nodeType&&n.firstChild.matches(F)){for(o(n.firstChild),f=b.dom.unwrap(n.firstChild),f.length>0&&(p.lastChild&&(1!==p.lastChild.nodeType||!h(p.lastChild,e))||!p.lastChild&&l&&(1!==l.nodeType||h(l,e)))&&p.appendChild(e.doc.createElement("BR")),i=0,j=f.length;i<j;i++)p.appendChild(f[i]);f.length>0&&(1===p.lastChild.nodeType&&h(p.lastChild,e)||(m||p.lastChild!==n.lastChild)&&p.appendChild(e.doc.createElement("BR")))}else p.appendChild(n.firstChild);!1}return g=b.lang.array(p.childNodes).get(),s(p,k,e),g}function u(a,c,d){var f=a&&b.dom.domNode(a).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});e(c)&&c.parentNode.removeChild(c),!e(a)||f&&1===f.nodeType&&"block"===d.win.getComputedStyle(f).display||a.parentNode.removeChild(a)}function v(a,b,c){a&&g(a)&&(a=a.previousSibling),b&&g(b)&&(b=b.nextSibling),a&&a.previousSibling,a&&(1!==a.nodeType||"block"!==c.win.getComputedStyle(a).display&&!e(a))&&a.parentNode&&a.parentNode.insertBefore(c.doc.createElement("br"),a.nextSibling),b&&(1!==b.nodeType||"block"!==c.win.getComputedStyle(b).display)&&b.parentNode&&b.parentNode.insertBefore(c.doc.createElement("br"),b)}function w(a,e,f,g){var h,i,j,l=e?c(e):null,n=a.cloneRange(),p=n.startContainer,q=d(n.startContainer,n.startOffset),t=d(n.endContainer,n.endOffset),v=n.startContainer!==q||3!==q.nodeType||H(q,n.startOffset)?b.dom.domNode(q).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}):q,w=1===n.endContainer.nodeType&&n.endContainer.childNodes[n.endOffset]===t&&(1===t.nodeType||!I(t,n.endOffset)&&!b.dom.domNode(t).is.rangyBookmark())||n.endContainer===t&&3===t.nodeType&&!I(t,n.endOffset)?t:b.dom.domNode(t).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),x=n.extractContents(),y=g.doc.createDocumentFragment(),z=l?b.dom.getParentElement(p,l,null,g.element):null,A=!f||!e||"BLOCKQUOTE"===e.nodeName&&"BLOCKQUOTE"===f,B=z||k(p,g.element,A);if(b.dom.domNode(w).is.rangyBookmark()&&(t=w,w=t.nextSibling),J(x),e&&"BLOCKQUOTE"===e.nodeName)j=m(null,e,g),j.appendChild(x),y.appendChild(j),i=[j];else{if(x.firstChild)for(;x.firstChild;)if(1==x.firstChild.nodeType&&x.firstChild.matches(F))m(x.firstChild,e,g),x.firstChild.matches(E)&&o(x.firstChild),y.appendChild(x.firstChild);else{for(h=m(null,r(e,f,g),g);x.firstChild&&(1!==x.firstChild.nodeType||!x.firstChild.matches(F));)1==x.firstChild.nodeType&&h.matches(E)&&o(x.firstChild),h.appendChild(x.firstChild);y.appendChild(h)}else y.appendChild(m(null,e,g));i=b.lang.array(y.childNodes).get()}return s(y,n,g,B),u(v,w,g),i.length>0&&(void 0===i[i.length-1].lastChild||b.dom.domNode(i[i.length-1].lastChild).is.rangyBookmark())&&i[i.length-1].appendChild(g.doc.createElement("br")),i}function x(a,c){var d=b.dom.getParentElement(a,{query:F},null,c.element);return d?d.nodeName:null}function y(a,c){var d,e=b.dom.getParentElement(a.selection.getOwnRanges()[0].startContainer,{query:E+", "+(c?c.toLowerCase():"div")},null,a.element);e?(d=a.selection.createRange(),d.selectNode(e),a.selection.setSelection(d)):a.isEmpty()||a.selection.selectLine()}function z(a,b){var c=b.selection.createRange(),d=a[a.length-1],e=1===d.nodeType&&d.childNodes?0|d.childNodes.length:d.length||0;c.setStart(a[0],0),c.setEnd(d,e),c.select()}function A(a,b,c){var d,e,f=b.selection.getOwnRanges(),g=[];for(f=q(f),e=f.length;e--;)p(f[e],b),d=x(f[e].startContainer,b),g="remove"===a?g.concat(t(f[e],d,b)):g.concat(w(f[e],c,d,b));return g}function B(a){return"string"==typeof a&&(a={nodeName:a.toUpperCase()}),a}function C(a){var c;return!!(a.selection.isCollapsed()&&(c=a.selection.getNodesNearCaret(),c&&c.caretNode&&(b.dom.domNode(c.caretNode).is.lineBreak()||3===c.caretNode.nodeType&&0===c.textOffset&&(!c.prevNode||b.dom.domNode(c.prevNode).is.lineBreak())||1===c.caretNode.nodeType&&c.caretNode.classList.contains("rangySelectionBoundary")&&(!c.prevNode||b.dom.domNode(c.prevNode).is.lineBreak()||b.dom.domNode(c.prevNode).is.block())&&(!c.nextNode||b.dom.domNode(c.nextNode).is.lineBreak()||b.dom.domNode(c.nextNode).is.block()))))}var D=b.dom,E="h1, h2, h3, h4, h5, h6, p, pre",F="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote",G="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",H=function(a,b){return/^\s*$/.test(a.data?a.data.slice(0,b):"")},I=function(a,b){return/^\s*$/.test(a.data?a.data.slice(b):"")},J=function(a){if(a){for(;a.firstChild&&3===a.firstChild.nodeType&&/^\s*$/.test(a.firstChild.data)&&a.lastChild!==a.firstChild;)a.removeChild(a.firstChild);for(;a.lastChild&&3===a.lastChild.nodeType&&/^\s*$/.test(a.lastChild.data)&&a.lastChild!==a.firstChild;)a.removeChild(a.lastChild);a.firstChild&&1===a.firstChild.nodeType&&"BR"===a.firstChild.nodeName&&a.lastChild!==a.firstChild&&a.removeChild(a.firstChild),a.lastChild&&1===a.lastChild.nodeType&&"BR"===a.lastChild.nodeName&&a.lastChild!==a.firstChild&&a.removeChild(a.lastChild)}};b.commands.formatBlock={exec:function(b,c,d){var e,f,g,h,j;if(d=B(d),e=[],d&&d.toggle&&(g=this.state(b,c,d)),g)for(f=a.saveSelection(b.win),h=0,j=g.length;h<j;h++)n(g[h],d,b);else b.selection.isCollapsed()&&(f=a.saveSelection(b.win),C(b)?b.selection.selectLine():y(b,d&&d.nodeName?d.nodeName.toUpperCase():void 0)),e=d?A("apply",b,d):A("remove",b);e=i(b,e),f?a.restoreSelection(f):z(e,b)},remove:function(b,c,d){d=B(d);var e,f;b.selection.isCollapsed()&&(f=a.saveSelection(b.win),y(b,d&&d.nodeName?d.nodeName.toUpperCase():void 0)),e=A("remove",b),e=i(b,e),f?a.restoreSelection(f):z(e,b)},state:function(a,c,d){var e,f,g,h,i;for(d=B(d),e=a.selection.filterElements(function(a){return b.dom.domNode(a).test(d||{query:F})}.bind(this)),f=a.selection.getSelectedOwnNodes(),h=0,i=f.length;h<i;h++)g=D.getParentElement(f[h],d||{query:F},null,a.element),g&&-1===e.indexOf(g)&&e.push(g);return 0!==e.length&&e}}}(b),function(a){a.commands.formatCode={exec:function(b,c,d){var e,f,g,h=this.state(b)[0];h?b.selection.executeAndRestore(function(){e=h.querySelector("code"),a.dom.replaceWithChildNodes(h),e&&a.dom.replaceWithChildNodes(e)}):(f=b.selection.getRange(),g=f.extractContents(),h=b.doc.createElement("pre"),e=b.doc.createElement("code"),d&&(e.className=d),h.appendChild(e),e.appendChild(g),f.insertNode(h),b.selection.selectNode(h))},state:function(b){var c,d=b.selection.getSelectedNode();return d&&d.nodeName&&"PRE"==d.nodeName&&d.firstChild&&d.firstChild.nodeName&&"CODE"==d.firstChild.nodeName?[d]:(c=a.dom.getParentElement(d,{query:"pre code"}),!!c&&[c.parentNode])}}}(b),function(b){function c(a){return/^\s*$/.test(a.className)}function d(a){return!a.getAttribute("style")||/^\s*$/.test(a.getAttribute("style"))}function e(a){var c=b.dom.getAttributes(a);return b.lang.object(c).isEmpty()}function f(a,c){var d,e,f,g;return 1===a.nodeType&&1===c.nodeType&&(a.nodeName===c.nodeName&&(d=a.className.trim().replace(/\s+/g," ").split(" "),e=c.className.trim().replace(/\s+/g," ").split(" "),!(b.lang.array(d).without(e).length>0)&&(f=b.dom.getAttributes(a),g=b.dom.getAttributes(c),!(f.length!==g.length||!b.lang.object(b.lang.object(f).difference(g)).isEmpty()))))}function g(a,c){var d,e=c&&c.nodeName||G,f=a.ownerDocument.createElement(e);if(c.classRegExp&&(f.className=f.className.replace(c.classRegExp,"")),c.className&&f.classList.add(c.className),c.styleProperty&&void 0!==c.styleValue&&(f.style[b.browser.fixStyleKey(c.styleProperty)]=c.styleValue),c.attribute)if("object"==typeof c.attribute)for(d in c.attribute)c.attribute.hasOwnProperty(d)&&f.setAttribute(d,c.attribute[d]);else void 0!==c.attributeValue&&f.setAttribute(c.attribute,c.attributeValue);return f}function h(a,b){for(var c in a)if(a.hasOwnProperty(c)&&(void 0===typeof b[c]||b[c]!==a[c]))return!1;return!0}function i(a,c,d){var e,f=b.dom.getAttributes(a),g=h(c,f);b.lang.object(f).difference(c);if(g&&!1!==d)for(e in c)c.hasOwnProperty(e)&&a.removeAttribute(e);else for(e in c)c.hasOwnProperty(e)&&a.setAttribute(e,c[e])}function j(a,f){var g,h,j;f.className&&(!1!==f.toggle&&a.classList.contains(f.className)?a.classList.remove(f.className):(f.classRegExp&&(a.className=a.className.replace(f.classRegExp,"")),a.classList.add(f.className)),c(a)&&a.removeAttribute("class")),f.styleProperty&&(!1!==f.toggle&&a.style[b.browser.fixStyleKey(f.styleProperty)].trim().replace(/, /g,",")===f.styleValue?a.style[b.browser.fixStyleKey(f.styleProperty)]="":a.style[b.browser.fixStyleKey(f.styleProperty)]=f.styleValue),d(a)&&a.removeAttribute("style"),f.attribute&&("object"==typeof f.attribute?g=f.attribute:(g={},g[f.attribute]=f.attributeValue||""),i(a,g,f.toggle)),h=f.nodeName?I[f.nodeName.toLowerCase()]||f.nodeName.toLowerCase():null,j=!!h&&b.dom.domNode(a).test({query:h}),f.nodeName&&f.nodeName!==G&&!j||(!1!==f.toggle&&j||!f.nodeName&&a.nodeName===G)&&c(a)&&d(a)&&e(a)&&b.dom.unwrap(a)}function k(a,c){var d=[];return a.isCollapsed()||(d=d.concat(a.getOwnNodes([3],function(a){return!b.dom.domNode(a).is.emptyTextNode()},c))),d}function l(a,b,c,d){var e=a,f=d?b:m(b);do{if(1===e.nodeType&&n(e,f))return e;e=e.parentNode}while(e&&e!==c);return null}function m(a){return{nodeName:a.nodeName||null,className:a.classRegExp?null:a.className||null,classRegExp:a.classRegExp||null,styleProperty:a.styleProperty||null}}function n(a,c){var d,e;return c.nodeName?(e=I[c.nodeName.toLowerCase()]||c.nodeName.toLowerCase(),b.dom.domNode(a).test({query:e})):(d=b.lang.object(c).clone(),d.query=H,b.dom.domNode(a).test(d))}function o(c,d){var e=document.documentElement||document.body,f=e.scrollTop,g=e.scrollLeft;a.getSelection(c.win);a.getSelection(c.win).removeAllRanges();try{a.getSelection(c.win).addRange(d)}catch(a){}c.doc.activeElement&&b.dom.contains(c.element,c.doc.activeElement)||(c.element.focus(),e.scrollTop=f,e.scrollLeft=g,a.getSelection(c.win).addRange(d))}function p(b,c){var d=a.createRange(c.doc),e=b[b.length-1];b[0]&&e&&(d.setStart(b[0],0),d.setEnd(e,e.length),o(c,d))}function q(b,c,d,e){var f=a.createRange(b.doc);c&&(f.setStart(c,d),f.setEnd(c,void 0!==e?e:d),o(b,f))}function r(a,b,c){var d,e,f,g,h,i=k(a.selection),j=[],m=!1;if(a.selection.isInThisEditable()){if(0===i.length&&a.selection.isCollapsed()){if(f=a.selection.getSelection().anchorNode,!f)return{nodes:[],partial:!1};3===f.nodeType&&(i=[f])}for(i.length||(e=a.selection.getOwnRanges()[0],e&&(i=[e.endContainer])),g=0,h=i.length;g<h;g++)d=l(i[g],b,a.element,c),d?j.push(d):m=!0}return{nodes:j,partial:m}}function s(a){var b,c,d,e;return!!(a&&(b=a.anchorNode,c=a.anchorOffset,b&&3===b.nodeType&&c>0&&c<b.data.length))&&(d=b.data[c-1],e=b.data[c],/\w/.test(d)&&/\w/.test(e))}function t(c){var d,e,f,g,h,i,j=[];if(c&&(d=c.anchorNode,e=h=i=c.anchorOffset,f=d.ownerDocument,g=a.createRange(f),d&&3===d.nodeType)){for(;h>0&&/\w/.test(d.data[h-1]);)h--;for(;i<d.data.length&&/\w/.test(d.data[i]);)i++;return g.setStartAndEnd(d,h,i),g.splitBoundaries(),j=g.getNodes([3],function(a){return!b.dom.domNode(a).is.emptyTextNode()}),{wordOffset:e-h,range:g,textNode:j[0]}}return!1}function u(a,b){for(;b.firstChild;)a.appendChild(b.firstChild);b.parentNode.removeChild(b)}function v(a){for(var b=a.length;b--;)a[b]&&a[b].parentNode&&(a[b].nextSibling&&f(a[b],a[b].nextSibling)&&u(a[b],a[b].nextSibling),a[b].previousSibling&&f(a[b],a[b].previousSibling)&&u(a[b].previousSibling,a[b]))}function w(a,b,c){b.length>0&&p(b,a),v(r(a,c).nodes),b.length>0&&p(b,a)}function x(a,b,c,d){q(a,b,c),v(r(a,d).nodes),q(a,b,c)}function y(a,b){var c=g(a,b);a.parentNode.insertBefore(c,a),c.appendChild(a)}function z(a,c,d){var e,f=c.element,g=l(a,d,f);g&&(e=g.cloneNode(!1),b.dom.domNode(a).escapeParent(g,e),j(e,d))}function A(a,c,d){var e=c.element,f=l(a,d,e);f&&b.dom.domNode(a).escapeParent(f)}function B(a,b,c){var d=g(a.endContainer,c);a.surroundContents(d),b.selection.selectNode(d)}function C(a,c,d,e){var f,g,h,i,k,m=r(a,e,!0),n=a.selection.getSelection();if(c.length){if(m.partial||!1===e.toggle)for(i=c.length;i--;)l(c[i],e,a.element)&&z(c[i],a,e),l(c[i],e,a.element)||y(c[i],e);else for(i=c.length;i--;)z(c[i],a,e);w(a,c,e)}else if(!1!==e.toggle){if(s(n))f=t(n),g=f.textNode,z(f.textNode,a,e),x(a,f.textNode,f.wordOffset,e);else if(g=a.doc.createTextNode(b.INVISIBLE_SPACE),h=d.nodes[0].cloneNode(!1),h.appendChild(g),a.selection.splitElementAtCaret(d.nodes[0],h),j(h,e),w(a,[g],e),k=a.selection.getSelection(),k.anchorNode&&k.focusNode)try{k.collapseToEnd()}catch(a){}}else for(i=d.nodes.length;i--;)j(d.nodes[i],e)}function D(a,c,d,e){var f,g,h,i=a.selection.getSelection();if(c.length){for(h=c.length;h--;)A(c[h],a,e);w(a,c,e)}else{for(f=i.anchorNode,g=i.anchorOffset,h=d.nodes.length;h--;)b.dom.unwrap(d.nodes[h]);x(a,f,g,e)}}function E(a,b,c){var d,e,f,g=a.selection.getSelection();if(b.length){for(e=b.length;e--;)y(b[e],c);w(a,b,c)}else s(g)?(d=t(g),y(d.textNode,c),x(a,d.textNode,d.wordOffset,c)):(f=a.selection.getOwnRanges()[0],f&&B(f,a,c))}function F(a){return a="string"==typeof a?{nodeName:a}:a,a.nodeName&&(a.nodeName=a.nodeName.toUpperCase()),a}var G="SPAN",H="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",I={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};b.commands.formatInline={exec:function(a,b,c){c=F(c),a.element.normalize();var d=k(a.selection,!0),e=r(a,c);e.nodes.length>0?C(a,d,e,c):E(a,d,c),a.element.normalize()},remove:function(a,b,c){c=F(c),a.element.normalize();var d=k(a.selection,!0),e=r(a,c);e.nodes.length>0&&D(a,d,e,c),a.element.normalize()},state:function(a,b,c){c=F(c);var d=r(a,c,!0).nodes;return 0!==d.length&&d}}}(b),function(a){var b={nodeName:"BLOCKQUOTE",toggle:!0};a.commands.insertBlockQuote={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){a.commands.insertHTML={exec:function(a,b,c){a.selection.insertHTML(c)},state:function(){return!1}}}(b),function(a){var b="IMG";a.commands.insertImage={exec:function(c,d,e){var f,g,h,i,j,k;if(e="object"==typeof e?e:{src:e},f=c.doc,g=this.state(c),g&&!e.src)return c.selection.setBefore(g),i=g.parentNode,i.removeChild(g),a.dom.removeEmptyTextNodes(i),"A"!==i.nodeName||i.firstChild||(c.selection.setAfter(i),i.parentNode.removeChild(i)),a.quirks.redraw(c.element),void 0;if(g)for(j in e)e.hasOwnProperty(j)&&g.setAttribute("className"===j?"class":j,e[j]);else{g=f.createElement(b);for(k in e)g.setAttribute("className"===k?"class":k,e[k]);c.selection.insertNode(g),a.browser.hasProblemsSettingCaretAfterImg()?(h=f.createTextNode(a.INVISIBLE_SPACE),c.selection.insertNode(h),c.selection.setAfter(h)):c.selection.setAfter(g)}},state:function(c){var d,e,f,g=c.doc;return!!a.dom.hasElementWithTagName(g,b)&&(d=c.selection.getSelectedNode(),!!d&&(d.nodeName===b?d:d.nodeType===a.ELEMENT_NODE&&(e=c.selection.getText(),e=a.lang.string(e).trim(),!e&&(f=c.selection.getNodes(a.ELEMENT_NODE,function(a){return"IMG"===a.nodeName}),1===f.length&&f[0]))))}}}(b),function(a){var b="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(a,c){a.selection.insertHTML(b)},state:function(){return!1}}}(b),function(a){a.commands.insertOrderedList={exec:function(b,c){a.commands.insertList.exec(b,c,"OL")},state:function(b,c){return a.commands.insertList.state(b,c,"OL")}}}(b),function(a){a.commands.insertUnorderedList={exec:function(b,c){a.commands.insertList.exec(b,c,"UL")},state:function(b,c){return a.commands.insertList.state(b,c,"UL")}}}(b),b.commands.insertList=function(b){var c=function(a,b){if(a&&a.nodeName){"string"==typeof b&&(b=[b]);for(var c=b.length;c--;)if(a.nodeName===b[c])return!0}return!1},d=function(a,d,e){var f,g,h={el:null,other:!1};return a&&(f=b.dom.getParentElement(a,{query:"li"},!1,e.element),g="UL"===d?"OL":"UL",c(a,d)?h.el=a:c(a,g)?h={el:a,other:!0}:f&&(c(f.parentNode,d)?h.el=f.parentNode:c(f.parentNode,g)&&(h={el:f.parentNode,other:!0}))),h.el&&!e.element.contains(h.el)&&(h.el=null),h},e=function(a,c,d){var e,f,h="UL"===c?"OL":"UL";d.selection.executeAndRestoreRangy(function(){var i,j;if(e=g(h,d),e.length)for(i=e.length;i--;)b.dom.renameElement(e[i],c.toLowerCase());else{for(f=g(["OL","UL"],d),j=f.length;j--;)b.dom.resolveList(f[j],d.config.useLineBreaks);0===f.length&&b.dom.resolveList(a,d.config.useLineBreaks)}})},f=function(a,c,d){var e="UL"===c?"OL":"UL";d.selection.executeAndRestoreRangy(function(){var f,h=[a].concat(g(e,d));for(f=h.length;f--;)b.dom.renameElement(h[f],c.toLowerCase())})},g=function(a,b){var d,e=b.selection.getOwnRanges(),f=[];for(d=e.length;d--;)f=f.concat(e[d].getNodes([1],function(b){return c(b,a)}));return f},h=function(c,d){var e,f,g,h=a.saveSelection(d.win),i="_wysihtml5-temp-"+(new Date).getTime();d.commands.exec("formatBlock",{nodeName:"div",className:i}),g=d.element.querySelector("."+i),/\uFEFF/g,g.innerHTML=g.innerHTML.replace(b.INVISIBLE_SPACE_REG_EXP,""),g&&(e=/^(\s|(<br>))+$/i.test(g.innerHTML),f=b.dom.convertToList(g,c.toLowerCase(),d.parent.config.classNames.uneditableContainer),h&&a.restoreSelection(h),e&&d.selection.selectNode(f.querySelector("li"),!0))};return{exec:function(a,c,g){var i,j,k=a.doc,l="OL"===g?"insertOrderedList":"insertUnorderedList",m=a.selection.getSelection(),n=1===m.anchorNode.nodeType&&m.anchorNode.firstChild?m.anchorNode.childNodes[m.anchorOffset]:m.anchorNode,o=1===m.focusNode.nodeType&&m.focusNode.firstChild?m.focusNode.childNodes[m.focusOffset]||m.focusNode.lastChild:m.focusNode;m.isBackwards()&&(n=[o,o=n][0]),b.dom.domNode(o).is.emptyTextNode(!0)&&o&&(o=b.dom.domNode(o).prev({nodeTypes:[1,3],ignoreBlankTexts:!0})),b.dom.domNode(n).is.emptyTextNode(!0)&&n&&(n=b.dom.domNode(n).next({nodeTypes:[1,3],ignoreBlankTexts:!0})),i=n&&o?n===o?n:b.dom.domNode(n).commonAncestor(o,a.element):a.selection.getSelectedNode(),j=d(i,g,a),j.el?j.other?f(j.el,g,a):e(j.el,g,a):a.commands.support(l)?k.execCommand(l,!1,null):h(g,a)},state:function(a,b,c){var e=a.selection.getSelectedNode(),f=d(e,c,a);return!(!f.el||f.other)&&f.el}}}(b),function(a){var b={nodeName:"I",toggle:!0};a.commands.italic={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(b),function(a){var b={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyCenter={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){var b={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyLeft={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){var b={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyRight={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){var b={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyFull={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){var b={styleProperty:"textAlign",styleValue:"right",toggle:!0};a.commands.alignRightStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){var b={styleProperty:"textAlign",styleValue:"left",toggle:!0};a.commands.alignLeftStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){var b={styleProperty:"textAlign",styleValue:"center",toggle:!0};a.commands.alignCenterStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){var b={styleProperty:"textAlign",styleValue:"justify",toggle:!0};a.commands.alignJustifyStyle={exec:function(c,d){return a.commands.formatBlock.exec(c,"formatBlock",b)},state:function(c,d){return a.commands.formatBlock.state(c,"formatBlock",b)}}}(b),function(a){a.commands.redo={exec:function(a){return a.undoManager.redo()},state:function(a){return!1}}}(b),function(a){var b={nodeName:"U",toggle:!0};a.commands.underline={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(b),function(a){a.commands.undo={exec:function(a){return a.undoManager.undo()},state:function(a){return!1}}}(b),function(a){a.commands.createTable={exec:function(a,b,c){var d,e,f;if(c&&c.cols&&c.rows&&parseInt(c.cols,10)>0&&parseInt(c.rows,10)>0){for(f=c.tableStyle?'<table style="'+c.tableStyle+'">':"<table>",f+="<tbody>",e=0;e<c.rows;e++){for(f+="<tr>",d=0;d<c.cols;d++)f+="<td><br></td>";f+="</tr>"}f+="</tbody></table>",a.commands.exec("insertHTML",f)}},state:function(a,b){return!1}}}(b),function(a){a.commands.mergeTableCells={exec:function(b,c){b.tableSelection&&b.tableSelection.start&&b.tableSelection.end&&(this.state(b,c)?a.dom.table.unmergeCell(b.tableSelection.start):a.dom.table.mergeCellsBetween(b.tableSelection.start,b.tableSelection.end))},state:function(b,c){if(b.tableSelection){var d=b.tableSelection.start,e=b.tableSelection.end;if(d&&e&&d==e&&(a.dom.getAttribute(d,"colspan")&&parseInt(a.dom.getAttribute(d,"colspan"),10)>1||a.dom.getAttribute(d,"rowspan")&&parseInt(a.dom.getAttribute(d,"rowspan"),10)>1))return[d]}return!1}}}(b),function(a){a.commands.addTableCells={exec:function(b,c,d){if(b.tableSelection&&b.tableSelection.start&&b.tableSelection.end){var e=a.dom.table.orderSelectionEnds(b.tableSelection.start,b.tableSelection.end);"before"==d||"above"==d?a.dom.table.addCells(e.start,d):"after"!=d&&"below"!=d||a.dom.table.addCells(e.end,d),setTimeout(function(){b.tableSelection.select(e.start,e.end)},0)}},state:function(a,b){return!1}}}(b),function(a){a.commands.deleteTableCells={exec:function(b,c,d){if(b.tableSelection&&b.tableSelection.start&&b.tableSelection.end){var e,f=a.dom.table.orderSelectionEnds(b.tableSelection.start,b.tableSelection.end),g=a.dom.table.indexOf(f.start),h=b.tableSelection.table;a.dom.table.removeCells(f.start,d),setTimeout(function(){e=a.dom.table.findCell(h,g),e||("row"==d&&(e=a.dom.table.findCell(h,{row:g.row-1,col:g.col})),"column"==d&&(e=a.dom.table.findCell(h,{row:g.row,col:g.col-1}))),e&&b.tableSelection.select(e,e)},0)}},state:function(a,b){return!1}}}(b),function(a){a.commands.indentList={exec:function(a,b,c){var d=a.selection.getSelectionParentsByTag("LI");return!!d&&this.tryToPushLiLevel(d,a.selection)},state:function(a,b){return!1},tryToPushLiLevel:function(b,c){var d,e,f,g,h,i=!1;return c.executeAndRestoreRangy(function(){for(var c=b.length;c--;)g=b[c],d="OL"===g.parentNode.nodeName?"OL":"UL",e=g.ownerDocument.createElement(d),f=a.dom.domNode(g).prev({nodeTypes:[a.ELEMENT_NODE]}),h=f?f.querySelector("ul, ol"):null,f&&(h?h.appendChild(g):(e.appendChild(g),f.appendChild(e)),i=!0)}),i}}}(b),function(a){a.commands.outdentList={exec:function(a,b,c){var d=a.selection.getSelectionParentsByTag("LI");return!!d&&this.tryToPullLiLevel(d,a)},state:function(a,b){return!1},tryToPullLiLevel:function(b,c){var d,e,f,g,h,i=!1,j=this;return c.selection.executeAndRestoreRangy(function(){var k,l;for(k=b.length;k--;)if(g=b[k],g.parentNode&&(d=g.parentNode,"OL"===d.tagName||"UL"===d.tagName)){if(i=!0,e=a.dom.getParentElement(d.parentNode,{query:"ol, ul"},!1,c.element),f=a.dom.getParentElement(d.parentNode,{query:"li"},!1,c.element),e&&f)g.nextSibling&&(h=j.getAfterList(d,g),g.appendChild(h)),e.insertBefore(g,f.nextSibling);else{for(g.nextSibling&&(h=j.getAfterList(d,g),g.appendChild(h)),l=g.childNodes.length;l--;)d.parentNode.insertBefore(g.childNodes[l],d.nextSibling);d.parentNode.insertBefore(document.createElement("br"),d.nextSibling),g.parentNode.removeChild(g)}0===d.childNodes.length&&d.parentNode.removeChild(d)}}),i},getAfterList:function(a,b){for(var c=a.nodeName,d=document.createElement(c);b.nextSibling;)d.appendChild(b.nextSibling);return d}}}(b),function(a){var b={nodeName:"SUB",toggle:!0};a.commands.subscript={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(b),function(a){var b={nodeName:"SUP",toggle:!0};a.commands.superscript={exec:function(c,d){a.commands.formatInline.exec(c,d,b)},state:function(c,d){return a.commands.formatInline.state(c,d,b)}}}(b),function(a){var b=90,c="data-wysihtml5-selection-node",d="data-wysihtml5-selection-offset",e=(a.INVISIBLE_SPACE,a.INVISIBLE_SPACE,a.dom);a.UndoManager=a.lang.Dispatcher.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var a,c=this;this.composer.sandbox.getDocument(),e.observe(this.element,"keydown",function(a){if(!a.altKey&&(a.ctrlKey||a.metaKey)){var d=a.keyCode,e=d===b&&!a.shiftKey,f=d===b&&a.shiftKey||89===d;e?(c.undo(),a.preventDefault()):f&&(c.redo(),a.preventDefault())}}),e.observe(this.element,"keydown",function(b){var d=b.keyCode;d!==a&&(a=d,8!==d&&46!==d||c.transact())}),this.editor.on("newword:composer",function(){c.transact()}).on("beforecommand:composer",function(){c.transact()})},transact:function(){var b,e,f,g,h,i,j,k=this.historyStr[this.position-1],l=this.composer.getValue(!1,!1),m=this.element.offsetWidth>0&&this.element.offsetHeight>0;l!==k&&(i=this.historyStr.length=this.historyDom.length=this.position,i>25&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,m&&(b=this.composer.selection.getRange(),e=b&&b.startContainer?b.startContainer:this.element,f=b&&b.startOffset?b.startOffset:0,e.nodeType===a.ELEMENT_NODE?g=e:(g=e.parentNode,h=this.getChildNodeIndex(g,e)),g.setAttribute(d,f),void 0!==h&&g.setAttribute(c,h)),j=this.element.cloneNode(!!l),this.historyDom.push(j),this.historyStr.push(l),g&&(g.removeAttribute(d),g.removeAttribute(c)))},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(a){var b,e,f,g,h,i;for(this.element.innerHTML="",b=0,e=a.childNodes,f=a.childNodes.length;b<f;b++)this.element.appendChild(e[b].cloneNode(!0));a.hasAttribute(d)?(g=a.getAttribute(d),i=a.getAttribute(c),h=this.element):(h=this.element.querySelector("["+d+"]")||this.element,g=h.getAttribute(d),i=h.getAttribute(c),h.removeAttribute(d),h.removeAttribute(c)),null!==i&&(h=this.getChildNodeByIndex(h,+i)),this.composer.selection.set(h,g)},getChildNodeIndex:function(a,b){for(var c=0,d=a.childNodes,e=d.length;c<e;c++)if(d[c]===b)return c},getChildNodeByIndex:function(a,b){return a.childNodes[b]}})}(b),b.views.View=d.extend({constructor:function(a,b,c){this.parent=a,this.element=b,this.config=c,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.on("beforeload",function(){a.parent.on("change_view",function(b){b===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(b){var c=b.dom,d=b.browser;b.views.Composer=b.views.View.extend({name:"composer",constructor:function(a,b,c){this.base(a,b,c),this.config.noTextarea?this.editableArea=b:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=d.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function(a,c){var d=this.isEmpty()?"":b.quirks.getCorrectInnerHTML(this.element);return!1!==a&&(d=this.parent.parse(d,!1!==c)),d},setValue:function(a,b){!1!==b&&(a=this.parent.parse(a));try{this.element.innerHTML=a}catch(b){this.element.innerText=a}},cleanUp:function(b){var c;this.selection&&this.selection.isInThisEditable()&&(c=a.saveSelection(this.win)),this.parent.parse(this.element,void 0,b),c&&a.restoreSelection(c)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=c.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(a){b.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var c=this.element.lastChild;a&&c&&this.selection&&("BR"===c.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var a={};return void 0!==this.win.pageYOffset?a.y=this.win.pageYOffset:a.y=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,void 0!==this.win.pageXOffset?a.x=this.win.pageXOffset:a.x=(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,a}},setScrollPos:function(a){a&&void 0!==a.x&&void 0!==a.y&&this.win.scrollTo(a.x,a.y)},getTextContent:function(){return c.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var a=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(a)||""===a||"<br>"===a||"<p></p>"===a||"<p><br></p>"===a||this.hasPlaceholderSet()},_initContentEditableArea:function(){var a=this;this.config.noTextarea?this.sandbox=new c.ContentEditableArea(function(){a._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new c.ContentEditableArea(function(){a._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),c.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var a,b=this;this.sandbox=new c.Sandbox(function(){b._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getIframe(),a=this.textarea.element,c.insert(this.editableArea).after(a),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var a=document.createElement("input");a.type="hidden",a.name="_wysihtml5_mode",a.value=1,c.insert(a).after(this.textarea.element)}},_create:function(){var a,e,f=this;this.doc=this.sandbox.getDocument(),this.win=this.sandbox.getWindow(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new b.Selection(this.parent,this.element,this.config.classNames.uneditableContainer),this.commands=new b.Commands(this.parent),this.config.noTextarea||c.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),this._initAutoLinking(),c.addClass(this.element,this.config.classNames.composer),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe(),a=this.config.name,a&&(c.addClass(this.element,a),this.config.contentEditableMode||c.addClass(this.editableArea,a)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable(),e="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"),e&&c.simulatePlaceholder(this.parent,this,e,this.config.classNames.placeholder),this.commands.exec("styleWithCSS",!1),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||d.isIos()||setTimeout(function(){f.focus(!0)},100),d.clearsContentEditableCorrectly()||b.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var a,e,f,g=this,h=d.canDisableAutoLinking(),i=d.doesAutoLinkingInContentEditable();h&&this.commands.exec("AutoUrlDetect",!1,!1),this.config.autoLink&&((!i||i&&h)&&(this.parent.on("newword:composer",function(){var a,d,e,f;if(c.getTextContent(g.element).match(c.autoLink.URL_REG_EXP)){for(a=g.selection.getSelectedNode(),d=g.element.querySelectorAll("."+g.config.classNames.uneditableContainer),e=!1,f=d.length;f--;)b.dom.contains(d[f],a)&&(e=!0);e||c.autoLink(a,[g.config.classNames.uneditableContainer])}}),c.observe(this.element,"blur",function(){c.autoLink(g.element,[g.config.classNames.uneditableContainer])})),a=this.sandbox.getDocument().getElementsByTagName("a"),e=c.autoLink.URL_REG_EXP,f=function(a){var d=b.lang.string(c.getTextContent(a)).trim();return"www."===d.substr(0,4)&&(d="http://"+d),d},c.observe(this.element,"keydown",function(b){if(a.length){var d,h=g.selection.getSelectedNode(b.target.ownerDocument),i=c.getParentElement(h,{query:"a"},4);i&&(d=f(i),setTimeout(function(){var a=f(i);a!==d&&a.match(e)&&i.setAttribute("href",a)},0))}}))},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),d.supportsEvent("resizeend")){var a=["width","height"],e=a.length,f=this.element;c.observe(f,"resizeend",function(c){var d,g=c.target||c.srcElement,h=g.style,i=0;if("IMG"===g.nodeName){for(;i<e;i++)d=a[i],h[d]&&(g.setAttribute(d,parseInt(h[d],10)),h[d]="");b.quirks.redraw(f)}})}},_initUndoManager:function(){this.undoManager=new b.UndoManager(this.parent)},_initLineBreaking:function(){function a(a){var b=c.getParentElement(a,{query:"p, div"},2);b&&c.contains(e.element,b)&&e.selection.executeAndRestoreRangy(function(){e.config.useLineBreaks?((!b.firstChild||b.firstChild===b.lastChild&&1===b.firstChild.nodeType&&b.firstChild.classList.contains("rangySelectionBoundary"))&&b.appendChild(e.doc.createElement("br")),c.replaceWithChildNodes(b)):"P"!==b.nodeName&&c.renameElement(b,"p")})}var e=this;this.config.useLineBreaks||c.observe(this.element,["focus"],function(){e.isEmpty()&&setTimeout(function(){var a=e.doc.createElement("P");e.element.innerHTML="",e.element.appendChild(a),d.displaysCaretInEmptyContentEditableCorrectly()?e.selection.selectNode(a,!0):(a.innerHTML="<br>",e.selection.setBefore(a.firstChild))},0)}),c.observe(this.element,"keydown",function(d){var f,g=d.keyCode;if(!(d.shiftKey||d.ctrlKey||d.defaultPrevented||g!==b.ENTER_KEY&&g!==b.BACKSPACE_KEY)){if(f=c.getParentElement(e.selection.getSelectedNode(),{query:"li, p, h1, h2, h3, h4, h5, h6"},4),f)return setTimeout(function(){var d,h=e.selection.getSelectedNode();if("LI"===f.nodeName){if(!h)return;d=c.getParentElement(h,{query:"ul, ol, menu"},2),d||a(h)}g===b.ENTER_KEY&&f.nodeName.match(/^H[1-6]$/)&&a(h)},0),void 0;e.config.useLineBreaks&&g===b.ENTER_KEY&&!b.browser.insertsLineBreaksOnReturn()&&(d.preventDefault(),e.commands.exec("insertLineBreak"))}})}})}(b),function(a){var b=a.dom,c=document,d=window,e=c.createElement("div"),f=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],g=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],h=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",a.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],i=function(a){if(a.setActive)try{a.setActive()}catch(a){}else{var e=a.style,f=c.documentElement.scrollTop||c.body.scrollTop,g=c.documentElement.scrollLeft||c.body.scrollLeft,h={position:e.position,top:e.top,left:e.left,WebkitUserSelect:e.WebkitUserSelect};b.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a),a.focus(),b.setStyles(h).on(a),d.scrollTo&&d.scrollTo(g,f)}};a.views.Composer.prototype.style=function(){var d,j,k=this,l=c.querySelector(":focus"),m=this.textarea.element,n=m.hasAttribute("placeholder"),o=n&&m.getAttribute("placeholder"),p=m.style.display,q=m.disabled;return this.focusStylesHost=e.cloneNode(!1),this.blurStylesHost=e.cloneNode(!1),this.disabledStylesHost=e.cloneNode(!1),n&&m.removeAttribute("placeholder"),m===l&&m.blur(),m.disabled=!1,m.style.display=d="none",(m.getAttribute("rows")&&"auto"===b.getStyle("height").from(m)||m.getAttribute("cols")&&"auto"===b.getStyle("width").from(m))&&(m.style.display=d=p),b.copyStyles(g).from(m).to(this.editableArea).andTo(this.blurStylesHost),b.copyStyles(f).from(m).to(this.element).andTo(this.blurStylesHost),b.insertCSS(h).into(this.element.ownerDocument),m.disabled=!0,b.copyStyles(g).from(m).to(this.disabledStylesHost),b.copyStyles(f).from(m).to(this.disabledStylesHost),m.disabled=q,m.style.display=p,i(m),m.style.display=d,b.copyStyles(g).from(m).to(this.focusStylesHost),b.copyStyles(f).from(m).to(this.focusStylesHost),m.style.display=p,b.copyStyles(["display"]).from(m).to(this.editableArea),j=a.lang.array(g).without(["display"]),l?l.focus():m.blur(),n&&m.setAttribute("placeholder",o),this.parent.on("focus:composer",function(){b.copyStyles(j).from(k.focusStylesHost).to(k.editableArea),b.copyStyles(f).from(k.focusStylesHost).to(k.element)}),this.parent.on("blur:composer",function(){b.copyStyles(j).from(k.blurStylesHost).to(k.editableArea),b.copyStyles(f).from(k.blurStylesHost).to(k.element)}),this.parent.observe("disable:composer",function(){b.copyStyles(j).from(k.disabledStylesHost).to(k.editableArea),b.copyStyles(f).from(k.disabledStylesHost).to(k.element)}),this.parent.observe("enable:composer",function(){b.copyStyles(j).from(k.blurStylesHost).to(k.editableArea),b.copyStyles(f).from(k.blurStylesHost).to(k.element)}),this}}(b),function(a){var b=a.dom,c=b.domNode,d=a.browser,e={66:"bold",73:"italic",85:"underline"},f={addListeners:function(a,b,c){for(var d=0,e=b.length;d<e;d++)a.addEventListener(b[d],c,!1)},removeListeners:function(a,b,c){for(var d=0,e=b.length;d<e;d++)a.removeEventListener(b[d],c,!1)},fixLastBrDeletionInTable:function(b,c){var d,e,f;return!!(b.selection.caretIsLastInSelection()&&(d=b.selection.getSelection(),e=d.anchorNode,e&&1===e.nodeType&&(a.dom.getParentElement(e,{query:"td, th"},!1,b.element)||c)&&(f=e.childNodes[d.anchorOffset],f&&1===f.nodeType&"BR"===f.nodeName)))&&(f.parentNode.removeChild(f),!0)},handleUneditableDeletion:function(a){var b,c=a.selection.getBeforeSelection(!0);if(c&&("element"===c.type||"leafnode"===c.type)&&1===c.node.nodeType&&c.node.classList.contains(a.config.classNames.uneditableContainer)){if(f.fixLastBrDeletionInTable(a,!0))return!0;try{b=new CustomEvent("wysihtml5:uneditable:delete",{bubbles:!0,cancelable:!1}),c.node.dispatchEvent(b)}catch(a){}return c.node.parentNode.removeChild(c.node),!0}return!1},fixDeleteInTheBeginningOfBlock:function(b){var d,e,f,g,h=b.selection,i=h.getPreviousNode();if(h.caretIsFirstInSelection(a.browser.usesControlRanges())&&i&&1===i.nodeType&&a.dom.domNode(i).is.block()&&!c(i).test({query:"ol, ul, table, tr, dl"})){if(/^\s*$/.test(i.textContent||i.innerText))return i.parentNode.removeChild(i),!0;if(i.lastChild){if(d=i.lastChild,e=h.getSelectedNode(),f=c(i).commonAncestor(e,b.element),g=a.dom.getParentElement(e,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,f||b.element),g)return c(g).transferContentTo(i,!0),h.setAfter(d),!0;if(a.browser.usesControlRanges())return e=h.getCaretNode(),c(e).transferContentTo(i,!0),h.setAfter(d),!0}}return!1},fixDeleteInTheBeginningOfLi:function(b){if(a.browser.hasLiDeletingProblem()){var d,e,f=b.selection.getSelection(),g=f.anchorNode,h=b.selection.caretIsFirstInSelection();if(3===g.nodeType&&0===f.anchorOffset&&g===g.parentNode.firstChild&&(g=g.parentNode,h=!0),h&&g&&1===g.nodeType&&"LI"===g.nodeName&&(d=c(g).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),d||!g.parentNode||"UL"!==g.parentNode.nodeName&&"OL"!==g.parentNode.nodeName||(d=c(g.parentNode).prev({nodeTypes:[1,3],ignoreBlankTexts:!0})),d))return e=g.firstChild,c(g).transferContentTo(d,!0),e?b.selection.setBefore(e):d&&(1===d.nodeType?d.lastChild?b.selection.setAfter(d.lastChild):b.selection.selectNode(d):b.selection.setAfter(d)),!0}return!1},fixDeleteInTheBeginningOfControlSelection:function(a){var b,d=a.selection,e=d.getPreviousNode(),f=d.getSelectedNode();return!!d.caretIsFirstInSelection()&&(3===f.nodeType&&(f=f.parentNode),b=f.firstChild,c(f).transferContentTo(e,!0),b&&a.selection.setBefore(b),!0)},initTableHandling:function(){var b=function(){window.removeEventListener("load",b),this.doc.execCommand("enableObjectResizing",!1,"false"),this.doc.execCommand("enableInlineTableEditing",!1,"false")}.bind(this),c=function(){b.call(this),f.removeListeners(this.sandbox.getIframe(),["focus","mouseup","mouseover"],c)}.bind(this);this.doc.execCommand&&a.browser.supportsCommand(this.doc,"enableObjectResizing")&&a.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?f.addListeners(this.sandbox.getIframe(),["focus","mouseup","mouseover"],c):window.addEventListener("load",b)),this.tableSelection=a.quirks.tableCellsSelection(this.element,this.parent)},doLineBreaksModeEnterWithCaret:function(d){var e,f,g,h,i,j=!1,k=d.selection.getNodesNearCaret();return k&&((k.caretNode||k.nextNode)&&(e=b.getParentElement(k.caretNode||k.nextNode,{query:"p, pre, div, blockquote"},2),e===d.element&&(e=void 0)),e&&k.caretNode&&(c(k.caretNode).is.lineBreak()?d.config.doubleLineBreakEscapesBlock&&(j=!0,k.caretNode.parentNode.removeChild(k.caretNode),c(k.nextNode).is.lineBreak()&&k.nextNode.parentNode.removeChild(k.nextNode),f=d.doc.createElement("br"),c(k.nextNode).is.lineBreak()&&k.nextNode===e.lastChild?e.parentNode.insertBefore(f,e.nextSibling):d.selection.splitElementAtCaret(e,f),k.nextNode&&3===k.nextNode.nodeType&&(k.nextNode.data=k.nextNode.data.replace(/^ *[\r\n]+/,"")),d.selection.setBefore(f)):3===k.caretNode.nodeType&&a.browser.hasCaretBlockElementIssue()&&k.textOffset===k.caretNode.data.length&&!k.nextNode&&(j=!0,g=d.doc.createElement("br"),h=d.doc.createElement("br"),i=d.doc.createDocumentFragment(),i.appendChild(g),i.appendChild(h),d.selection.insertNode(i),d.selection.setBefore(h)))),j}},g=function(b,c){var d=c.selection;c.element;if(d.isCollapsed()){if(f.handleUneditableDeletion(c))return b.preventDefault(),void 0;if(f.fixDeleteInTheBeginningOfLi(c))return b.preventDefault(),void 0;if(f.fixDeleteInTheBeginningOfBlock(c))return b.preventDefault(),void 0;if(f.fixLastBrDeletionInTable(c))return b.preventDefault(),void 0;if(a.browser.usesControlRanges()&&f.fixDeleteInTheBeginningOfControlSelection(c))return b.preventDefault(),void 0}else d.containsUneditable()&&(b.preventDefault(),d.deleteContents())},h=function(a,b){if(b.config.useLineBreaks&&!a.shiftKey&&!a.ctrlKey){b.selection.isCollapsed()&&f.doLineBreaksModeEnterWithCaret(b)&&a.preventDefault()}},i=function(a,b,c){if(a.selection.isCollapsed()){if(a.selection.caretIsInTheBeginnig("li"))if(c){if(a.commands.exec("outdentList"))return}else if(a.commands.exec("indentList"))return}else a.selection.deleteContents();a.commands.exec("insertHTML","&emsp;")},j=function(a){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval),this.parent.fire("destroy:composer")},k=function(a){this.parent.fire("beforeinteraction",a).fire("beforeinteraction:composer",a),setTimeout(function(){this.parent.fire("interaction",a).fire("interaction:composer",a)}.bind(this),0)},l=function(a){this.parent.fire("focus",a).fire("focus:composer",a),setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},m=function(a){if(this.focusState!==this.getValue(!1,!1)){var b=a;"function"==typeof Object.create&&(b=Object.create(a,{type:{value:"change"}})),this.parent.fire("change",b).fire("change:composer",b)}this.parent.fire("blur",a).fire("blur:composer",a)},n=function(a){this.parent.fire(a.type,a).fire(a.type+":composer",a),"paste"===a.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},o=function(b){this.config.copyedFromMarking&&(a.browser.supportsModernPaste()&&(b.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),b.clipboardData.setData("text/plain",this.selection.getPlainText()),b.preventDefault()),this.parent.fire(b.type,b).fire(b.type+":composer",b))},p=function(b){var c=b.keyCode;c!==a.SPACE_KEY&&c!==a.ENTER_KEY||this.parent.fire("newword:composer")},q=function(b){if(!d.canSelectImagesInContentEditable()){var c=b.target,e=this.element.querySelectorAll("img"),f=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),g=a.lang.array(e).without(f);"IMG"===c.nodeName&&a.lang.array(g).contains(c)&&this.selection.selectNode(c)}a.browser.usesControlRanges()&&(this.selection.lastMouseDownPos={x:b.clientX,y:b.clientY},setTimeout(function(){delete this.selection.lastMouseDownPos}.bind(this),0))},r=function(a){var b,c=(a.target,this.selection.lastMouseDownPos);c&&(b=document.body.createTextRange(),setTimeout(function(){try{b.moveToPoint(c.x,c.y),b.select()}catch(a){}}.bind(this),0))},s=function(b){if(this.config.classNames.uneditableContainer){var c=a.dom.getParentElement(b.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);c&&this.selection.setAfter(c)}},t=function(a){d.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},u=function(b){var c,d,f=b.keyCode,j=e[f];if((b.ctrlKey||b.metaKey)&&!b.altKey&&65===f)return this.selection.selectAll(),b.preventDefault(),void 0;(b.ctrlKey||b.metaKey)&&!b.altKey&&j&&(this.commands.exec(j),b.preventDefault()),f===a.BACKSPACE_KEY&&g(b,this),f!==a.BACKSPACE_KEY&&f!==a.DELETE_KEY||(c=this.selection.getSelectedNode(!0),c&&"IMG"===c.nodeName&&(b.preventDefault(),d=c.parentNode,d.removeChild(c),"A"!==d.nodeName||d.firstChild||d.parentNode.removeChild(d),setTimeout(function(){a.quirks.redraw(this.element)}.bind(this),0))),this.config.handleTabKey&&f===a.TAB_KEY&&(b.preventDefault(),i(this,this.element,b.shiftKey)),f===a.ENTER_KEY&&h(b,this)};a.views.Composer.prototype.observeActions=f,a.views.Composer.prototype.observe=function(){var c=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),e=(this.element,d.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow());this.focusState=this.getValue(!1,!1),c.addEventListener(["DOMNodeRemoved"],j.bind(this),!1),d.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){b.contains(document.documentElement,c)||j.call(this)},250)),this.config.handleTables&&f.initTableHandling.call(this),f.addListeners(e,["drop","paste","mouseup","focus","keyup"],k.bind(this)),e.addEventListener("focus",l.bind(this),!1),e.addEventListener("blur",m.bind(this),!1),f.addListeners(this.element,["drop","paste","beforepaste"],n.bind(this),!1),this.element.addEventListener("copy",o.bind(this),!1),this.element.addEventListener("mousedown",q.bind(this),!1),this.element.addEventListener("click",s.bind(this),!1),this.element.addEventListener("drop",t.bind(this),!1),this.element.addEventListener("keyup",p.bind(this),!1),this.element.addEventListener("keydown",u.bind(this),!1),a.browser.usesControlRanges()&&this.element.addEventListener("mscontrolselect",r.bind(this),!1),this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(b),function(a){a.views.Synchronizer=d.extend({constructor:function(a,b,c){this.editor=a,this.textarea=b,this.composer=c,this._observe()},fromComposerToTextarea:function(b){this.textarea.setValue(a.lang.string(this.composer.getValue(!1,!1)).trim(),b)},fromTextareaToComposer:function(a){var b=this.textarea.getValue(!1,!1);b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(a){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(a):this.fromComposerToTextarea(a)},_observe:function(){var b,c=this,d=this.textarea.element.form,e=function(){b=setInterval(function(){c.fromComposerToTextarea()},400)},f=function(){clearInterval(b),b=null};e(),d&&(a.dom.observe(d,"submit",function(){c.sync(!0)}),a.dom.observe(d,"reset",function(){setTimeout(function(){c.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(a){"composer"!==a||b?"textarea"===a&&(c.fromComposerToTextarea(!0),f()):(c.fromTextareaToComposer(!0),e())}),this.editor.on("destroy:composer",f)}})}(b),function(a){a.views.SourceView=d.extend({constructor:function(a,b){this.editor=a,this.composer=b,this._observe()},switchToTextarea:function(a){var b=this.composer.win.getComputedStyle(this.composer.element),c=parseFloat(b.width),d=Math.max(parseFloat(b.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml5-source-view"),this.textarea.style.width=c+"px",this.textarea.style.height=d+"px",this.textarea.value=this.editor.getValue(a,!0),this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element),this.editor.currentView="source",this.composer.element.style.display="none"},switchToComposer:function(a){var b=this.textarea.value;b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder")),this.textarea.parentNode.removeChild(this.textarea),this.editor.currentView=this.composer,this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(a){"composer"===a?this.switchToComposer(!0):"textarea"===a&&this.switchToTextarea(!0)}.bind(this))}})}(b),b.views.Textarea=b.views.View.extend({name:"textarea",constructor:function(a,b,c){this.base(a,b,c),this._observe()},clear:function(){this.element.value=""},getValue:function(a){var b=this.isEmpty()?"":this.element.value;return!1!==a&&(b=this.parent.parse(b)),b},setValue:function(a,b){!1!==b&&(a=this.parent.parse(a)),this.element.value=a},cleanUp:function(a){var b=this.parent.parse(this.element.value,void 0,a);this.element.value=b},hasPlaceholderSet:function(){var a=b.browser.supportsPlaceholderAttributeOn(this.element),c=this.element.getAttribute("placeholder")||null,d=this.element.value,e=!d;return a&&e||d===c},isEmpty:function(){return!b.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var a=this.element,c=this.parent,d={focusin:"focus",focusout:"blur"},e=b.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];c.on("beforeload",function(){b.dom.observe(a,e,function(a){var b=d[a.type]||a.type;c.fire(b).fire(b+":textarea")}),b.dom.observe(a,["paste","drop"],function(){setTimeout(function(){c.fire("paste").fire("paste:textarea")},0)})})}}),function(a){var b,c={name:b,style:!0,toolbar:b,showToolbarAfterInit:!0,showToolbarDialogsOnSelection:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:a.dom.parse,useLineBreaks:!0,doubleLineBreakEscapesBlock:!0,stylesheets:[],placeholderText:b,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml5-editor",body:"wysihtml5-supported",sandbox:"wysihtml5-sandbox",placeholder:"wysihtml5-placeholder",uneditableContainer:"wysihtml5-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};a.Editor=a.lang.Dispatcher.extend({constructor:function(b,d){if(this.editableElement="string"==typeof b?document.getElementById(b):b,this.config=a.lang.object({}).merge(c).merge(d).get(),this._isCompatible=a.browser.supported(),d&&d.classNames&&a.lang.object(this.config.classNames).merge(d.classNames),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new a.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&a.browser.isTouchDevice()){var e=this;return setTimeout(function(){e.fire("beforeload").fire("load")},0),void 0}a.dom.addClass(document.body,this.config.classNames.body),this.composer=new a.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?this.sourceView=new a.views.SourceView(this,this.composer):this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new a.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(a,b){return this.currentView.getValue(a,b)},setValue:function(a,b){return this.fire("unset_placeholder"),a?(this.currentView.setValue(a,b),this):this.clear()},cleanUp:function(a){this.currentView.cleanUp(a)},focus:function(a){return this.currentView.focus(a),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},destroy:function(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy(),this.toolbar&&this.toolbar.destroy(),this.off()},parse:function(b,c,d){var e=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,f=this.config.parser(b,{rules:d||this.config.parserRules,cleanUp:this.config.cleanUp,context:e,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:c});return"object"==typeof b&&a.quirks.redraw(b),f},_initParser:function(){var b;a.browser.supportsModernPaste()?this.on("paste:composer",function(c){c.preventDefault(),b=a.dom.getPastedHtml(c),b&&this._cleanAndPaste(b)}.bind(this)):this.on("beforepaste:composer",function(b){b.preventDefault();var c=this.composer.getScrollPos();a.dom.getPastedHtmlWithDiv(this.composer,function(a){a&&this._cleanAndPaste(a),this.composer.setScrollPos(c)}.bind(this))}.bind(this))},_cleanAndPaste:function(b){var c=a.quirks.cleanPastedHTML(b,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(c)}})}(b),function(a){var b=a.dom,c="wysihtml5-command-dialog-opened",d="[data-wysihtml5-dialog-field]",e="data-wysihtml5-dialog-field";a.toolbar.Dialog=a.lang.Dispatcher.extend({constructor:function(a,b){this.link=a,this.container=b},_observe:function(){if(!this._observed){var d=this,e=function(a){var b=d._serialize();d.fire("save",b),d.hide(),a.preventDefault(),a.stopPropagation()};b.observe(d.link,"click",function(){b.hasClass(d.link,c)&&setTimeout(function(){d.hide()},0)}),b.observe(this.container,"keydown",function(b){var c=b.keyCode;c===a.ENTER_KEY&&e(b),c===a.ESCAPE_KEY&&d.cancel()}),b.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",e),b.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(a){d.cancel(),a.preventDefault(),a.stopPropagation()}),this._observed=!0}},_serialize:function(){for(var a={},b=this.container.querySelectorAll(d),c=b.length,f=0;f<c;f++)a[b[f].getAttribute(e)]=b[f].value;return a},_interpolate:function(a){for(var b,c,f,g=document.querySelector(":focus"),h=this.container.querySelectorAll(d),i=h.length,j=0;j<i;j++)b=h[j],b!==g&&(a&&"hidden"===b.type||(c=b.getAttribute(e),f=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(c)||"":b.defaultValue,b.value=f))},update:function(a){this.elementToChange=a||this.elementToChange,this._interpolate()},show:function(a){var d=this.container.querySelector("input, select, textarea");if(this._observe(),this.update(a),b.addClass(this.link,c),this.container.style.display="",this.isOpen=!0,this.fire("show"),d&&!a)try{d.focus()}catch(a){}},_hide:function(a){this.elementToChange=null,b.removeClass(this.link,c),this.container.style.display="none",this.isOpen=!1},hide:function(){this._hide(),this.fire("hide")},cancel:function(){this._hide(),this.fire("cancel")}})}(b),function(a){var b=a.dom,c={position:"relative"},d={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},e={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},f={"x-webkit-speech":"",speech:""};a.toolbar.Speech=function(g,h){var i,j,k,l=document.createElement("input");if(!a.browser.supportsSpeechApiOn(l))return h.style.display="none",void 0;i=g.editor.textarea.element.getAttribute("lang"),i&&(f.lang=i),j=document.createElement("div"),a.lang.object(d).merge({width:h.offsetWidth+"px",height:h.offsetHeight+"px"}),b.insert(l).into(j),b.insert(j).into(h),b.setStyles(e).on(l),b.setAttributes(f).on(l),b.setStyles(d).on(j),b.setStyles(c).on(h),k="onwebkitspeechchange"in l?"webkitspeechchange":"speechchange",b.observe(l,k,function(){g.execCommand("insertText",l.value),l.value=""}),b.observe(l,"click",function(a){b.hasClass(h,"wysihtml5-command-disabled")&&a.preventDefault(),a.stopPropagation()})}}(b),function(a){function b(b,c){var d=b.commands.state(c.name,c.value);return!c.dialog.multiselect&&a.lang.object(d).isArray()&&(d=1!==d.length||d[0]),d}var c="wysihtml5-command-disabled",e="wysihtml5-commands-disabled",f="wysihtml5-command-active",g="wysihtml5-action-active",h=a.dom;a.toolbar.Toolbar=d.extend({constructor:function(b,d,h){this.editor=b,this.container="string"==typeof d?document.getElementById(d):d,this.composer=b.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),h&&this.show(),null!=b.config.classNameCommandDisabled&&(c=b.config.classNameCommandDisabled),null!=b.config.classNameCommandsDisabled&&(e=b.config.classNameCommandsDisabled),null!=b.config.classNameCommandActive&&(f=b.config.classNameCommandActive),null!=b.config.classNameActionActive&&(g=b.config.classNameActionActive);for(var i=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),j=i.length,k=0;k<j;k++)new a.toolbar.Speech(this,i[k])},_getLinks:function(b){for(var c,d,e,f,g,h,i=this[b+"Links"]=a.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+b+"]")).get(),j=i.length,k=0,l=this[b+"Mapping"]={};k<j;k++)c=i[k],e=c.getAttribute("data-wysihtml5-"+b),f=c.getAttribute("data-wysihtml5-"+b+"-value"),h=c.getAttribute("data-wysihtml5-"+b+"-blank-value"),d=this.container.querySelector("[data-wysihtml5-"+b+"-group='"+e+"']"),g=this._getDialog(c,e),l[e+":"+f]={link:c,group:d,name:e,value:f,tracksBlankValue:h,dialog:g,state:!1}},_getDialog:function(b,c){var d,e,f=this,g=this.container.querySelector("[data-wysihtml5-dialog='"+c+"']");return g&&(d=a.toolbar["Dialog_"+c]?new a.toolbar["Dialog_"+c](b,g):new a.toolbar.Dialog(b,g),d.on("show",function(){e=f.composer.selection.getBookmark(),f.editor.fire("show:dialog",{command:c,dialogContainer:g,commandLink:b})}),d.on("save",function(a){e&&f.composer.selection.setBookmark(e),f._execCommand(c,a),f.editor.fire("save:dialog",{command:c,dialogContainer:g,commandLink:b}),f._hideAllDialogs(),f._preventInstantFocus(),e=void 0}),d.on("cancel",function(){e&&f.composer.selection.setBookmark(e),f.editor.fire("cancel:dialog",{command:c,dialogContainer:g,commandLink:b}),e=void 0,f._preventInstantFocus()}),d.on("hide",function(){f.editor.fire("hide:dialog",{command:c,dialogContainer:g,commandLink:b}),e=void 0})),d},execCommand:function(a,b){this.commandsDisabled||this._execCommand(a,b)},_execCommand:function(a,b){this.editor.focus(!1),this.composer.commands.exec(a,b),this._updateLinkStates()},execAction:function(a){var b=this.editor;"change_view"===a&&(b.currentView===b.textarea||"source"===b.currentView?b.fire("change_view","composer"):b.fire("change_view","textarea")),"showSource"==a&&b.fire("showSource")},_observe:function(){for(var c=this,d=this.editor,f=this.container,g=this.commandLinks.concat(this.actionLinks),i=g.length,j=0;j<i;j++)"A"===g[j].nodeName?h.setAttributes({href:"javascript:;",unselectable:"on"}).on(g[j]):h.setAttributes({unselectable:"on"}).on(g[j]);h.delegate(f,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(a){a.preventDefault()}),h.delegate(f,"[data-wysihtml5-command]","click",function(a){var d,e=this,f=e.getAttribute("data-wysihtml5-command"),g=e.getAttribute("data-wysihtml5-command-value"),h=c.commandMapping[f+":"+g];g||!h.dialog?c.execCommand(f,g):(d=b(c.composer,h),h.dialog.show(d)),a.preventDefault()}),h.delegate(f,"[data-wysihtml5-action]","click",function(a){var b=this.getAttribute("data-wysihtml5-action");c.execAction(b),a.preventDefault()}),d.on("interaction:composer",function(a){c.preventFocus||c._updateLinkStates()}),this._ownerDocumentClick=function(b){a.dom.contains(c.container,b.target)||a.dom.contains(c.composer.element,b.target)||(c._updateLinkStates(),c._preventInstantFocus())},this.container.ownerDocument.addEventListener("click",this._ownerDocumentClick,!1),this.editor.on("destroy:composer",this.destroy.bind(this)),this.editor.config.handleTables&&(d.on("tableselect:composer",function(){c.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),d.on("tableunselect:composer",function(){c.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),d.on("change_view",function(a){setTimeout(function(){c.commandsDisabled="composer"!==a,c._updateLinkStates(),c.commandsDisabled?h.addClass(f,e):h.removeClass(f,e)},0)})},destroy:function(){this.container.ownerDocument.removeEventListener("click",this._ownerDocumentClick,!1)},_hideAllDialogs:function(){var a,b=this.commandMapping;for(a in b)b[a].dialog&&b[a].dialog.hide()},_preventInstantFocus:function(){this.preventFocus=!0,setTimeout(function(){this.preventFocus=!1}.bind(this),0)},_updateLinkStates:function(){var a,d,e,i,j,k=this.commandMapping,l=this.composer,m=this.actionMapping;for(a in k)i=k[a],this.commandsDisabled?(d=!1,h.removeClass(i.link,f),i.group&&h.removeClass(i.group,f),i.dialog&&i.dialog.hide()):(d=this.composer.commands.state(i.name,i.value),h.removeClass(i.link,c),i.group&&h.removeClass(i.group,c)),(i.state!==d||i.tracksBlankValue)&&(i.state=d,d?i.tracksBlankValue?h.removeClass(i.link,f):(h.addClass(i.link,f),i.group&&h.addClass(i.group,f),!i.dialog||void 0!==i.value&&null!==i.value||(d&&"object"==typeof d?(d=b(l,i),i.state=d,j=!!i.dialog.container.dataset&&i.dialog.container.dataset.showdialogonselection,l.config.showToolbarDialogsOnSelection||j?i.dialog.show(d):i.dialog.update(d)):i.dialog.hide())):i.tracksBlankValue?h.addClass(i.link,f):(h.removeClass(i.link,f),i.group&&h.removeClass(i.group,f),i.dialog&&!i.value&&i.dialog.hide()));for(a in m)e=m[a],"change_view"===e.name&&(e.state=this.editor.currentView===this.editor.textarea||"source"===this.editor.currentView,e.state?h.addClass(e.link,g):h.removeClass(e.link,g))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(b),function(a){a.toolbar.Dialog_createTable=a.toolbar.Dialog.extend({show:function(a){this.base(a)}})}(b),function(a){var b="[data-wysihtml5-dialog-field]",c="data-wysihtml5-dialog-field";a.toolbar.Dialog_foreColorStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var a={},d=this.container.querySelectorAll(b),e=d.length,f=0;f<e;f++)a[d[f].getAttribute(c)]=d[f].value;return a},_interpolate:function(d){for(var e,f,g=a.quirks.styleParser,h=document.querySelector(":focus"),i=this.container.querySelectorAll(b),j=i.length,k=0,l=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,m=l?l.getAttribute("style"):null,n=m?g.parseColor(m,"color"):null;k<j;k++)e=i[k],e!==h&&(d&&"hidden"===e.type||"color"===e.getAttribute(c)&&(f=(e.dataset.colormode||"rgb").toLowerCase(),f="hex"===f?"hash":f,e.value=n?g.unparseColor(n,f):g.unparseColor([0,0,0],f)))}})}(b),function(a){a.dom;a.toolbar.Dialog_fontSizeStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(b){var c=document.querySelector(":focus"),d=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),e=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,f=e?e.getAttribute("style"):null,g=f?a.quirks.styleParser.parseFontSize(f):null;d&&d!==c&&g&&!/^\s*$/.test(g)&&(d.value=g)}})}(b),b}),define("handlebars/safe-string",["exports"],function(a){function b(a){this.string=a}b.prototype.toString=function(){return""+this.string},a.default=b}),define("handlebars/utils",["./safe-string","exports"],function(a,b){function c(a){return k[a]||"&amp;"}function d(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}function e(a){return a instanceof j?""+a:a||0===a?(a=""+a,m.test(a)?a.replace(l,c):a):""}function f(a){return!a&&0!==a||!(!i(a)||0!==a.length)}var g,h,i,j=a.default,k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},l=/[&<>"'`]/g,m=/[&<>"'`]/;b.extend=d,g=Object.prototype.toString,b.toString=g,h=function(a){return"function"==typeof a},h(/x/)&&(h=function(a){return"function"==typeof a&&"[object Function]"===g.call(a)}),b.isFunction=h,i=Array.isArray||function(a){return!(!a||"object"!=typeof a)&&"[object Array]"===g.call(a)},b.isArray=i,b.escapeExpression=e,b.isEmpty=f}),define("handlebars/exception",["exports"],function(a){function b(a,b){var d,e,f;for(b&&b.firstLine&&(d=b.firstLine,a+=" - "+d+":"+b.firstColumn),e=Error.prototype.constructor.call(this,a),f=0;f<c.length;f++)this[c[f]]=e[c[f]];d&&(this.lineNumber=d,this.column=b.firstColumn)}var c=["description","fileName","lineNumber","message","name","number","stack"];b.prototype=Error(),a.default=b}),define("handlebars/base",["./utils","./exception","exports"],function(a,b,c){function d(a,b){this.helpers=a||{},this.partials=b||{},e(this)}function e(a){a.registerHelper("helperMissing",function(a){if(2!==arguments.length)throw new p("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse||function(){},e=c.fn;return j(b)&&(b=b.call(this)),!0===b?e(this):!1===b||null==b?d(this):i(b)?b.length>0?a.helpers.each(b,c):d(this):e(b)}),a.registerHelper("each",function(a,b){var c,d,e,f=b.fn,g=b.inverse,h=0,k="";if(j(a)&&(a=a.call(this)),b.data&&(c=n(b.data)),a&&"object"==typeof a)if(i(a))for(d=a.length;h<d;h++)c&&(c.index=h,c.first=0===h,c.last=h===a.length-1),k+=f(a[h],{data:c});else for(e in a)a.hasOwnProperty(e)&&(c&&(c.key=e,c.index=h,c.first=0===h),k+=f(a[e],{data:c}),h++);return 0===h&&(k=g(this)),k}),a.registerHelper("if",function(a,b){return j(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||o.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers.if.call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){if(j(a)&&(a=a.call(this)),!o.isEmpty(a))return b.fn(a)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)})}function f(a,b){m.log(a,b)}var g,h,i,j,k,l,m,n,o=a,p=b.default;c.VERSION="1.3.0",g=4,c.COMPILER_REVISION=g,h={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},c.REVISION_CHANGES=h,i=o.isArray,j=o.isFunction,k=o.toString,l="[object Object]",c.HandlebarsEnvironment=d,d.prototype={constructor:d,logger:m,log:f,registerHelper:function(a,b,c){if(k.call(a)===l){if(c||b)throw new p("Arg not supported with multiple helpers");o.extend(this.helpers,a)}else c&&(b.not=c),this.helpers[a]=b},registerPartial:function(a,b){k.call(a)===l?o.extend(this.partials,a):this.partials[a]=b}},m={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){if(m.level<=a){var c=m.methodMap[a];"undefined"!=typeof console&&console[c]&&void 0}}},c.logger=m,c.log=f,n=function(a){var b={};return o.extend(b,a),b},c.createFrame=n}),define("handlebars/runtime",["./utils","./exception","./base","exports"],function(a,b,c,d){function e(a){var b,c,d=a&&a[0]||1,e=m;if(d!==e)throw d<e?(b=n[e],c=n[d],new l("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+b+") or downgrade your runtime to an older version ("+c+").")):new l("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}function f(a,b){var c,d;if(!b)throw new l("No environment passed to template");return c=function(a,c,d,e,f,g){var h,i=b.VM.invokePartial.apply(this,arguments);if(null!=i)return i;if(b.compile)return h={helpers:e,partials:f,data:g},f[c]=b.compile(a,{data:void 0!==g},b),f[c](d,h);throw new l("The partial "+c+" could not be compiled when running in runtime-only mode")},d={escapeExpression:k.escapeExpression,invokePartial:c,programs:[],program:function(a,b,c){var d=this.programs[a];return c?d=h(a,b,c):d||(d=this.programs[a]=h(a,b)),d},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c={},k.extend(c,b),k.extend(c,a)),c},programWithDepth:b.VM.programWithDepth,noop:b.VM.noop,compilerInfo:null},function(c,e){var f,g,h,i;return e=e||{},f=e.partial?e:b,e.partial||(g=e.helpers,h=e.partials),i=a.call(d,f,c,g,h,e.data),e.partial||b.VM.checkRevision(d.compilerInfo),i}}function g(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e}function h(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d}function i(a,b,c,d,e,f){var g={partial:!0,helpers:d,partials:e,data:f};if(void 0===a)throw new l("The partial "+b+" could not be found");if(a instanceof Function)return a(c,g)}function j(){return""}var k=a,l=b.default,m=c.COMPILER_REVISION,n=c.REVISION_CHANGES;d.checkRevision=e,d.template=f,d.programWithDepth=g,d.program=h,d.invokePartial=i,d.noop=j}),define("handlebars.runtime",["./handlebars/base","./handlebars/safe-string","./handlebars/exception","./handlebars/utils","./handlebars/runtime","exports"],function(a,b,c,d,e,f){var g=a,h=b.default,i=c.default,j=d,k=e,l=function(){var a=new g.HandlebarsEnvironment;return j.extend(a,g),a.SafeString=h,a.Exception=i,a.Utils=j,a.VM=k,a.template=function(b){return k.template(b,a)},a},m=l();m.create=l,f.default=m}),define("bootstrap.wysihtml5.templates",["handlebars.runtime","wysihtml5"],function(a,b){this.wysihtml5=b;var c=a.default;this.wysihtml5=this.wysihtml5||{},this.wysihtml5.tpl=this.wysihtml5.tpl||{},this.wysihtml5.tpl.blockquote=c.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+="btn-"+l((c=a&&a.options,c=null==c||!1===c?c:c.toolbar,c=null==c||!1===c?c:c.size,typeof c===k?c.apply(a):c)),d}function g(a,b){return' \n      <span class="fa fa-quote-left"></span>\n    '}function h(a,b){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j="",k="function",l=this.escapeExpression,m=this;return j+='<li>\n  <a class="btn ',i=c.if.call(b,(i=b&&b.options,i=null==i||!1===i?i:i.toolbar,null==i||!1===i?i:i.size),{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',i=c.if.call(b,(i=b&&b.options,i=null==i||!1===i?i:i.toolbar,null==i||!1===i?i:i.fa),{hash:{},inverse:m.program(5,h,e),fn:m.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+="\n  </a>\n</li>\n",j}),this.wysihtml5.tpl.color=c.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+="btn-"+j((c=a&&a.options,c=null==c||!1===c?c:c.toolbar,c=null==c||!1===c?c:c.size,typeof c===i?c.apply(a):c)),d}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h="",i="function",j=this.escapeExpression,k=this;return h+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',g=c.if.call(b,(g=b&&b.options,g=null==g||!1===g?g:g.toolbar,null==g||!1===g?g:g.size),{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.black,typeof g===i?g.apply(b):g))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.black,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.silver,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.gray,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.maroon,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.red,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.purple,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.green,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.olive,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.navy,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.blue,typeof g===i?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+j((g=b&&b.locale,g=null==g||!1===g?g:g.colours,g=null==g||!1===g?g:g.orange,typeof g===i?g.apply(b):g))+"</a></li>\n  </ul>\n</li>\n",h}),this.wysihtml5.tpl.emphasis=c.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+="btn-"+k((c=a&&a.options,c=null==c||!1===c?c:c.toolbar,c=null==c||!1===c?c:c.size,typeof c===j?c.apply(a):c)),d}function g(a,b){var d,e="";return e+='\n    <a class="btn ',d=c.if.call(a,(d=a&&a.options,d=null==d||!1===d?d:d.toolbar,null==d||!1===d?d:d.size),{hash:{},inverse:l.noop,fn:l.program(1,f,b),data:b}),(d||0===d)&&(e+=d),e+=' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">'+k((d=a&&a.locale,d=null==d||!1===d?d:d.emphasis,d=null==d||!1===d?d:d.small,typeof d===j?d.apply(a):d))+"</a>\n    ",e}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="",j="function",k=this.escapeExpression,l=this;return i+='<li>\n  <div class="btn-group">\n    <a class="btn ',h=c.if.call(b,(h=b&&b.options,h=null==h||!1===h?h:h.toolbar,null==h||!1===h?h:h.size),{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+k((h=b&&b.locale,h=null==h||!1===h?h:h.emphasis,h=null==h||!1===h?h:h.bold,typeof h===j?h.apply(b):h))+'</a>\n    <a class="btn ',h=c.if.call(b,(h=b&&b.options,h=null==h||!1===h?h:h.toolbar,null==h||!1===h?h:h.size),{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+=' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">'+k((h=b&&b.locale,h=null==h||!1===h?h:h.emphasis,h=null==h||!1===h?h:h.italic,typeof h===j?h.apply(b):h))+'</a>\n    <a class="btn ',h=c.if.call(b,(h=b&&b.options,h=null==h||!1===h?h:h.toolbar,null==h||!1===h?h:h.size),{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+=' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">'+k((h=b&&b.locale,h=null==h||!1===h?h:h.emphasis,h=null==h||!1===h?h:h.underline,typeof h===j?h.apply(b):h))+"</a>\n    ",h=c.if.call(b,(h=b&&b.options,h=null==h||!1===h?h:h.toolbar,h=null==h||!1===h?h:h.emphasis,null==h||!1===h?h:h.small),{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(h||0===h)&&(i+=h),i+="\n  </div>\n</li>\n",i}),this.wysihtml5.tpl["font-styles"]=c.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+="btn-"+l((c=a&&a.options,c=null==c||!1===c?c:c.toolbar,c=null==c||!1===c?c:c.size,typeof c===k?c.apply(a):c)),d}function g(a,b){return'\n      <span class="fa fa-font"></span>\n    '}function h(a,b){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j="",k="function",l=this.escapeExpression,m=this;return j+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',i=c.if.call(b,(i=b&&b.options,i=null==i||!1===i?i:i.toolbar,null==i||!1===i?i:i.size),{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='" data-toggle="dropdown">\n    ',i=c.if.call(b,(i=b&&b.options,i=null==i||!1===i?i:i.toolbar,null==i||!1===i?i:i.fa),{hash:{},inverse:m.program(5,h,e),fn:m.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+='\n    <span class="current-font">'+l((i=b&&b.locale,i=null==i||!1===i?i:i.font_styles,i=null==i||!1===i?i:i.normal,typeof i===k?i.apply(b):i))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+l((i=b&&b.locale,i=null==i||!1===i?i:i.font_styles,i=null==i||!1===i?i:i.normal,typeof i===k?i.apply(b):i))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+l((i=b&&b.locale,i=null==i||!1===i?i:i.font_styles,i=null==i||!1===i?i:i.h1,typeof i===k?i.apply(b):i))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+l((i=b&&b.locale,i=null==i||!1===i?i:i.font_styles,i=null==i||!1===i?i:i.h2,typeof i===k?i.apply(b):i))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+l((i=b&&b.locale,i=null==i||!1===i?i:i.font_styles,i=null==i||!1===i?i:i.h3,typeof i===k?i.apply(b):i))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+l((i=b&&b.locale,i=null==i||!1===i?i:i.font_styles,i=null==i||!1===i?i:i.h4,typeof i===k?i.apply(b):i))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+l((i=b&&b.locale,i=null==i||!1===i?i:i.font_styles,i=null==i||!1===i?i:i.h5,typeof i===k?i.apply(b):i))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+l((i=b&&b.locale,i=null==i||!1===i?i:i.font_styles,i=null==i||!1===i?i:i.h6,typeof i===k?i.apply(b):i))+"</a></li>\n  </ul>\n</li>\n",j}),this.wysihtml5.tpl.html=c.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+="btn-"+l((c=a&&a.options,c=null==c||!1===c?c:c.toolbar,c=null==c||!1===c?c:c.size,typeof c===k?c.apply(a):c)),d}function g(a,b){return'\n        <span class="fa fa-pencil"></span>\n      '}function h(a,b){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j="",k="function",l=this.escapeExpression,m=this;return j+='<li>\n  <div class="btn-group">\n    <a class="btn ',i=c.if.call(b,(i=b&&b.options,i=null==i||!1===i?i:i.toolbar,null==i||!1===i?i:i.size),{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+=' btn-default" data-wysihtml5-action="change_view" title="'+l((i=b&&b.locale,i=null==i||!1===i?i:i.html,i=null==i||!1===i?i:i.edit,typeof i===k?i.apply(b):i))+'" tabindex="-1">\n      ',i=c.if.call(b,(i=b&&b.options,i=null==i||!1===i?i:i.toolbar,null==i||!1===i?i:i.fa),{hash:{},inverse:m.program(5,h,e),fn:m.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+="\n    </a>\n  </div>\n</li>\n",j}),this.wysihtml5.tpl.image=c.template(function(a,b,c,d,e){function f(a,b){return"modal-sm"}function g(a,b){var c,d="";return d+="btn-"+m((c=a&&a.options,c=null==c||!1===c?c:c.toolbar,c=null==c||!1===c?c:c.size,typeof c===l?c.apply(a):c)),d}function h(a,b){return'\n      <span class="fa fa-file-image-o"></span>\n    '}function i(a,b){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k="",l="function",m=this.escapeExpression,n=this;return k+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',j=c.if.call(b,(j=b&&b.options,j=null==j||!1===j?j:j.toolbar,null==j||!1===j?j:j.smallmodals),{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+m((j=b&&b.locale,j=null==j||!1===j?j:j.image,j=null==j||!1===j?j:j.insert,typeof j===l?j.apply(b):j))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+m((j=b&&b.locale,j=null==j||!1===j?j:j.image,j=null==j||!1===j?j:j.cancel,typeof j===l?j.apply(b):j))+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+m((j=b&&b.locale,j=null==j||!1===j?j:j.image,j=null==j||!1===j?j:j.insert,typeof j===l?j.apply(b):j))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',j=c.if.call(b,(j=b&&b.options,j=null==j||!1===j?j:j.toolbar,null==j||!1===j?j:j.size),{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+=' btn-default" data-wysihtml5-command="insertImage" title="'+m((j=b&&b.locale,j=null==j||!1===j?j:j.image,j=null==j||!1===j?j:j.insert,typeof j===l?j.apply(b):j))+'" tabindex="-1">\n    ',j=c.if.call(b,(j=b&&b.options,j=null==j||!1===j?j:j.toolbar,null==j||!1===j?j:j.fa),{hash:{},inverse:n.program(7,i,e),fn:n.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k+="\n  </a>\n</li>\n",k}),this.wysihtml5.tpl.link=c.template(function(a,b,c,d,e){function f(a,b){return"modal-sm"}function g(a,b){var c,d="";return d+="btn-"+m((c=a&&a.options,c=null==c||!1===c?c:c.toolbar,c=null==c||!1===c?c:c.size,typeof c===l?c.apply(a):c)),d}function h(a,b){return'\n      <span class="fa fa-share-square-o"></span>\n    '}function i(a,b){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var j,k="",l="function",m=this.escapeExpression,n=this;return k+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',j=c.if.call(b,(j=b&&b.options,j=null==j||!1===j?j:j.toolbar,null==j||!1===j?j:j.smallmodals),{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e}),(j||0===j)&&(k+=j),k+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+m((j=b&&b.locale,j=null==j||!1===j?j:j.link,j=null==j||!1===j?j:j.insert,typeof j===l?j.apply(b):j))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+m((j=b&&b.locale,j=null==j||!1===j?j:j.link,j=null==j||!1===j?j:j.target,typeof j===l?j.apply(b):j))+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+m((j=b&&b.locale,j=null==j||!1===j?j:j.link,j=null==j||!1===j?j:j.cancel,typeof j===l?j.apply(b):j))+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+m((j=b&&b.locale,j=null==j||!1===j?j:j.link,j=null==j||!1===j?j:j.insert,typeof j===l?j.apply(b):j))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',j=c.if.call(b,(j=b&&b.options,j=null==j||!1===j?j:j.toolbar,null==j||!1===j?j:j.size),{hash:{},inverse:n.noop,fn:n.program(3,g,e),data:e}),(j||0===j)&&(k+=j),k+=' btn-default" data-wysihtml5-command="createLink" title="'+m((j=b&&b.locale,j=null==j||!1===j?j:j.link,j=null==j||!1===j?j:j.insert,typeof j===l?j.apply(b):j))+'" tabindex="-1">\n    ',j=c.if.call(b,(j=b&&b.options,j=null==j||!1===j?j:j.toolbar,null==j||!1===j?j:j.fa),{hash:{},inverse:n.program(7,i,e),fn:n.program(5,h,e),data:e}),(j||0===j)&&(k+=j),k+="\n  </a>\n</li>\n",k}),this.wysihtml5.tpl.lists=c.template(function(a,b,c,d,e){function f(a,b){var c,d="";return d+="btn-"+r((c=a&&a.options,c=null==c||!1===c?c:c.toolbar,c=null==c||!1===c?c:c.size,typeof c===q?c.apply(a):c)),d}function g(a,b){return'\n      <span class="fa fa-list-ul"></span>\n    '}function h(a,b){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '}function i(a,b){return'\n      <span class="fa fa-list-ol"></span>\n    '}function j(a,b){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '}function k(a,b){return'\n      <span class="fa fa-outdent"></span>\n    '}function l(a,b){return'\n      <span class="glyphicon glyphicon-indent-right"></span>\n    '}function m(a,b){return'\n      <span class="fa fa-indent"></span>\n    '}function n(a,b){return'\n      <span class="glyphicon glyphicon-indent-left"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var o,p="",q="function",r=this.escapeExpression,s=this;return p+='<li>\n  <div class="btn-group">\n    <a class="btn ',o=c.if.call(b,(o=b&&b.options,o=null==o||!1===o?o:o.toolbar,null==o||!1===o?o:o.size),{hash:{},inverse:s.noop,fn:s.program(1,f,e),data:e}),(o||0===o)&&(p+=o),p+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+r((o=b&&b.locale,o=null==o||!1===o?o:o.lists,o=null==o||!1===o?o:o.unordered,typeof o===q?o.apply(b):o))+'" tabindex="-1">\n    ',o=c.if.call(b,(o=b&&b.options,o=null==o||!1===o?o:o.toolbar,null==o||!1===o?o:o.fa),{hash:{},inverse:s.program(5,h,e),fn:s.program(3,g,e),data:e}),(o||0===o)&&(p+=o),p+='\n    </a>\n    <a class="btn ',o=c.if.call(b,(o=b&&b.options,o=null==o||!1===o?o:o.toolbar,null==o||!1===o?o:o.size),{hash:{},inverse:s.noop,fn:s.program(1,f,e),data:e}),(o||0===o)&&(p+=o),p+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+r((o=b&&b.locale,o=null==o||!1===o?o:o.lists,o=null==o||!1===o?o:o.ordered,typeof o===q?o.apply(b):o))+'" tabindex="-1">\n    ',o=c.if.call(b,(o=b&&b.options,o=null==o||!1===o?o:o.toolbar,null==o||!1===o?o:o.fa),{hash:{},inverse:s.program(9,j,e),fn:s.program(7,i,e),data:e}),(o||0===o)&&(p+=o),p+='\n    </a>\n    <a class="btn ',o=c.if.call(b,(o=b&&b.options,o=null==o||!1===o?o:o.toolbar,null==o||!1===o?o:o.size),{hash:{},inverse:s.noop,fn:s.program(1,f,e),data:e}),(o||0===o)&&(p+=o),p+=' btn-default" data-wysihtml5-command="Outdent" title="'+r((o=b&&b.locale,o=null==o||!1===o?o:o.lists,o=null==o||!1===o?o:o.outdent,typeof o===q?o.apply(b):o))+'" tabindex="-1">\n    ',o=c.if.call(b,(o=b&&b.options,o=null==o||!1===o?o:o.toolbar,null==o||!1===o?o:o.fa),{hash:{},inverse:s.program(13,l,e),fn:s.program(11,k,e),data:e}),(o||0===o)&&(p+=o),p+='\n    </a>\n    <a class="btn ',o=c.if.call(b,(o=b&&b.options,o=null==o||!1===o?o:o.toolbar,null==o||!1===o?o:o.size),{hash:{},inverse:s.noop,fn:s.program(1,f,e),data:e}),(o||0===o)&&(p+=o),p+=' btn-default" data-wysihtml5-command="Indent" title="'+r((o=b&&b.locale,o=null==o||!1===o?o:o.lists,o=null==o||!1===o?o:o.indent,typeof o===q?o.apply(b):o))+'" tabindex="-1">\n    ',o=c.if.call(b,(o=b&&b.options,o=null==o||!1===o?o:o.toolbar,null==o||!1===o?o:o.fa),{hash:{},inverse:s.program(17,n,e),fn:s.program(15,m,e),data:e}),(o||0===o)&&(p+=o),p+="\n    </a>\n  </div>\n</li>\n",p})}),define("bootstrap.wysihtml5.commands",["wysihtml5"],function(a){!function(a){a.commands.small={exec:function(b,c){return a.commands.formatInline.exec(b,c,"small")},state:function(b,c){return a.commands.formatInline.state(b,c,"small")}}}(a)}),function(a){"use strict";"function"==typeof define&&define.amd?define("bootstrap.wysihtml5",["jquery","wysihtml5","bootstrap","bootstrap.wysihtml5.templates","bootstrap.wysihtml5.commands"],a):a(jQuery,wysihtml5)}(function(a,b){"use strict";!function(a,b){var c,d,e,f=function(a,c,d){if(b.tpl[a])return b.tpl[a]({locale:c,options:d})},g=function(c,e){var f,g;this.el=c,f=a.extend(!0,{},d,e);for(g in f.customTemplates)f.customTemplates.hasOwnProperty(g)&&(b.tpl[g]=f.customTemplates[g]);this.toolbar=this.createToolbar(c,f),this.editor=this.createEditor(f)};g.prototype={constructor:g,createEditor:function(b){return b=b||{},b=a.extend(!0,{},b),b.toolbar=this.toolbar[0],this.initializeEditor(this.el[0],b)},initializeEditor:function(a,c){var d,e=new b.Editor(this.el[0],c);if(e.on("beforeload",this.syncBootstrapDialogEvents),e.on("beforeload",this.loadParserRules),e.composer.editableArea.contentDocument?this.addMoreShortcuts(e,e.composer.editableArea.contentDocument.body||e.composer.editableArea.contentDocument,c.shortcuts):this.addMoreShortcuts(e,e.composer.editableArea,c.shortcuts),c&&c.events)for(d in c.events)c.events.hasOwnProperty(d)&&e.on(d,c.events[d]);return e},loadParserRules:function(){"string"===a.type(this.config.parserRules)&&a.ajax({dataType:"json",url:this.config.parserRules,context:this,error:function(a,b,c){void 0},success:function(a){this.config.parserRules=a}}),this.config.pasteParserRulesets&&"string"===a.type(this.config.pasteParserRulesets)&&a.ajax({dataType:"json",url:this.config.pasteParserRulesets,context:this,error:function(a,b,c){void 0},success:function(a){this.config.pasteParserRulesets=a}})},syncBootstrapDialogEvents:function(){var b=this;a.map(this.toolbar.commandMapping,function(a){return[a]}).filter(function(a){return a.dialog}).map(function(a){return a.dialog}).forEach(function(c){c.on("show",function(){a(this.container).modal("show")}),c.on("hide",function(){a(this.container).modal("hide"),setTimeout(b.composer.focus,0)}),a(c.container).on("shown.bs.modal",function(){a(this).find("input, select, textarea").first().focus()})}),this.on("change_view",function(){a(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled")})},createToolbar:function(b,c){var g,h,i=this,j=a("<ul/>",{class:"wysihtml5-toolbar",style:"display:none"}),k=c.locale||d.locale||"en";e.hasOwnProperty(k)||(void 0,k="en"),g=a.extend(!0,{},e.en,e[k]);for(h in c.toolbar)c.toolbar[h]&&j.append(f(h,g,c));return j.find('a[data-wysihtml5-command="formatBlock"]').click(function(b){var c=b.delegateTarget||b.target||b.srcElement,d=a(c),e=d.data("wysihtml5-display-format-name"),f=d.data("wysihtml5-format-name")||d.html();void 0!==e&&"true"!==e||i.toolbar.find(".current-font").text(f)}),j.find('a[data-wysihtml5-command="foreColor"]').click(function(b){var c=b.target||b.srcElement,d=a(c);i.toolbar.find(".current-color").text(d.html())}),this.el.before(j),j},addMoreShortcuts:function(a,c,d){b.dom.observe(c,"keydown",function(c){var e,f=c.keyCode,g=d[f];(c.ctrlKey||c.metaKey||c.altKey)&&g&&b.commands[g]&&(e=a.toolbar.commandMapping[g+":null"],e&&e.dialog&&!e.state?e.dialog.show():b.commands[g].exec(a.composer,g),c.preventDefault())})}},c={resetDefaults:function(){a.fn.wysihtml5.defaultOptions=a.extend(!0,{},a.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(b){return this.each(function(){var c=a(this);c.data("wysihtml5",new g(c,b))})},shallowExtend:function(b){var d=a.extend({},a.fn.wysihtml5.defaultOptions,b||{},a(this).data()),e=this;return c.bypassDefaults.apply(e,[d])},deepExtend:function(b){var d=a.extend(!0,{},a.fn.wysihtml5.defaultOptions,b||{}),e=this;return c.bypassDefaults.apply(e,[d])},init:function(a){var b=this;return c.shallowExtend.apply(b,[a])}},a.fn.wysihtml5=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist on jQuery.wysihtml5"),void 0):c.init.apply(this,arguments)},a.fn.wysihtml5.Constructor=g,d=a.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},useLineBreaks:!1,parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{83:"small",75:"createLink"}},void 0===a.fn.wysihtml5.defaultOptionsCache&&(a.fn.wysihtml5.defaultOptionsCache=a.extend(!0,{},a.fn.wysihtml5.defaultOptions)),e=a.fn.wysihtml5.locale={}}(a,b)});